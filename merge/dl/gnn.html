
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<meta content="Deep Learning for Molecules &amp; Materials Book" lang="en" name="description" xml:lang="en" />
<meta content="en_US" property="og:locale" />
<meta content="summary" name="twitter:card" />
<meta content="Deep Learning for Molecules &amp; Materials Book" name="twitter:description" />
<meta content="dmol.pub üìñ" name="twitter:title" />
<meta content="https://dmol.pub/_static/logo.png" name="twitter:image" />
<meta content="&#64;andrewwhite01" name="twitter:site" />

    <title>8. Graph Neural Networks &#8212; deep learning for molecules &amp; materials</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/a11y.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/custom.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="canonical" href="https://resnant.github.io/dmol-book-japanese/dl/gnn.html" />
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="9. Input Data &amp; Equivariances" href="data.html" />
    <link rel="prev" title="7. Standard Layers" href="layers.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">deep learning for molecules & materials</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   „Åì„ÅÆÊú¨„ÅÆÊ¶ÇË¶Å
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  A. Math Review
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../math/tensors-and-shapes.html">
   1. Tensors and Shapes
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  B. Machine Learning
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../ml/introduction.html">
   2. Ê©üÊ¢∞Â≠¶ÁøíÂÖ•ÈñÄ
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ml/regression.html">
   3. Regression &amp; Model Assessment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ml/classification.html">
   4. Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ml/kernel.html">
   5. „Ç´„Éº„Éç„É´Â≠¶Áøí
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  C. Deep Learning
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="introduction.html">
   6. „Éá„Ç£„Éº„Éó„É©„Éº„Éã„É≥„Ç∞„ÅÆÊ¶ÇË¶Å
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="layers.html">
   7. Standard Layers
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   8. Graph Neural Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data.html">
   9. Input Data &amp; Equivariances
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Equivariant.html">
   10. Equivariant Neural Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="molnets.html">
   11. Modern Molecular NNs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="xai.html">
   12. ‰∫àÊ∏¨„ÇíË™¨Êòé„Åô„Çã
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="attention.html">
   13. „Ç¢„ÉÜ„É≥„Ç∑„Éß„É≥„É¨„Ç§„É§„Éº
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="NLP.html">
   15. Deep Learning on Sequences
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="VAE.html">
   16. Variational Autoencoder
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="flows.html">
   17. Normalizing Flows
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  D. Applications
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../applied/QM9.html">
   18. GNN„Å´„Çà„ÇãDFT„Ç®„Éç„É´„ÇÆ„Éº„ÅÆ‰∫àÊ∏¨
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../applied/MolGenerator.html">
   19. Generative RNN in Browser
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  E. Contributed Chapters
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Hyperparameter_tuning.html">
   20. Hyperparameter Tuning
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  F. Appendix
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../style.html">
   21. Style Guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../changelog.html">
   22. Changelog
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  <script async defer src="https://api.dmol.pub/latest.js"></script><noscript><img src="https://api.dmol.pub/noscript.gif" alt="" referrerpolicy="no-referrer-when-downgrade" /></noscript> By <a href="https://twitter.com/andrewwhite01">Andrew White</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/dl/gnn.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/resnant/dmol-book-japanese/"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/resnant/dmol-book-japanese//issues/new?title=Issue%20on%20page%20%2Fdl/gnn.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/resnant/dmol-book-japanese/blob/master/dl/gnn.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id8">
   8.1. „Ç∞„É©„Éï„ÅÆË°®Áèæ
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id10">
   8.2. „Åì„ÅÆ„Éé„Éº„Éà„Éñ„ÉÉ„ÇØ„ÅÆÂãï„Åã„ÅóÊñπ
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id11">
   8.3. „Ç∞„É©„Éï„Éã„É•„Éº„É©„É´„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gnn">
     8.3.1. „Ç∑„É≥„Éó„É´„Å™GNN
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#kipf-welling-gcn">
   8.4. Kipf &amp; Welling GCN
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gcn">
     8.4.1. GCN„ÅÆÂÆüË£Ö
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id13">
   8.5. ‰æãÔºöÊ∫∂Ëß£Â∫¶‰∫àÊ∏¨
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#message-passinggcn">
   8.6. Message Passing„Å®GCN
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#gated-graph-neural-network">
   8.7. Gated Graph Neural Network
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pooling">
   8.8. Pooling
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#readout-function">
   8.9. Readout Function
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#intensive-vs-extensive">
     8.9.1. Intensive vs Extensive
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#battaglia-general-equations">
   8.10. Battaglia General Equations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#battaglia-equationsgcn">
     8.10.1. Battaglia equations„Å´„Çà„ÇãGCN„ÅÆÂÜçÂÆöÂºèÂåñ
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-schnet-architecture">
   8.11. The SchNet Architecture
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#schnet-example-predicting-space-groups">
   8.12. SchNet Example: Predicting Space Groups
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#building-the-graphs">
     8.12.1. Building the graphs
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#implementing-the-mlps">
     8.12.2. Implementing the MLPs
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#implementing-the-gnn">
     8.12.3. Implementing the GNN
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#training">
     8.12.4. Training
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#current-research-directions">
   8.13. Current Research Directions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#common-architecture-motifs-and-comparisons">
     8.13.1. Common Architecture Motifs and Comparisons
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nodes-edges-and-features">
     8.13.2. Nodes, Edges, and Features
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#beyond-message-passing">
     8.13.3. Beyond Message Passing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#do-we-need-graphs">
     8.13.4. Do we need graphs?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stereochemistry-chiral-molecules">
     8.13.5. Stereochemistry/Chiral Molecules
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#relevant-videos">
   8.14. Relevant Videos
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#intro-to-gnns">
     8.14.1. Intro to GNNs
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#overview-of-gnn-with-molecule-compiler-examples">
     8.14.2. Overview of GNN with Molecule, Compiler Examples
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#chapter-summary">
   8.15. Chapter Summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cited-references">
   8.16. Cited References
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Graph Neural Networks</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id8">
   8.1. „Ç∞„É©„Éï„ÅÆË°®Áèæ
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id10">
   8.2. „Åì„ÅÆ„Éé„Éº„Éà„Éñ„ÉÉ„ÇØ„ÅÆÂãï„Åã„ÅóÊñπ
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id11">
   8.3. „Ç∞„É©„Éï„Éã„É•„Éº„É©„É´„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gnn">
     8.3.1. „Ç∑„É≥„Éó„É´„Å™GNN
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#kipf-welling-gcn">
   8.4. Kipf &amp; Welling GCN
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gcn">
     8.4.1. GCN„ÅÆÂÆüË£Ö
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id13">
   8.5. ‰æãÔºöÊ∫∂Ëß£Â∫¶‰∫àÊ∏¨
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#message-passinggcn">
   8.6. Message Passing„Å®GCN
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#gated-graph-neural-network">
   8.7. Gated Graph Neural Network
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pooling">
   8.8. Pooling
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#readout-function">
   8.9. Readout Function
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#intensive-vs-extensive">
     8.9.1. Intensive vs Extensive
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#battaglia-general-equations">
   8.10. Battaglia General Equations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#battaglia-equationsgcn">
     8.10.1. Battaglia equations„Å´„Çà„ÇãGCN„ÅÆÂÜçÂÆöÂºèÂåñ
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-schnet-architecture">
   8.11. The SchNet Architecture
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#schnet-example-predicting-space-groups">
   8.12. SchNet Example: Predicting Space Groups
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#building-the-graphs">
     8.12.1. Building the graphs
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#implementing-the-mlps">
     8.12.2. Implementing the MLPs
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#implementing-the-gnn">
     8.12.3. Implementing the GNN
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#training">
     8.12.4. Training
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#current-research-directions">
   8.13. Current Research Directions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#common-architecture-motifs-and-comparisons">
     8.13.1. Common Architecture Motifs and Comparisons
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nodes-edges-and-features">
     8.13.2. Nodes, Edges, and Features
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#beyond-message-passing">
     8.13.3. Beyond Message Passing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#do-we-need-graphs">
     8.13.4. Do we need graphs?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stereochemistry-chiral-molecules">
     8.13.5. Stereochemistry/Chiral Molecules
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#relevant-videos">
   8.14. Relevant Videos
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#intro-to-gnns">
     8.14.1. Intro to GNNs
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#overview-of-gnn-with-molecule-compiler-examples">
     8.14.2. Overview of GNN with Molecule, Compiler Examples
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#chapter-summary">
   8.15. Chapter Summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cited-references">
   8.16. Cited References
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="graph-neural-networks">
<h1><span class="section-number">8. </span>Graph Neural Networks<a class="headerlink" href="#graph-neural-networks" title="Permalink to this headline">¬∂</a></h1>
<p>Ê≠¥Âè≤ÁöÑ„Å´„ÄÅÊ©üÊ¢∞Â≠¶Áøí„ÅßÂàÜÂ≠ê„ÇíÊâ±„ÅÜÈöõ„ÅÆÊúÄÂ§ß„ÅÆË™≤È°å„ÅØ„ÄÅË®òËø∞Â≠ê„ÅÆÈÅ∏ÂÆö„Å®„Åù„ÅÆË®àÁÆó„Åß„Åó„Åü„ÄÇ„Ç∞„É©„Éï„Éã„É•„Éº„É©„É´„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÔºàGNNÔºâ„ÅØ„ÄÅ„Ç∞„É©„Éï„ÇíÂÖ•Âäõ„Å®„Åô„Çã„Éá„Ç£„Éº„Éó„Éã„É•„Éº„É©„É´„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„ÅÆ‰∏ÄÁ®Æ„Åß„ÅÇ„Çä„ÄÅGNN„ÅØÂàÜÂ≠ê„ÇíÁõ¥Êé•ÂÖ•Âäõ„Å®„Åó„Å¶Âèó„ÅëÂèñ„Çã„Åì„Å®„Åå„Åß„Åç„Çã„Åü„ÇÅ„ÄÅË®òËø∞Â≠ê„Å´È†≠„ÇíÊÇ©„Åæ„Åõ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>
<!-- Historically, the biggest difficulty for machine learning with molecules was the choice and computation of "descriptors". Graph neural networks (GNNs) are a category of deep neural networks whose inputs are graphs and provide a way around the choice of descriptors. A GNN can take a molecule directly as input. -->
<div class="admonition- admonition">
<p class="admonition-title">Êú¨Á´†„ÅÆÊÉ≥ÂÆöË™≠ËÄÖ„Å®ÁõÆÁöÑ</p>
<p>„Åì„ÅÆÁ´†„Åß„ÅØ„ÄÅ<a class="reference internal" href="layers.html"><span class="doc">Standard Layers</span></a> „Å® <a class="reference internal" href="../ml/regression.html"><span class="doc">Regression &amp; Model Assessment</span></a> „ÅÆÂÜÖÂÆπ„ÅØÂâçÊèê„Å®„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇÊú¨Á´†„Åß„ÅØ„Ç∞„É©„Éï„ÇÑGNN„ÅÆÂÆöÁæ©„Åã„ÇâË™¨Êòé„Åó„Åæ„Åô„Åå„ÄÅ„Ç∞„É©„Éï„ÇÑ„Éã„É•„Éº„É©„É´„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„ÅÆÂü∫Êú¨ÁöÑ„Å™Ê¶ÇÂøµ„Å´„Å§„ÅÑ„Å¶‰∫à„ÇÅÊÖ£„Çå„Å¶„ÅÑ„Çã„Å®„Å™„ÅäËâØ„ÅÑ„Åß„Åó„Çá„ÅÜ„ÄÇ„Åì„ÅÆÁ´†„ÇíÂ≠¶„Å∂„Åì„Å®„Åß„ÄÅ‰ª•‰∏ã„Åå„Åß„Åç„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åæ„ÅôÔºö</p>
<ul class="simple">
<li><p>ÂàÜÂ≠ê„Çí„Ç∞„É©„Éï„ÅßË°®Áèæ„Åß„Åç„Çã</p></li>
<li><p>‰∏ÄËà¨ÁöÑ„Å™GNN„ÅÆ„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£„ÇíË≠∞Ë´ñ„Åó„Åü„Çä„ÄÅGNN„ÅÆÁ®ÆÈ°û„ÇíÁêÜËß£„Åß„Åç„Çã</p></li>
<li><p>GNN„ÇíÊßãÁØâ„Åó„ÄÅ„É©„Éô„É´„ÅÆÁ®ÆÈ°û„Å´Âøú„Åò„ÅüË™≠„ÅøÂá∫„ÅóÈñ¢Êï∞Ôºàread-out functionÔºâ„ÇíÈÅ∏Êäû„Åß„Åç„Çã</p></li>
<li><p>„Ç∞„É©„Éï„ÄÅ„Ç®„ÉÉ„Ç∏„ÄÅ„Éé„Éº„Éâ„ÅÆÁâπÂæ¥„Çí„Åù„Çå„Åû„ÇåÂå∫Âà•„Åß„Åç„Çã</p></li>
<li><p>GNN„Çí„Ç®„ÉÉ„Ç∏Êõ¥Êñ∞„ÄÅ„Éé„Éº„ÉâÊõ¥Êñ∞„ÄÅÈõÜÁ¥Ñ„ÅÆÂêÑ„Çπ„ÉÜ„ÉÉ„Éó„Å´ÂàÜ„Åë„Å¶ÂÆöÂºèÂåñ„Åß„Åç„Çã</p></li>
</ul>
</div>
<p>GNN„ÅØ„Ç∞„É©„Éï„ÇíÂÖ•Âäõ„Åä„Çà„Å≥Âá∫Âäõ„Åô„Çã„Åü„ÇÅ„Å´ÁâπÂà•„Å´Ë®≠Ë®à„Åï„Çå„Åü„É¨„Ç§„É§„Éº„Åß„Åô„ÄÇGNN„Å´„Å§„ÅÑ„Å¶„ÅÆ„É¨„Éì„É•„Éº„ÅØË§áÊï∞Âü∑Á≠Ü„Åï„Çå„Å¶„Åä„Çä„ÄÅ‰æã„Åà„Å∞ Dwivedi <em>et al.</em><span id="id1">[<a class="reference internal" href="#id98" title="Vijay Prakash Dwivedi, Chaitanya K Joshi, Thomas Laurent, Yoshua Bengio, and Xavier Bresson. Benchmarking graph neural networks. arXiv preprint arXiv:2003.00982, 2020.">DJL+20</a>]</span>, Bronstein <em>et al.</em><span id="id2">[<a class="reference internal" href="#id99" title="Michael M Bronstein, Joan Bruna, Yann LeCun, Arthur Szlam, and Pierre Vandergheynst. Geometric deep learning: going beyond euclidean data. IEEE Signal Processing Magazine, 34(4):18‚Äì42, 2017.">BBL+17</a>]</span>, Wu <em>et al.</em><span id="id3">[<a class="reference internal" href="#id100" title="Zonghan Wu, Shirui Pan, Fengwen Chen, Guodong Long, Chengqi Zhang, and S Yu Philip. A comprehensive survey on graph neural networks. IEEE Transactions on Neural Networks and Learning Systems, 2020.">WPC+20</a>]</span> „Å™„Å©„ÅåÊåô„Åí„Çâ„Çå„Åæ„Åô„ÄÇ
GNN„ÅØ„ÄÅÁ≤óË¶ñÂåñÂàÜÂ≠êÂãïÂäõÂ≠¶„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥ <span id="id4">[<a class="reference internal" href="#id112" title="Zhiheng Li, Geemi P Wellawatte, Maghesree Chakraborty, Heta A Gandhi, Chenliang Xu, and Andrew D White. Graph neural network based coarse-grained mapping prediction. Chemical Science, 11(35):9524‚Äì9531, 2020.">LWC+20</a>]</span> „Åã„ÇâNMR„ÅÆÂåñÂ≠¶„Ç∑„Éï„Éà‰∫àÊ∏¨ <span id="id5">[<a class="reference internal" href="#id113" title="Ziyue Yang, Maghesree Chakraborty, and Andrew D White. Predicting chemical shifts with graph neural networks. bioRxiv, 2020.">YCW20</a>]</span> „ÄÅÂõ∫‰Ωì„ÅÆ„ÉÄ„Ç§„Éä„Éü„ÇØ„Çπ„ÅÆ„É¢„Éá„É™„É≥„Ç∞ <span id="id6">[<a class="reference internal" href="#id59" title="Tian Xie, Arthur France-Lanord, Yanming Wang, Yang Shao-Horn, and Jeffrey C Grossman. Graph dynamical networks for unsupervised learning of atomic scale dynamics in materials. Nature communications, 10(1):1‚Äì9, 2019.">XFLW+19</a>]</span> „Åæ„Åß„ÄÅ„ÅÇ„Çâ„ÇÜ„Çã„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Å´ÈÅ©Áî®„Åß„Åç„Åæ„Åô„ÄÇ
GNN„Å´„Å§„ÅÑ„Å¶Ê∑±„ÅèË∏è„ÅøËæº„ÇÄÂâç„Å´„ÄÅ„Åæ„Åö„Ç∞„É©„Éï„Åå„Ç≥„É≥„Éî„É•„Éº„Çø‰∏ä„Åß„Å©„ÅÆ„Çà„ÅÜ„Å´Ë°®Áèæ„Åï„Çå„ÄÅÂàÜÂ≠ê„Åå„Å©„ÅÆ„Çà„ÅÜ„Å´„Ç∞„É©„Éï„Å´Â§âÊèõ„Åï„Çå„Çã„ÅãÁêÜËß£„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>
<p>„Ç∞„É©„Éï„Å®GNN„Å´„Å§„ÅÑ„Å¶„ÅÆ„Ç§„É≥„Çø„É©„ÇØ„ÉÜ„Ç£„Éñ„Å™ÂÖ•ÈñÄË≥áÊñô„Åå„ÄÅ <a class="reference external" href="https://distill.pub/2021/gnn-intro/">distill.pub</a> <span id="id7">[<a class="reference internal" href="#id195" title="Benjamin Sanchez-Lengeling, Emily Reif, Adam Pearce, and Alex Wiltschko. A gentle introduction to graph neural networks. Distill, 2021. https://distill.pub/2021/gnn-intro. doi:10.23915/distill.00033.">SLRPW21</a>]</span> „ÅßÊèê‰æõ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇÁèæÂú®„ÅÆGNN„ÅÆÁ†îÁ©∂„ÅÆ„Åª„Å®„Çì„Å©„ÅØ„ÄÅ„Ç∞„É©„Éï„Å´ÁâπÂåñ„Åó„Åü„Éá„Ç£„Éº„Éó„É©„Éº„Éã„É≥„Ç∞„É©„Ç§„Éñ„É©„É™„ÇíÁî®„ÅÑ„Å¶Ë°å„Çè„Çå„Å¶„Åä„Çä„ÄÅ2022Âπ¥ÁèæÂú®ÊúÄ„ÇÇ‰ª£Ë°®ÁöÑ„Å™„É©„Ç§„Éñ„É©„É™„ÅØ <a class="reference external" href="https://pytorch-geometric.readthedocs.io/en/latest/">PyTorch Geometric</a>, <a class="reference external" href="https://www.dgl.ai/">Deep Graph library</a>, <a class="reference external" href="https://graphneural.network/">Spektral</a>, <a class="reference external" href="https://github.com/tensorflow/gnn">TensorFlow GNNS</a> „Å™„Å©„Åß„Åô„ÄÇ</p>
<section id="id8">
<h2><span class="section-number">8.1. </span>„Ç∞„É©„Éï„ÅÆË°®Áèæ<a class="headerlink" href="#id8" title="Permalink to this headline">¬∂</a></h2>
<p>„Ç∞„É©„Éï <span class="math notranslate nohighlight">\(\mathbf{G}\)</span> „ÅØ„ÄÅ„Éé„Éº„Éâ <span class="math notranslate nohighlight">\(\mathbf{V}\)</span> „Åä„Çà„Å≥„Ç®„ÉÉ„Ç∏ <span class="math notranslate nohighlight">\(\mathbf{E}\)</span>„ÄÄ„ÅÆÈõÜÂêà„Åß„Åô„ÄÇ Êàë„ÄÖ„ÅÆ„Çª„ÉÉ„ÉÜ„Ç£„É≥„Ç∞„Åß„ÅØ„ÄÅ„Éé„Éº„Éâ <span class="math notranslate nohighlight">\(i\)</span> „ÅØ„Éô„ÇØ„Éà„É´ <span class="math notranslate nohighlight">\(\vec{v}_i\)</span> „ÅßÂÆöÁæ©„Åï„Çå„Çã„ÅÆ„Åß„ÄÅ„Éé„Éº„Éâ„ÅÆÈõÜÂêà„ÅØ„É©„É≥„ÇØ2„ÅÆ„ÉÜ„É≥„ÇΩ„É´„Å®„Åó„Å¶Ë°®Áèæ„Åß„Åç„Åæ„Åô„ÄÇ
„Ç®„ÉÉ„Ç∏„ÅØÈö£Êé•Ë°åÂàóÔºàadjacency matrixÔºâ <span class="math notranslate nohighlight">\(\mathbf{E}\)</span> „ÅßË°®Áèæ„Åï„Çå„ÄÅ„ÇÇ„Åó <span class="math notranslate nohighlight">\(e_{ij} = 1\)</span> „Åß„ÅÇ„Çå„Å∞„Éé„Éº„Éâ <span class="math notranslate nohighlight">\(i\)</span> „Å® <span class="math notranslate nohighlight">\(j\)</span> „Åå„Ç®„ÉÉ„Ç∏„ÅßÁµêÂêà„Åó„Å¶„ÅÑ„Çã„Å®„Åø„Å™„Åï„Çå„Åæ„Åô„ÄÇ
„Ç∞„É©„Éï„ÇíÊâ±„ÅÜÂ§ö„Åè„ÅÆÂàÜÈáé„Å´„Åä„ÅÑ„Å¶„ÄÅÁ∞°Âçò„ÅÆ„Åü„ÇÅ„ÄÅ„Ç∞„É©„Éï„ÅØ„Åó„Å∞„Åó„Å∞ÊúâÂêëÈùûÂ∑°Âõû„Ç∞„É©„ÉïÔºà„Ç®„ÉÉ„Ç∏„Å´„ÅØÂêë„Åç„Åå„ÅÇ„Çã„Åå„ÄÅ‰∏ÄÂë®„Åó„Å¶ÂÖÉ„ÅÆ„Éé„Éº„Éâ„Å´„ÅØÊàª„Çâ„Å™„ÅÑÔºâ„Åß„ÅÇ„Çã„Å®‰ªÆÂÆö„Åï„Çå„Åæ„Åô„ÄÇ„Åó„Åã„Åó„ÄÅÂàÜÂ≠ê„Å´„Åä„ÅÑ„Å¶ÁµêÂêà„Å´„ÅØÂêë„Åç„ÅåÁÑ°„Åè„ÄÅËº™„ÇíÊåÅ„Å§ÔºàÂ∑°Âõû„Åô„ÇãÔºâÂ†¥Âêà„ÇÇ„ÅÇ„Çã„Åì„Å®„Å´Ê≥®ÊÑè„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇÂåñÂ≠¶ÁµêÂêà„Å´„Åä„ÅÑ„Å¶Âêë„Åç„ÅÆÊ¶ÇÂøµ„ÅØ„Å™„ÅÑ„Åì„Å®„Åã„Çâ„ÄÅÊàë„ÄÖ„ÅåÊâ±„ÅÜÈö£Êé•Ë°åÂàó„ÅØÂ∏∏„Å´ÂØæÁß∞Ôºà<span class="math notranslate nohighlight">\(e_{ij} = e_{ji}\)</span>Ôºâ„Å®„Å™„Çä„Åæ„Åô„ÄÇ„Åæ„Åü„ÄÅ„Åó„Å∞„Åó„Å∞„Ç®„ÉÉ„Ç∏Ëá™Ë∫´„ÇÇÁâπÂæ¥„ÇíÊåÅ„Å§Â†¥Âêà„Åå„ÅÇ„Çä„ÄÅ <span class="math notranslate nohighlight">\(e_{ij}\)</span> Ëá™‰Ωì„Çí„Éô„ÇØ„Éà„É´„Å®„Åô„Çã„Åì„Å®„ÅßË°®Áèæ„Åó„Åæ„Åô„ÄÇ„Åì„ÅÆÂ†¥Âêà„ÅØÈö£Êé•Ë°åÂàó„ÅØ„É©„É≥„ÇØ3„ÅÆ„ÉÜ„É≥„ÇΩ„É´„Å®„Å™„Çä„Åæ„Åô„ÄÇ„Ç®„ÉÉ„Ç∏ÁâπÂæ¥„ÅÆ‰æã„Å®„Åó„Å¶„ÅØ„ÄÅÂÖ±ÊúâÁµêÂêà„ÅÆÊ¨°Êï∞„ÇÑ„ÄÅ2„Å§„ÅÆ„Éé„Éº„ÉâÈñì„ÅÆË∑ùÈõ¢ÔºàÔºùÂéüÂ≠êÈñìË∑ùÈõ¢Ôºâ„Å™„Å©„ÅåÊåô„Åí„Çâ„Çå„Åæ„Åô„ÄÇ</p>
<figure class="align-default" id="methanol">
<a class="reference internal image-reference" href="../_images/methanol.jpg"><img alt="../_images/methanol.jpg" src="../_images/methanol.jpg" style="width: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 8.1 </span><span class="caption-text">„Ç∞„É©„Éï„Å´Â§âÊèõ„Åß„Åç„Çã„Çà„ÅÜ„ÄÅ„É°„Çø„Éé„Éº„É´„ÅÆÂêÑÂéüÂ≠ê„Å´Áï™Âè∑„ÇíÂâ≤„ÇäÂΩì„Å¶„Åü</span><a class="headerlink" href="#methanol" title="Permalink to this image">¬∂</a></p>
</figcaption>
</figure>
<aside class="margin sidebar">
<p class="sidebar-title">one-hot</p>
<p>one-hot„Éô„ÇØ„Éà„É´„Å®„ÅØ„ÄÅ1„Å§„ÅÆË¶ÅÁ¥†„Åå1„Åß„ÄÅ„Åù„Çå‰ª•Â§ñ„ÅÆË¶ÅÁ¥†„ÅØÂÖ®„Å¶0„Åß„ÅÇ„Çã„Éô„ÇØ„Éà„É´„ÅÆ„Åì„Å®„Å®ÊÄù„ÅÑÂá∫„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ‰æã„Åà„Å∞ <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1,</span> <span class="pre">0,</span> <span class="pre">0]</span></code>
1„ÅÆË¶ÅÁ¥†„Åå„ÇØ„É©„Çπ„ÇíË°®„Åó„Åæ„Åô„ÄÇ‰ªäÂõû„ÅÆÂ†¥Âêà„ÄÅ„ÇØ„É©„Çπ„Å®„ÅØÂÖÉÁ¥†„ÅÆ„Åì„Å®„Åß„ÅÇ„Çä„ÄÅÂêÑÂéüÂ≠ê„ÅÆÂÖÉÁ¥†„Çíone-hot„Éô„ÇØ„Éà„É´„ÅßË°®„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ</p>
</aside>
<p>„Åß„ÅØ„ÄÅÂàÜÂ≠ê„Åã„Çâ„Å©„ÅÆ„Çà„ÅÜ„Å´„Ç∞„É©„Éï„ÇíÊßãÁØâ„Åß„Åç„Çã„ÅãË¶ã„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ‰æã„Å®„Åó„Å¶„ÄÅ„É°„Çø„Éé„Éº„É´„ÇíËÄÉ„Åà„Åæ„ÅôÔºà <a class="reference internal" href="#methanol"><span class="std std-numref">Fig. 8.1</span></a> Ôºâ„ÄÇ„Éé„Éº„Éâ„Å®„Ç®„ÉÉ„Ç∏„ÇíÂÆöÁæ©„Åô„Çã„Åü„ÇÅ„ÄÅ‰æøÂÆúÁöÑ„Å´ÂêÑÂéüÂ≠ê„Å´Áï™Âè∑„ÇíÊåØ„Çä„Åæ„Åó„Åü„ÄÇ„Åæ„Åö„ÅØ„Åò„ÇÅ„ÅØ„Éé„Éº„ÉâÁâπÂæ¥„ÇíËÄÉ„Åà„Åæ„Åô„ÄÇ„Éé„Éº„Éâ„ÅÆÁâπÂæ¥Èáè„Å´„ÅØ‰Ωï„Çí‰Ωø„Å£„Å¶„ÇÇËâØ„ÅÑ„ÅÆ„Åß„Åô„Åå„ÄÅÂ§ö„Åè„ÅÆÂ†¥Âêà„ÄÅone-hot„Ç®„É≥„Ç≥„Éº„Éá„Ç£„É≥„Ç∞„Åï„Çå„ÅüÁâπÂæ¥„Éô„ÇØ„Éà„É´„Çí‰Ωø„ÅÜ„Åì„Å®„Å´„Å™„Çã„Åß„Åó„Çá„ÅÜÔºö</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Node</p></th>
<th class="head"><p>C</p></th>
<th class="head"><p>H</p></th>
<th class="text-align:right head"><p>O</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>1</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td class="text-align:right"><p>0</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>2</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td class="text-align:right"><p>0</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>3</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td class="text-align:right"><p>0</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>4</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
<td class="text-align:right"><p>0</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>5</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td class="text-align:right"><p>1</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>6</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td class="text-align:right"><p>0</p></td>
</tr>
</tbody>
</table>
<p><span class="math notranslate nohighlight">\(\mathbf{V}\)</span> „Åå„ÄÅ„Åì„Çå„Çâ„ÅÆ„Éé„Éº„Éâ„Å´„Å§„ÅÑ„Å¶„ÅÆÁµêÂêà„Åï„Çå„ÅüÁâπÂæ¥„Éô„ÇØ„Éà„É´„Å´„Å™„Çä„Åæ„Åô„ÄÇ„Åì„ÅÆ„Ç∞„É©„Éï„ÅÆËøëÊé•Ë°åÂàó <span class="math notranslate nohighlight">\(\mathbf{E}\)</span> „ÅØÊ¨°„ÅÆ„Çà„ÅÜ„Å´„Å™„Çã„Åß„Åó„Çá„ÅÜÔºö</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p></p></th>
<th class="head"><p>1</p></th>
<th class="head"><p>2</p></th>
<th class="head"><p>3</p></th>
<th class="head"><p>4</p></th>
<th class="head"><p>5</p></th>
<th class="text-align:right head"><p>6</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>1</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
<td class="text-align:right"><p>0</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>2</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
<td class="text-align:right"><p>0</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>3</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
<td class="text-align:right"><p>0</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>4</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td class="text-align:right"><p>0</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>5</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
<td class="text-align:right"><p>1</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>6</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td class="text-align:right"><p>0</p></td>
</tr>
</tbody>
</table>
<p>Â§öÂ∞ëÊôÇÈñì„Çí„Åã„Åë„Å¶„ÇÇ„Çà„ÅÑ„ÅÆ„Åß„ÄÅ„Åì„Çå„Çâ2„Å§„Çí„Åó„Å£„Åã„Çä„Å®ÁêÜËß£„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ‰æã„Åà„Å∞„ÄÅ1,2,3Ë°åÁõÆ„Å´„Å§„ÅÑ„Å¶„ÅØ„ÄÅ4ÂàóÁõÆ„ÅÆÊàêÂàÜ„Å†„Åë„Åå0„Åß„Å™„ÅÑ„Åì„Å®„Å´Ê≥®ÁõÆ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ„Åì„Çå„ÅØ„ÄÅÂéüÂ≠ê1„Äú3„ÅØÁÇ≠Á¥†ÔºàÂéüÂ≠ê4Ôºâ„Å´„ÅÆ„ÅøÁµêÂêà„Åó„Å¶„ÅÑ„Çã„Åã„Çâ„Åß„Åô„ÄÇ„Åæ„Åü„ÄÅÂéüÂ≠ê„ÅØËá™ÂàÜËá™Ë∫´„Å®„ÅØÁµêÂêà„Åß„Åç„Å™„ÅÑ„ÅÆ„Åß„ÄÅÂØæËßíÊàêÂàÜ„ÅØÂ∏∏„Å´0„Å´„Å™„Çä„Åæ„Åô„ÄÇ</p>
<p>ÂàÜÂ≠ê„Å†„Åë„Åß„Å™„Åè„ÄÅÁµêÊô∂ÊßãÈÄ†„Å´„Å§„ÅÑ„Å¶„ÇÇ‰ºº„ÅüÊñπÊ≥ï„Åß„Ç∞„É©„ÉïÂåñ„Åß„Åç„Åæ„Åô„ÄÇ„Åì„Çå„Å´„Å§„ÅÑ„Å¶„ÅØ Xie et al.„Å´„Çà„Çã <span id="id9">[<a class="reference internal" href="#id136" title="Tian Xie and Jeffrey C. Grossman. Crystal graph convolutional neural networks for an accurate and interpretable prediction of material properties. Phys. Rev. Lett., 120:145301, Apr 2018. URL: https://link.aps.org/doi/10.1103/PhysRevLett.120.145301, doi:10.1103/PhysRevLett.120.145301.">XG18</a>]</span> „ÇíÂèÇÁÖß„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
<p>„Åù„Çå„Åß„ÅØ„ÄÅSMILES„Å´„Çà„ÇãÂàÜÂ≠ê„ÅÆÊñáÂ≠óÂàóË°®Áèæ„Çí„Ç∞„É©„Éï„Å´Â§âÊèõ„Åô„ÇãÈñ¢Êï∞„ÇíÂÆöÁæ©„Åô„Çã„Å®„Åì„Çç„Åã„ÇâÂßã„ÇÅ„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>
</section>
<section id="id10">
<h2><span class="section-number">8.2. </span>„Åì„ÅÆ„Éé„Éº„Éà„Éñ„ÉÉ„ÇØ„ÅÆÂãï„Åã„ÅóÊñπ<a class="headerlink" href="#id10" title="Permalink to this headline">¬∂</a></h2>
<p>„Åì„ÅÆ„Éö„Éº„Ç∏‰∏äÈÉ®„ÅÆ ¬†<i aria-label="Launch interactive content" class="fas fa-rocket"></i>¬† „ÇíÊäº„Åô„Å®„ÄÅ„Åì„ÅÆ„Éé„Éº„Éà„Éñ„ÉÉ„ÇØ„ÅåGoogle Colab.„ÅßÈñã„Åã„Çå„Åæ„Åô„ÄÇÂøÖË¶Å„Å™„Éë„ÉÉ„Ç±„Éº„Ç∏„ÅÆ„Ç§„É≥„Çπ„Éà„Éº„É´ÊñπÊ≥ï„Å´„Å§„ÅÑ„Å¶„ÅØ‰ª•‰∏ã„ÇíÂèÇÁÖß„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
<div class="dropdown admonition tip">
<p class="admonition-title">Tip</p>
<p>ÂøÖË¶Å„Å™„Éë„ÉÉ„Ç±„Éº„Ç∏„Çí„Ç§„É≥„Çπ„Éà„Éº„É´„Åô„Çã„Å´„ÅØ„ÄÅÊñ∞Ë¶è„Çª„É´„Çí‰ΩúÊàê„Åó„Å¶Ê¨°„ÅÆ„Ç≥„Éº„Éâ„ÇíÂÆüË°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!pip install dmol-book
</pre></div>
</div>
<p>„ÇÇ„Åó„Ç§„É≥„Çπ„Éà„Éº„É´„Åå„ÅÜ„Åæ„Åè„ÅÑ„Åã„Å™„ÅÑÂ†¥Âêà„ÄÅ„Éë„ÉÉ„Ç±„Éº„Ç∏„ÅÆ„Éê„Éº„Ç∏„Éß„É≥‰∏ç‰∏ÄËá¥„ÅåÂéüÂõ†„Åß„ÅÇ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÂãï‰ΩúÁ¢∫Ë™ç„Åå„Å®„Çå„ÅüÊúÄÊñ∞„Éê„Éº„Ç∏„Éß„É≥„ÅÆ‰∏ÄË¶ß„ÅØ<a class="reference external" href="https://github.com/whitead/dmol-book/blob/master/package/requirements.txt">„Åì„Åì</a>„Åã„ÇâÂèÇÁÖß„Åß„Åç„Åæ„Åô</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">rdkit</span><span class="o">,</span> <span class="nn">rdkit.Chem</span><span class="o">,</span> <span class="nn">rdkit.Chem.rdDepictor</span><span class="o">,</span> <span class="nn">rdkit.Chem.Draw</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">dmol</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">soldata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s2">&quot;https://github.com/whitead/dmol-book/raw/master/data/curated-solubility-dataset.csv&quot;</span>
<span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">my_elements</span> <span class="o">=</span> <span class="p">{</span><span class="mi">6</span><span class="p">:</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span> <span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;H&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>‰∏ã„ÅÆÈùûË°®Á§∫„Çª„É´„Åß„ÅØ„ÄÅÈñ¢Êï∞ <code class="docutils literal notranslate"><span class="pre">smiles2graph</span></code> „ÇíÂÆöÁæ©„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åì„ÅÆÈñ¢Êï∞„ÅØÂÖÉÁ¥†C, H, O„Å´„Å§„ÅÑ„Å¶one-hot„Å™„Éé„Éº„ÉâÁâπÂæ¥„Éô„ÇØ„Éà„É´„ÇíÁîüÊàê„Åó„Åæ„Åô„ÄÇ„Åæ„ÅüÂêåÊôÇ„Å´„ÄÅ„Åì„ÅÆone-hot„Éô„ÇØ„Éà„É´„ÇíÁâπÂæ¥„Éô„ÇØ„Éà„É´„Å®„Åô„ÇãÈö£Êé•„ÉÜ„É≥„ÇΩ„É´„ÇíÁîüÊàê„Åó„Åæ„Åô„ÄÇ</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">smiles2graph</span><span class="p">(</span><span class="n">sml</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Argument for the RD2NX function should be a valid SMILES sequence</span>
<span class="sd">    returns: the graph</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">rdkit</span><span class="o">.</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">sml</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">rdkit</span><span class="o">.</span><span class="n">Chem</span><span class="o">.</span><span class="n">AddHs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="n">order_string</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">rdkit</span><span class="o">.</span><span class="n">Chem</span><span class="o">.</span><span class="n">rdchem</span><span class="o">.</span><span class="n">BondType</span><span class="o">.</span><span class="n">SINGLE</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">rdkit</span><span class="o">.</span><span class="n">Chem</span><span class="o">.</span><span class="n">rdchem</span><span class="o">.</span><span class="n">BondType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">rdkit</span><span class="o">.</span><span class="n">Chem</span><span class="o">.</span><span class="n">rdchem</span><span class="o">.</span><span class="n">BondType</span><span class="o">.</span><span class="n">TRIPLE</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">rdkit</span><span class="o">.</span><span class="n">Chem</span><span class="o">.</span><span class="n">rdchem</span><span class="o">.</span><span class="n">BondType</span><span class="o">.</span><span class="n">AROMATIC</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">()))</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">my_elements</span><span class="p">)))</span>
    <span class="n">lookup</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">my_elements</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">():</span>
        <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">GetIdx</span><span class="p">(),</span> <span class="n">lookup</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">GetAtomicNum</span><span class="p">())]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">adj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">GetBonds</span><span class="p">():</span>
        <span class="n">u</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">GetBeginAtomIdx</span><span class="p">(),</span> <span class="n">j</span><span class="o">.</span><span class="n">GetEndAtomIdx</span><span class="p">())</span>
        <span class="n">v</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">GetBeginAtomIdx</span><span class="p">(),</span> <span class="n">j</span><span class="o">.</span><span class="n">GetEndAtomIdx</span><span class="p">())</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">GetBondType</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">order</span> <span class="ow">in</span> <span class="n">order_string</span><span class="p">:</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">order_string</span><span class="p">[</span><span class="n">order</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s2">&quot;Ignoring bond order&quot;</span> <span class="o">+</span> <span class="n">order</span><span class="p">)</span>
        <span class="n">adj</span><span class="p">[</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">order</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">adj</span><span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">order</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">adj</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nodes</span><span class="p">,</span> <span class="n">adj</span> <span class="o">=</span> <span class="n">smiles2graph</span><span class="p">(</span><span class="s2">&quot;CO&quot;</span><span class="p">)</span>
<span class="n">nodes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1., 0., 0.],
       [0., 1., 0.],
       [0., 0., 1.],
       [0., 0., 1.],
       [0., 0., 1.],
       [0., 0., 1.]])
</pre></div>
</div>
</div>
</div>
</section>
<section id="id11">
<h2><span class="section-number">8.3. </span>„Ç∞„É©„Éï„Éã„É•„Éº„É©„É´„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ<a class="headerlink" href="#id11" title="Permalink to this headline">¬∂</a></h2>
<p>„Ç∞„É©„Éï„Éã„É•„Éº„É©„É´„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ (GNN) „ÅØ„ÄÅÊ¨°„ÅÆ2„Å§„ÅÆÁâπÂæ¥„ÇíÊåÅ„Å§„Éã„É•„Éº„É©„É´„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Åß„Åô„ÄÇ</p>
<ol class="simple">
<li><p>ÂÖ•Âäõ„Åå„Ç∞„É©„Éï„Åß„ÅÇ„Çã</p></li>
<li><p>Âá∫Âäõ„ÅØÈ†ÜÂ∫èÁ≠â‰æ°Ôºàpermutation equivariantÔºâ„Åß„ÅÇ„Çã</p></li>
</ol>
<p>ÊúÄÂàù„ÅÆÁÇπ„ÅØÊòé„Çâ„Åã„Åß„Åô„Åå„ÄÅ2„Å§„ÇÅ„ÅÆÁâπÂæ¥„ÅØË™¨Êòé„ÅåÂøÖË¶Å„Åß„Åó„Çá„ÅÜ„ÄÇ„Åæ„Åö„ÄÅ„Ç∞„É©„Éï„ÅÆ‰∏¶„ÅπÊõø„Åà„Å®„ÅØ„ÄÅ„Éé„Éº„Éâ„Çí‰∏¶„ÅπÊõø„Åà„Çã„Åì„Å®„ÇíÊÑèÂë≥„Åó„Åæ„Åô„ÄÇ
‰∏ä„ÅÆ„É°„Çø„Éé„Éº„É´„ÅÆ‰æã„Åß„ÅØ„ÄÅÁÇ≠Á¥†„ÇíÂéüÂ≠ê4„Åß„ÅØ„Å™„ÅèÂéüÂ≠ê1„Å´„Åô„Çã„Åì„Å®„ÇÇÁ∞°Âçò„Å´„Åß„Åç„Åæ„Åô„ÄÇ„Åù„ÅÆÂ†¥Âêà„ÄÅÊñ∞„Åó„ÅÑÈö£Êé•Ë°åÂàó„ÅØÊ¨°„ÅÆ„Çà„ÅÜ„Å´„Å™„Çä„Åæ„ÅôÔºö</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p></p></th>
<th class="head"><p>1</p></th>
<th class="head"><p>2</p></th>
<th class="head"><p>3</p></th>
<th class="head"><p>4</p></th>
<th class="head"><p>5</p></th>
<th class="text-align:right head"><p>6</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>1</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td class="text-align:right"><p>0</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>2</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td class="text-align:right"><p>0</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>3</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td class="text-align:right"><p>0</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>4</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td class="text-align:right"><p>0</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>5</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td class="text-align:right"><p>1</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>6</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td class="text-align:right"><p>0</p></td>
</tr>
</tbody>
</table>
<p>„Åì„ÅÆÈö£Êé•Ë°åÂàó„ÅÆ‰∫§Êèõ„Å´Ê≠£„Åó„ÅèÂØæÂøú„Åó„Å¶GNN„ÅÆÂá∫Âäõ„ÅåÂ§âÊèõ„Åô„Çã„Å™„Çâ„ÄÅ„Åù„ÅÆGNN„ÅØÈ†ÜÂ∫èÁ≠â‰æ°„Åß„ÅÇ„Çã„Å®Ë®Ä„Åà„Åæ„Åô„ÄÇÈÉ®ÂàÜÈõªËç∑„ÇÑÂåñÂ≠¶„Ç∑„Éï„Éà„ÅÆ„Çà„ÅÜ„Å´ÂéüÂ≠ê„Åî„Å®„Å´ÂÆöÁæ©„Åï„Çå„ÇãÈáè„Çí„É¢„Éá„É™„É≥„Ç∞„Åô„ÇãÂ†¥Âêà„ÄÅ„Åì„ÅÆ„Çà„ÅÜ„Å™È†ÜÂ∫è‰∏çÂ§â„ÅÆ‰ªïÁµÑ„Åø„ÅØ‰∏çÂèØÊ¨†„Åß„Åô„ÄÇ„Å§„Åæ„Çä„ÄÅ„ÇÇ„ÅóÂéüÂ≠ê„ÇíÂÖ•Âäõ„Åô„ÇãÈ†ÜÂ∫è„ÇíÂ§â„Åà„Çå„Å∞„ÄÅ‰∫àÊ∏¨„Åï„Çå„ÇãÈÉ®ÂàÜÈõªËç∑„ÅÆÈ†ÜÂ∫è„ÇÇÂêåÊßò„Å´Â§â„Çè„Å£„Å¶„Åª„Åó„ÅÑ„ÅÆ„Åß„Åô„ÄÇ</p>
<p>„ÇÇ„Å°„Çç„Çì„ÄÅÊ∫∂Ëß£Â∫¶„ÇÑ„Ç®„Éç„É´„ÇÆ„Éº„ÅÆ„Çà„ÅÜ„Å´ÂàÜÂ≠êÂÖ®‰Ωì„ÅÆÁâπÊÄß„Çí„É¢„Éá„É™„É≥„Ç∞„Åó„Åü„ÅÑÂ†¥Âêà„ÇÇ„ÅÇ„Çä„Åæ„Åô„ÄÇ„Åì„Çå„Çâ„ÅÆÈáè„ÅØÂéüÂ≠ê„ÅÆÈ†ÜÁï™„ÇíÂ§â„Åà„Å¶„ÇÇ <strong>‰∏çÂ§âÔºàinvariantÔºâ</strong> „Åß„ÅÇ„Çã„Åπ„Åç„Åß„Åô„ÄÇÈ†ÜÂ∫è„Å´„Å§„ÅÑ„Å¶Á≠â‰æ°ÔºàequivariantÔºâ„Å™„É¢„Éá„É´„Çí‰∏çÂ§âÔºàinvariantÔºâ„Å´„Åô„Çã„Åü„ÇÅ„ÄÅÂæå„Å´ÂÆöÁæ©„Åô„Çã„É™„Éº„Éâ„Ç¢„Ç¶„ÉàÔºàread-outÔºâ„Çí‰Ωø„ÅÑ„Åæ„Åô„ÄÇÁ≠â‰æ°ÊÄß„Å´„Å§„ÅÑ„Å¶„ÅÆ„Çà„ÇäË©≥Á¥∞„Å™Ë≠∞Ë´ñ„ÅØ <a class="reference internal" href="data.html"><span class="doc">Input Data &amp; Equivariances</span></a> „ÇíÂèÇÁÖß„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
<section id="gnn">
<h3><span class="section-number">8.3.1. </span>„Ç∑„É≥„Éó„É´„Å™GNN<a class="headerlink" href="#gnn" title="Permalink to this headline">¬∂</a></h3>
<p>Êàë„ÄÖ„ÅØ„Åì„Çå„Åã„ÇâGNN„Å´Ë®ÄÂèä„Åó„Åæ„Åô„Åå„ÄÅÂÆüÈöõ„Å´„ÅØGNNÂÖ®‰Ωì„Åß„ÅØ„Å™„ÅèÁâπÂÆö„ÅÆ„É¨„Ç§„É§„Éº„ÅÆ„Åì„Å®„ÇíÊåá„Åó„Åæ„Åô„ÄÇÂ§ö„Åè„ÅÆGNN„ÅØ„Ç∞„É©„Éï„ÇíÂèñ„ÇäÊâ±„ÅÜ„Åü„ÇÅ„Å´ÁâπÂà•„Å´Ë®≠Ë®à„Åï„Çå„Åü„É¨„Ç§„É§„Éº„ÇíÂÇô„Åà„Å¶„Åä„Çä„ÄÅÈÄöÂ∏∏„ÅØ„Åì„ÅÆ„É¨„Ç§„É§„Éº„Å´„Å§„ÅÑ„Å¶„ÅÆ„ÅøÈñ¢ÂøÉ„ÇíÊåÅ„Å°„Åæ„Åô„ÄÇ„Åù„Çå„Åß„ÅØ„ÄÅGNN„ÅÆÁ∞°Âçò„Å™„É¨„Ç§„É§„Éº„ÅÆ‰æã„ÇíË¶ã„Å¶„Åø„Åæ„Åó„Çá„ÅÜ:</p>
<div class="amsmath math notranslate nohighlight" id="equation-d6dfebc7-5478-42c1-bed9-1d0ac1ee48a0">
<span class="eqno">(8.1)<a class="headerlink" href="#equation-d6dfebc7-5478-42c1-bed9-1d0ac1ee48a0" title="Permalink to this equation">¬∂</a></span>\[\begin{equation}
f_k = \sigma\left( \sum_i \sum_j v_{ij}w_{jk}  \right)
\end{equation}\]</div>
<p>„Åì„ÅÆÂºè„ÅØ„ÄÅ„Åæ„ÅöÂêÑ„Éé„Éº„ÉâÔºà<span class="math notranslate nohighlight">\(v_{jij}\)</span>Ôºâ„ÅÆÁâπÂæ¥„Å´Â≠¶ÁøíÂèØËÉΩ„Å™Èáç„Åø <span class="math notranslate nohighlight">\(w_{jk}\)</span> „Çí„Åã„Åë„ÅüÂæå„ÄÅÂÖ®„Å¶„ÅÆ„Éé„Éº„Éâ„ÅÆÁâπÂæ¥„ÇíÂêàË®à„Åó„ÄÅÊ¥ªÊÄßÂåñ„ÇíÈÅ©Áî®„Åô„Çã„Åì„Å®„ÇíË°®„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åì„ÅÆÊìç‰Ωú„Å´„Çà„Çä„ÄÅ„Ç∞„É©„Éï„Å´ÂØæ„Åó„Å¶1„Å§„ÅÆÁâπÂæ¥„Éô„ÇØ„Éà„É´„ÅåÂæó„Çâ„Çå„Åæ„Åô„ÄÇ„Åß„ÅØ„ÄÅ„Åì„ÅÆÂºè„ÅØÈ†ÜÂ∫èÁ≠â‰æ°„Åß„Åó„Çá„ÅÜ„ÅãÔºüÁ≠î„Åà„ÅØYes„Åß„Åô„ÄÇ„Å™„Åú„Å™„Çâ„Åì„ÅÆÂºè„Å´„Åä„ÅÑ„Å¶„Éé„Éº„Éâ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„ÅØ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ <span class="math notranslate nohighlight">\(i\)</span> „Åß„ÅÇ„Çä„ÄÅÂá∫Âäõ„Å´ÂΩ±Èüø„Çí‰∏é„Åà„Çã„Åì„Å®„Å™„ÅèÈ†ÜÂ∫è„ÅÆ‰∏¶„ÅπÊõø„Åà„ÅåÂèØËÉΩ„Åß„ÅÇ„Çã„Åü„ÇÅ„Åß„Åô„ÄÇ</p>
<p>„Åß„ÅØÊ¨°„Å´„ÄÅ„Åì„ÅÆ‰æã„Å®‰ºº„Å¶„ÅÑ„Çã„ÅåÈ†ÜÂ∫èÁ≠â‰æ°„Åß„ÅØ„Å™„ÅÑ‰æã„ÇíË¶ã„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>
<div class="amsmath math notranslate nohighlight" id="equation-7efd834e-1cc7-4431-8380-6b0814a497db">
<span class="eqno">(8.2)<a class="headerlink" href="#equation-7efd834e-1cc7-4431-8380-6b0814a497db" title="Permalink to this equation">¬∂</a></span>\[\begin{equation}
f_k = \sigma\left( \sum_i v_{ij}w_{ik}  \right)
\end{equation}\]</div>
<p>„Åì„Çå„ÅØÂ∞è„Åï„Å™Â§âÂåñ„Åß„Åô„ÄÇ„ÅÑ„Åæ„ÄÅ„Éé„Éº„Éâ„Åî„Å®„Å´1„Å§„ÅÆÈáç„Åø„Éô„ÇØ„Éà„É´„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ„Åó„Åü„Åå„Å£„Å¶„ÄÅÂ≠¶ÁøíÂèØËÉΩ„Å™Èáç„Åø„ÅØ„Éé„Éº„Éâ„ÅÆÈ†ÜÂ∫è„Å´‰æùÂ≠ò„Åó„Åæ„Åô„ÄÇÊ¨°„Å´„ÄÅ„Éé„Éº„Éâ„ÅÆÈ†ÜÂ∫è„ÇíÂÖ•„ÇåÊõø„Åà„Çã„Å®„ÄÅÂ≠¶Áøí„Åó„ÅüÈáç„Åø„ÅØ„Éé„Éº„Éâ„Å´ÂØæÂøú„Åó„Å™„Åè„Å™„Çä„Åæ„Åô„ÄÇ„Çà„Å£„Å¶„ÄÅ„Éé„Éº„ÉâÔºàÔºùÂéüÂ≠êÔºâ„ÅÆÈ†ÜÁï™„ÇíÂ§â„Åà„Åü2„Å§„ÅÆ„É°„Çø„Éé„Éº„É´ÂàÜÂ≠ê„ÇíÂÖ•Âäõ„Åô„Çã„Å®„ÄÅÁï∞„Å™„ÇãÂá∫Âäõ„ÅåÂæó„Çâ„Çå„Åæ„Åô„ÄÇÂÆüÈöõ„ÅÆ„Å®„Åì„Çç„ÄÅ„Åì„ÅÆÂçòÁ¥î„Å™‰æã„ÅØ2„Å§„ÅÆÁÇπ„ÅßÂÆüÈöõ„ÅÆGNN„Å®Áï∞„Å™„Çä„Åæ„Åô„ÄÇ1„Å§„ÇÅ„ÅØÂçò‰∏Ä„ÅÆÁâπÂæ¥„Éô„ÇØ„Éà„É´„ÇíÂá∫Âäõ„Åó„Å¶„Éé„Éº„Éâ„Åî„Å®„ÅÆÊÉÖÂ†±„ÇíÊç®„Å¶„Å¶„Åó„Åæ„Å£„Å¶„ÅÑ„ÇãÁÇπ„ÄÅ2„Å§„ÇÅ„ÅØÈö£Êé•Ë°åÂàó„Çí‰ΩøÁî®„Åó„Å™„ÅÑÁÇπ„Åß„Åô„ÄÇ„Åß„ÅØ„ÄÅÈ†ÜÂ∫èÁ≠â‰æ°„ÇíÁ∂≠ÊåÅ„Åó„ÄÅ„Åã„Å§„Åì„Çå„Çâ2„Å§„ÅÆÊÄßË≥™„ÇíÂÇô„Åà„ÅüÂÆüÈöõ„ÅÆGNN„ÇíË¶ã„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>
</section>
</section>
<section id="kipf-welling-gcn">
<h2><span class="section-number">8.4. </span>Kipf &amp; Welling GCN<a class="headerlink" href="#kipf-welling-gcn" title="Permalink to this headline">¬∂</a></h2>
<p>ÂàùÊúü„Å´‰∫∫Ê∞ó„Åå„ÅÇ„Å£„ÅüGNN„ÅÆ‰∏Ä„Å§„ÅØ„ÄÅKipf &amp; Welling graph convolutional network (GCN) <span id="id12">[<a class="reference internal" href="#id77" title="Thomas N Kipf and Max Welling. Semi-supervised classification with graph convolutional networks. arXiv preprint arXiv:1609.02907, 2016.">KW16</a>]</span> „Åß„Åô„ÄÇGCN„ÇíGNN„ÅÆÂ∫É„ÅÑ„ÇØ„É©„Çπ„ÅÆ‰∏Ä„Å§„Å®„Åó„Å¶ËÄÉ„Åà„Çã‰∫∫„ÇÇ„ÅÑ„Åæ„Åô„Åå„ÄÅÊú¨Êõ∏„ÅßGCN„Å®„ÅØÁâπ„Å´Kipf &amp; Welling GCN„ÇíÊåá„Åô„ÇÇ„ÅÆ„Å®„Åó„Åæ„Åô„ÄÇ
Thomas Kipf„ÅØ„ÄÅ<a class="reference external" href="https://tkipf.github.io/graph-convolutional-networks/">GCN„ÅÆÂÑ™„Çå„ÅüÁ¥π‰ªãË®ò‰∫ã</a>„ÇíÊõ∏„ÅÑ„Å¶„ÅÑ„Åæ„Åô„ÄÇ</p>
<p>GCN„É¨„Ç§„É§„Éº„Å∏„ÅÆÂÖ•Âäõ„ÅØ„Éé„Éº„Éâ„Åä„Çà„Å≥„Ç®„ÉÉ„Ç∏„ÅÆÈõÜÂêàÔºàË®≥Ê≥®ÔºöÂêÑ„Éé„Éº„Éâ„Åä„Çà„Å≥„Ç®„ÉÉ„Ç∏„ÅØ„Éô„ÇØ„Éà„É´„ÅßË°®Áèæ„Åï„Çå„Çã„ÅÆ„Åß„ÄÅ„Åì„Çå„Çâ„ÅÆÈõÜÂêà„ÅØ„ÉÜ„É≥„ÇΩ„É´„Åß„ÅôÔºâ <span class="math notranslate nohighlight">\(\mathbf{V}\)</span>, <span class="math notranslate nohighlight">\(\mathbf{E}\)</span> „Åß„ÄÅÂá∫Âäõ„ÅØÊõ¥Êñ∞„Åï„Çå„Åü„Éé„Éº„Éâ„ÅÆÈõÜÂêà <span class="math notranslate nohighlight">\(\mathbf{V}'\)</span> „Åß„Åô„ÄÇ ÂêÑ„Éé„Éº„ÉâÁâπÂæ¥„ÅÆÊõ¥Êñ∞„ÅØ„ÄÅ <span class="math notranslate nohighlight">\(\mathbf{E}\)</span> „Å´„Çà„ÇäË°®Áèæ„Åï„Çå„ÇãËøëÂÇç„Éé„Éº„Éâ„ÅÆÁâπÂæ¥„Éô„ÇØ„Éà„É´„ÇíÂπ≥Âùá„Åô„Çã„Åì„Å®„Åß„Å™„Åï„Çå„Åæ„Åô„ÄÇ</p>
<!-- todo: E„Å´„Å§„ÅÑ„Å¶„ÅÆË®òËø∞„ÇíË™§Ë™≠„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÅãË¶ãÁõ¥„Åô„ÄÇÂéüÊñá„ÅØ The way it updates a node feature vector is by averaging the feature vectors of its neighbors, as determined by $\mathbf{E}$. -->
<p>ËøëÂÇç„Éé„Éº„Éâ„ÅÆÊÉÖÂ†±„ÇíÂπ≥Âùá„Åô„Çã„Åì„Å®„Åß„ÄÅGCN„É¨„Ç§„É§„Éº„ÅØ„Éé„Éº„Éâ„Å´„Å§„ÅÑ„Å¶È†ÜÂ∫èÁ≠â‰æ°„Å´„Å™„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇËøëÂÇç„Å´„Å§„ÅÑ„Å¶Âπ≥Âùá„Åô„Çã„Å®„ÅÑ„ÅÜÊìç‰Ωú„Åù„ÅÆ„ÇÇ„ÅÆ„ÅØÂ≠¶Áøí„Åß„Åç„Å™„ÅÑ„ÅÆ„Åß„ÄÅÁâπÂæ¥„Éô„ÇØ„Éà„É´„ÇíÂä†ÁÆó„Åó„Å¶„Åã„Çâ„Éé„Éº„Éâ„ÅÆÊ¨°Êï∞ÔºàÁµêÂêà„Åó„Å¶„ÅÑ„ÇãËøëÂÇç„Éé„Éº„ÉâÊï∞Ôºâ„ÅßÈô§ÁÆó„Åô„Çã„Åì„Å®„ÅßË®àÁÆó„Åó„Åæ„Åô„ÄÇÂπ≥Âùá„Çí„Å®„ÇãÂâç„Å´„ÄÅÂ≠¶ÁøíÂèØËÉΩ„Å™Èáç„ÅøË°åÂàó„ÇíËøëÂÇçÁâπÂæ¥„Å´Êéõ„Åë„Çã„Åì„Å®„Å´„Åó„Åæ„Åô„ÄÇ„Åì„Çå„Å´„Çà„ÇäGCN„Åå„Éá„Éº„Çø„Åã„ÇâÂ≠¶Áøí„Åô„Çã„Åì„Å®„ÅåÂèØËÉΩ„Å´„Å™„Çä„Åæ„ÅôÔºàË®≥Ê≥®ÔºöË®Ä„ÅÑÊèõ„Åà„Çå„Å∞„ÄÅGCN„ÅÆÂ≠¶Áøí„Å®„ÅØ„Åì„ÅÆÈáç„ÅøË°åÂàó„ÅÆË¶ÅÁ¥†„ÇíÊúÄÈÅ©Âåñ„Åô„Çã„Åì„Å®„Åß„ÅôÔºâ„ÄÇ„Åì„ÅÆÊìç‰Ωú„ÅØÊ¨°„ÅÆ„Çà„ÅÜ„Å´Ë®òËø∞„Åï„Çå„Åæ„ÅôÔºö</p>
<div class="math notranslate nohighlight" id="equation-gcn">
<span class="eqno">(8.3)<a class="headerlink" href="#equation-gcn" title="Permalink to this equation">¬∂</a></span>\[
v_{il} = \sigma\left(\frac{1}{d_i}e_{ij}v_{jk}w_{lk}\right)
\]</div>
<p><span class="math notranslate nohighlight">\(i\)</span> „ÅØÁùÄÁõÆ„Åó„Å¶„ÅÑ„Çã„Éé„Éº„Éâ„ÄÅ <span class="math notranslate nohighlight">\(j\)</span> „ÅØ„Åù„ÅÆËøëÂÇç„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ, <span class="math notranslate nohighlight">\(k\)</span> „ÅØ„Éé„Éº„Éâ„ÅÆÂÖ•ÂäõÁâπÂæ¥„ÄÅ <span class="math notranslate nohighlight">\(l\)</span> „ÅØ„Éé„Éº„Éâ„ÅÆÂá∫ÂäõÁâπÂæ¥„ÄÅ <span class="math notranslate nohighlight">\(d_i\)</span> „ÅØ„Éé„Éº„Éâ„ÅÆÊ¨°Êï∞ÔºàÊ¨°Êï∞„ÅßÂâ≤„Çã„Åì„Å®„ÅßÂçò„Å™„ÇãÂä†ÁÆó„Åß„ÅØ„Å™„ÅèÂπ≥Âùá„Å´„Å™„Çä„Åæ„ÅôÔºâ„ÄÅ <span class="math notranslate nohighlight">\(e_{ij}\)</span> „ÅØ„ÄÅÂÖ®„Å¶„ÅÆÈùûËøëÂÇç„Éé„Éº„Éâ„Åå <span class="math notranslate nohighlight">\(v_{jk}\)</span> „Çº„É≠„Å´„Å™„Çã„Çà„ÅÜËøëÂÇç„Å®ÈùûËøëÂÇç„Éé„Éº„Éâ„ÇíÂàÜÈõ¢„Åô„ÇãÈ†Ö„ÄÅ <span class="math notranslate nohighlight">\(\sigma\)</span> „ÅØÊ¥ªÊÄßÂåñÈñ¢Êï∞„ÄÅ <span class="math notranslate nohighlight">\(w_{lk}\)</span> „ÅØÂ≠¶ÁøíÂèØËÉΩ„Å™Èáç„Åø„Åß„Åô„ÄÇ
„Åì„ÅÆÂºè„ÅØ„Å®„Å¶„ÇÇÈï∑„ÅÑ„Çà„ÅÜ„Å´Ë¶ã„Åà„Åæ„Åô„Åå„ÄÅÂÆüÈöõ„Å´„ÇÑ„Å£„Å¶„ÅÑ„Çã„Åì„Å®„ÅØ„ÄÅËøëÂÇçÂêåÂ£´„ÅÆÂπ≥Âùá„Å´Â≠¶ÁøíÂèØËÉΩ„Å™Èáç„ÅøË°åÂàó„ÇíËøΩÂä†„Åó„Åü„Å†„Åë„Åß„Åô„ÄÇ„Åì„ÅÆÂºè„ÅÆ„Çà„Åè„ÅÇ„ÇãÊã°Âºµ„Å®„Åó„Å¶„ÄÅÂêÑ„Éé„Éº„Éâ„ÅÆËøëÂÇç„Å®„Åó„Å¶Ëá™ÂàÜËá™Ë∫´„ÇÇÂä†„Åà„ÇãÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ„Åì„Çå„ÅØ„Éé„Éº„Éâ„ÅÆÂá∫ÂäõÁâπÂæ¥ <span class="math notranslate nohighlight">\(v_{il}\)</span> „ÅåÂÖ•ÂäõÁâπÂæ¥ <span class="math notranslate nohighlight">\(v_{ik}\)</span> „Å´‰æùÂ≠ò„Åô„Çã„Çà„ÅÜ„Å´„Åô„Çã„Åü„ÇÅ„Åß„Åô„ÄÇ„Åó„Åã„Åó„ÄÅÊàë„ÄÖ„ÅØ„Åì„ÅÆ„Åü„ÇÅ„Å´‰∏ä„ÅÆÂºè„Çí‰øÆÊ≠£„Åô„ÇãÂøÖË¶Å„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ„ÇÇ„Å£„Å®„Ç∑„É≥„Éó„É´„Å™„ÇÑ„ÇäÊñπ„Å®„Åó„Å¶„ÄÅ„Éá„Éº„Çø„ÅÆÂâçÂá¶ÁêÜ„ÅßÊÅíÁ≠âË°åÂàó„ÇíÂä†ÁÆó„Åó„ÄÅËøëÊé•Ë°åÂàó„ÅÆÂØæËßíÊàêÂàÜ„Çí <span class="math notranslate nohighlight">\(0\)</span> „Åß„ÅØ„Å™„Åè<span class="math notranslate nohighlight">\(1\)</span> „Å´„Åó„Å¶„ÇÑ„Çå„Å∞„Çà„ÅÑ„ÅÆ„Åß„Åô„ÄÇ</p>
<p>GCN„Å´„Å§„ÅÑ„Å¶„ÅÆÁêÜËß£„ÇíÊ∑±„ÇÅ„Çã„Åì„Å®„ÅØ„ÄÅ‰ªñ„ÅÆÁ®ÆÈ°û„ÅÆGNN„ÇíÁêÜËß£„Åô„Çã„Åü„ÇÅ„Å´ÈáçË¶Å„Åß„Åô„ÄÇ„Åì„Åì„Åß„ÅØ2„Å§„ÅÆ„Éù„Ç§„É≥„Éà„ÇíÊäº„Åï„Åà„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ„Åæ„ÅöGCN„É¨„Ç§„É§„Éº„ÅØ„ÄÅ„Éé„Éº„Éâ„Å®„Åù„ÅÆËøëÂÇç„ÅÆÈñì„Åß‚ÄùÈÄö‰ø°‚Äù„Åô„ÇãÊñπÊ≥ï„Å®Ë¶ã„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ„Éé„Éº„Éâ <span class="math notranslate nohighlight">\(i\)</span> „Å´„Å§„ÅÑ„Å¶„ÅÆÂá∫Âäõ„ÅØ„ÄÅ„Åù„ÅÆ„Åô„ÅêÈö£„ÅÆ„Éé„Éº„Éâ„Å´„ÅÆ„Åø‰æùÂ≠ò„Åô„Çã„Åì„Å®„Å´„Å™„Çä„Åæ„Åô„Åå„ÄÅÂåñÂ≠¶„ÅÆÂ†¥Âêà„ÄÅ„Åì„Çå„Åß„ÅØ‰∏çÂçÅÂàÜ„Åß„Åô„ÄÇ„Çà„ÇäÈÅ†Êñπ„ÅÆ„Éé„Éº„Éâ„ÅÆÊÉÖÂ†±„ÇíÂèñ„ÇäËæº„ÇÄ„Åü„ÇÅ„Å´„ÄÅÊàë„ÄÖ„ÅØË§áÊï∞„ÅÆGCN„É¨„Ç§„É§„Éº„ÇíÈáç„Å≠„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ„ÇÇ„Åó2„Å§„ÅÆGCN„É¨„Ç§„É§„Éº„Åå„ÅÇ„Çå„Å∞„ÄÅ„Éé„Éº„Éâ <span class="math notranslate nohighlight">\(i\)</span> „ÅÆÂá∫Âäõ„ÅØ„ÄÅ„Åù„ÅÆÈö£„ÅÆÈö£„ÅÆ„Éé„Éº„Éâ„ÅÆÊÉÖÂ†±„ÇÇÂê´„ÇÄ„Åì„Å®„Å´„Å™„Çä„Åæ„Åô„ÄÇ
GCN„ÅßÁêÜËß£„Åô„Åπ„Åç„ÇÇ„ÅÜ‰∏Ä„Å§„ÅÆÁÇπ„ÅØ„ÄÅ„Éé„Éº„ÉâÁâπÂæ¥„ÇíÂπ≥ÂùáÂåñ„Åô„Çã„Çπ„ÉÜ„ÉÉ„Éó„Åå2„Å§„ÅÆÁõÆÁöÑ„ÇíÈÅî„Åó„Å¶„ÅÑ„Çã„Åì„Å®„Åß„ÅôÔºöi)ËøëÂÇç„Éé„Éº„Éâ„ÅÆÈ†ÜÂ∫è„ÇíÁÑ°Ë¶ñ„Åô„Çã„Åì„Å®„ÅßÈ†ÜÂ∫è„Å´ÂØæ„Åó„Å¶Á≠â‰æ°„Å®„Å™„Çã„ÄÅii)„Éé„Éº„ÉâÁâπÂæ¥„ÅÆ„Éá„Éº„Çø„ÅÆ„Çπ„Ç±„Éº„É´Â§âÂåñ„ÇíÈò≤„Åê„ÄÇÂçò„Å´„Éé„Éº„ÉâÁâπÂæ¥„ÅÆÂíå„ÇíÂèñ„Å£„ÅüÂ†¥Âêà„ÄÅ(i)„ÅØÂÆüÁèæ„Åó„Åæ„Åô„Åå„ÄÅÂêÑ„É¨„Ç§„É§„Éº„ÇíÈÄö„Åô„Åî„Å®„Å´„Éé„Éº„ÉâÁâπÂæ¥„ÅÆ„Éá„Éº„Çø„ÅÆÂÄ§„ÅåÂ§ß„Åç„Åè„Å™„Å£„Å¶„Åó„Åæ„ÅÑ„Åæ„Åô„ÄÇ„ÇÇ„Å°„Çç„Çì„ÄÅÁâπÂæ¥„ÅÆ„Çπ„Ç±„Éº„É´„ÇíÊèÉ„Åà„Çã„Åü„ÇÅ„Å´ÂêÑGCN„É¨„Ç§„É§„Éº„ÅÆÂæå„Åß„Éê„ÉÉ„ÉÅÂπ≥ÂùáÂåñÔºàbatch normalizationÔºâ„É¨„Ç§„É§„Éº„ÇíÈÄö„Åô„Å®„ÅÑ„ÅÜÂØæÂá¶„ÇÇ„ÅÇ„Çä„Åæ„Åô„Åå„ÄÅÂπ≥ÂùáÂåñ„ÅØ„Çà„Çä„Ç∑„É≥„Éó„É´„Åß„Åô„ÄÇ</p>
<figure class="align-default" id="dframe">
<div class="cell_output docutils container">
<img alt="../_images/gnn_11_0.png" src="../_images/gnn_11_0.png" />
</div>
<figcaption>
<p><span class="caption-number">Fig. 8.2 </span><span class="caption-text">„Ç∞„É©„ÉïÁï≥„ÅøËæº„Åø„É¨„Ç§„É§„Éº„ÅÆ‰∏≠Èñì„Çπ„ÉÜ„ÉÉ„Éó„ÄÇ3Ê¨°ÂÖÉ„Éô„ÇØ„Éà„É´„ÅØ„Éé„Éº„ÉâÁâπÂæ¥„Åß„ÅÇ„Çä„ÄÅÂàùÊúüÂÄ§„ÅØÊ∞¥Á¥†„ÇíË°®„Åôone-hot„Éô„ÇØ„Éà„É´ <code class="docutils literal notranslate"><span class="pre">[1.00,</span> <span class="pre">0.00,</span> <span class="pre">0.00]</span></code> „Åß„Åô„ÄÇ„Åì„ÅÆ‰∏≠ÂøÉ„Éé„Éº„Éâ„ÅØ„ÄÅÈö£Êé•„Åô„Çã„Éé„Éº„Éâ„ÅÆÁâπÂæ¥„ÇíÂπ≥Âùá„Åô„Çã„Åì„Å®„ÅßÊõ¥Êñ∞„Åï„Çå„Å¶„ÅÑ„Åç„Åæ„Åô„ÄÇ</span><a class="headerlink" href="#dframe" title="Permalink to this image">¬∂</a></p>
</figcaption>
</figure>
<p>GCN„É¨„Ç§„É§„Éº„ÇíÁêÜËß£„Åó„ÇÑ„Åô„Åè„Åô„Çã„Åü„ÇÅ„ÄÅ <a class="reference internal" href="#dframe"><span class="std std-numref">Fig. 8.2</span></a> „ÇíË¶ã„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ„Åì„Çå„ÅØGCN„É¨„Ç§„É§„Éº„ÅÆ‰∏≠Èñì„Çπ„ÉÜ„ÉÉ„Éó„ÇíË°®„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇÂêÑ„Éé„Éº„Éâ„ÅÆÁâπÂæ¥„ÅØ„ÄÅ„Åì„Åì„Åß„ÅØone-hot encoding„Åï„Çå„Åü„Éô„ÇØ„Éà„É´„Å®„Åó„Å¶Ë°®Áèæ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ<a class="reference internal" href="#gcnanim"><span class="std std-numref">Fig. 8.3</span></a> „ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÅØ„ÄÅËøëÂÇçÁâπÂæ¥„Å´„Å§„ÅÑ„Å¶„ÅÆÂπ≥ÂùáÂåñ„Éó„É≠„Çª„Çπ„ÇíË°®„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åì„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Åß„ÅØ„ÄÅ„Çè„Åã„Çä„ÇÑ„Åô„Åè„Åô„Çã„Åü„ÇÅ„Å´Â≠¶ÁøíÂèØËÉΩ„Å™Èáç„Åø„Å®Ê¥ªÊÄßÂåñÈñ¢Êï∞„ÅØË®òËø∞„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ„Åì„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÅØ2Â±§ÁõÆ„ÅÆGCN„É¨„Ç§„É§„Éº„Åß„ÇÇÁπ∞„ÇäËøî„Åï„Çå„Çã„Åì„Å®„Å´Ê≥®ÊÑè„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇÂàÜÂ≠ê‰∏≠„Å´ÈÖ∏Á¥†ÂéüÂ≠ê„ÅåÂê´„Åæ„Çå„Çã„Å®„ÅÑ„ÅÜ‚ÄùÊÉÖÂ†±‚Äù„Åå„ÄÅ2Â±§ÁõÆ„Åß„ÅØ„Åò„ÇÅ„Å¶ÂêÑÂéüÂ≠ê„Å´‰ºùÊê¨„Åï„Çå„ÇãÊßòÂ≠ê„Çí„Çà„ÅèË¶ã„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇÂÖ®„Å¶„ÅÆGNN„ÅØ‰ºº„Åü„Çà„ÅÜ„Å™„Ç¢„Éó„É≠„Éº„ÉÅ„ÅßÂãï‰Ωú„Åô„Çã„ÅÆ„Åß„ÄÅ„Åì„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÅÆÂÜÖÂÆπ„ÅØ„Å®„Å¶„ÇÇÂ§ßÂàá„Åß„Åô„ÄÇ„Åú„Å≤„ÄÅ„Çà„ÅèÁêÜËß£„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
<figure class="align-default" id="gcnanim">
<img alt="../_images/gcn.gif" src="../_images/gcn.gif" />
<figcaption>
<p><span class="caption-number">Fig. 8.3 </span><span class="caption-text">„Ç∞„É©„ÉïÁï≥„ÅøËæº„ÅøÂ±§„ÅÆÂãï‰Ωú„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÄÇÂ∑¶„ÅåÂÖ•Âäõ„ÄÅÂè≥„ÅåÂá∫Âäõ„Éé„Éº„Éâ„ÅÆÁâπÂæ¥„Åß„Åô„ÄÇ2„Å§„ÅÆÂ±§„ÅåË°®Á§∫„Åï„Çå„Å¶„ÅÑ„Çã„Åì„Å®„Å´Ê≥®ÊÑè„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà„Çø„Ç§„Éà„É´„ÅåÂ§â„Çè„Çã„Åì„Å®„Å´Ê≥®ÊÑè„Åó„Å¶Ë¶ã„Å¶„Åè„Å†„Åï„ÅÑÔºâ„ÄÇ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÅåÈÄ≤„ÇÄ„Å´„Å§„Çå„Å¶„ÄÅËøëÂÇç„Éé„Éº„Éâ„ÅÆÂπ≥ÂùáÂåñ„Å´„Çà„Å£„Å¶„ÄÅÂéüÂ≠ê„Å´„Å§„ÅÑ„Å¶„ÅÆÊÉÖÂ†±„Åå„Å©„ÅÆ„Çà„ÅÜ„Å´ÂàÜÂ≠êÂÜÖ„Çí‰ºùÊí≠„Åó„Å¶„ÅÑ„Åè„Åã„Åå„Çè„Åã„Çã„Åì„Å®„Åß„Åó„Çá„ÅÜ„ÄÇ„Å§„Åæ„Çä„ÄÅÈÖ∏Á¥†„ÅØÂçò„Å™„ÇãÈÖ∏Á¥†„Åã„Çâ„ÄÅC„Å®H„Å´ÁµêÂêà„Åó„ÅüÈÖ∏Á¥†„ÄÅH„Å®CH3„Å´ÁµêÂêà„Åó„ÅüÈÖ∏Á¥†„Å∏„Å®Â§âÂåñ„Åó„Å¶„ÅÑ„Åè„ÅÆ„Åß„Åô„ÄÇÂõ≥‰∏≠„ÅÆËâ≤„ÅØÊï∞ÂÄ§„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ</span><a class="headerlink" href="#gcnanim" title="Permalink to this image">¬∂</a></p>
</figcaption>
</figure>
<section id="gcn">
<h3><span class="section-number">8.4.1. </span>GCN„ÅÆÂÆüË£Ö<a class="headerlink" href="#gcn" title="Permalink to this headline">¬∂</a></h3>
<p>„Åù„Çå„Åß„ÅØ„ÄÅGCN„ÅÆ„ÉÜ„É≥„ÇΩ„É´ÂÆüË£Ö„Çí‰Ωú„Çä„Åæ„Åó„Çá„ÅÜ„ÄÇ„Åì„Åì„Åß„ÅØ‰∏ÄÊó¶„ÄÅÊ¥ªÊÄßÂåñÈñ¢Êï∞„Åä„Çà„Å≥Â≠¶ÁøíÂèØËÉΩ„Å™Èáç„Åø„Å´„Å§„ÅÑ„Å¶„ÅØÁúÅÁï•„Åó„Åæ„Åô„ÄÇ
„Åæ„ÅöÊúÄÂàù„Å´„ÄÅ„É©„É≥„ÇØ2„ÅÆÈö£Êé•Ë°åÂàó„ÇíË®àÁÆó„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ‰∏ä„ÅÆ <code class="docutils literal notranslate"><span class="pre">smiles2graph</span></code> „Ç≥„Éº„Éâ„ÅØ„ÄÅÁâπÂæ¥„Éô„ÇØ„Éà„É´„ÇíÁî®„ÅÑ„Å¶Èö£Êé•Ë°åÂàó„ÇíË®àÁÆó„Åó„Åæ„Åô„ÄÇ„Åì„ÅÆË®àÁÆó„ÅØÁ∞°Âçò„Åß„Åô„ÄÇÂêåÊôÇ„Å´ÊÅíÁ≠âË°åÂàó„ÇíÂä†„Åà„Çã„Åì„Å®„Å´„Åó„Åæ„ÅôÔºàË®≥Ê≥®Ôºö„Åì„ÅÆÊÅíÁ≠âË°åÂàó„ÇíÂä†ÁÆó„Åô„ÇãÊìç‰Ωú„ÅØ„ÄÅ‰∏ä„ÅßËø∞„Åπ„Åü„Çà„ÅÜ„Å´Ëá™ÂàÜËá™Ë∫´„ÇíÈö£Êé•„Éé„Éº„Éâ„Å®„Åó„Å¶Âèñ„ÇäÊâ±„ÅÜ„Åü„ÇÅ„ÅÆÂ∑•Â§´„Åß„ÅôÔºâ„ÄÇ</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nodes</span><span class="p">,</span> <span class="n">adj</span> <span class="o">=</span> <span class="n">smiles2graph</span><span class="p">(</span><span class="s2">&quot;CO&quot;</span><span class="p">)</span>
<span class="n">adj_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">adj</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">adj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">adj_mat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1., 1., 1., 1., 1., 0.],
       [1., 1., 0., 0., 0., 1.],
       [1., 0., 1., 0., 0., 0.],
       [1., 0., 0., 1., 0., 0.],
       [1., 0., 0., 0., 1., 0.],
       [0., 1., 0., 0., 0., 1.]])
</pre></div>
</div>
</div>
</div>
<p>ÂêÑ„Éé„Éº„Éâ„ÅÆÊ¨°Êï∞„ÇíË®àÁÆó„Åô„Çã„Åü„ÇÅ„Å´„ÄÅ„Åæ„ÅüÂà•„Å™Á∏ÆÁ¥ÑÊìç‰Ωú„ÇíË°å„ÅÑ„Åæ„ÅôÔºö</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">degree</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">adj_mat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">degree</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([5., 3., 2., 2., 2., 2.])
</pre></div>
</div>
</div>
</div>
<p>„Åì„Çå„Åß„Éé„Éº„Éâ„ÅÆÊõ¥Êñ∞Êìç‰Ωú„ÅÆÊ∫ñÂÇô„Åå„Åß„Åç„Åæ„Åó„Åü„ÄÇ„Ç¢„Ç§„É≥„Ç∑„É•„Çø„Ç§„É≥„ÅÆÁ∏ÆÁ¥ÑË®òÊ≥ï„Çí‰Ωø„Å£„Å¶Êõ¥Êñ∞Êìç‰Ωú„ÇíË°®Áèæ„Åô„Çã„Å®Ê¨°„ÅÆ„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åô</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># note to divide by degree, make the input 1 / degree</span>
<span class="n">new_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,ij,jk-&gt;ik&quot;</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">degree</span><span class="p">,</span> <span class="n">adj_mat</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">new_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1. 0. 0.]
[0.2 0.2 0.6]
</pre></div>
</div>
</div>
</div>
<p>„Åì„Çå„ÇíKeras„ÅÆLayer„Å®„Åó„Å¶ÂÆüË£Ö„Åô„Çã„Å´„ÅØ„ÄÅ‰∏äË®ò„ÅÆ„Ç≥„Éº„Éâ„ÇíÊñ∞„Åó„ÅÑLayer„ÅÆ„Çµ„Éñ„ÇØ„É©„Çπ„Å®„Åó„Å¶Ë®òËø∞„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ‰ªäÂõû„ÅÆ„Ç≥„Éº„Éâ„ÅØÊØîËºÉÁöÑÁ∞°Âçò„Åß„Åô„Åå„ÄÅKeras„ÅÆÈñ¢Êï∞Âêç„Å®Layer„ÇØ„É©„Çπ„Å´„Å§„ÅÑ„Å¶„ÄÅ<a class="reference external" href="https://keras.io/guides/making_new_layers_and_models_via_subclassing/">„Åì„ÅÆ„ÉÅ„É•„Éº„Éà„É™„Ç¢„É´</a>„ÇíË™≠„Çì„ÅßÂ≠¶„Å∂„Åì„Å®„ÇíÊé®Â•®„Åó„Åæ„Åô„ÄÇ‰∏ª„Å™Â§âÊõ¥ÁÇπ„ÅØ„ÄÅÂ≠¶ÁøíÂèØËÉΩ„Å™„Éë„É©„É°„Éº„Çø <code class="docutils literal notranslate"><span class="pre">self.w</span></code> „Çí‰Ωú„Å£„Å¶ <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/einsum" title="(in TensorFlow v2.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tf.einsum</span></code></a> „ÅÆ‰∏≠„ÅßÁî®„ÅÑ„Çã„Åì„Å®„ÄÅÊ¥ªÊÄßÂåñÈñ¢Êï∞ <code class="docutils literal notranslate"><span class="pre">self.activation</span></code> „ÇíÁî®„ÅÑ„Çã„Åì„Å®„ÄÅ„Åù„Åó„Å¶Êñ∞„Åó„ÅÑ„Éé„Éº„ÉâÁâπÂæ¥„Å®Èö£Êé•Ë°åÂàó„ÇíÂá∫Âäõ„Åô„Çã„Åì„Å®„ÅÆ3ÁÇπ„Åß„Åô„ÄÇÈö£Êé•Ë°åÂàó„ÇíÂá∫Âäõ„Åô„ÇãÁêÜÁî±„ÅØ„ÄÅÈö£Êé•Ë°åÂàó„ÇíÊØéÂõûÊ∏°„Åô„Åì„Å®„Å™„Åè„ÄÅË§áÊï∞„ÅÆGCN„É¨„Ç§„É§„Éº„Çí„Çπ„Çø„ÉÉ„ÇØ„Åß„Åç„Çã„Çà„ÅÜ„Å´„Åô„Çã„Åü„ÇÅ„Åß„Åô„ÄÇ</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GCNLayer</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Layer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Implementation of GCN as layer&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># constructor, which just calls super constructor</span>
        <span class="c1"># and turns requested activation into a callable function</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GCNLayer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activation</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">activations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">activation</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
        <span class="c1"># create trainable weights</span>
        <span class="n">node_shape</span><span class="p">,</span> <span class="n">adj_shape</span> <span class="o">=</span> <span class="n">input_shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_weight</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">node_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">node_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
        <span class="c1"># split input into nodes, adj</span>
        <span class="n">nodes</span><span class="p">,</span> <span class="n">adj</span> <span class="o">=</span> <span class="n">inputs</span>
        <span class="c1"># compute degree</span>
        <span class="n">degree</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="n">adj</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># GCN equation</span>
        <span class="n">new_nodes</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;bi,bij,bjk,kl-&gt;bil&quot;</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">degree</span><span class="p">,</span> <span class="n">adj</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">(</span><span class="n">new_nodes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span><span class="p">,</span> <span class="n">adj</span>
</pre></div>
</div>
</div>
</div>
<p>‰∏äË®ò„ÅÆ„Ç≥„Éº„Éâ„ÅÆÂ§ßÂçä„ÅØKeras/TF„Å´Âõ∫Êúâ„ÅÆ„ÇÇ„ÅÆ„Åß„ÄÅÂ§âÊï∞„ÇíÈÅ©Âàá„Å™Â†¥ÊâÄ„Å´ÈÖçÁΩÆ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åì„Åì„ÅßÈáçË¶Å„Å™„ÅÆ„ÅØ2Ë°å„Å†„Åë„Åß„Åô„ÄÇ1„Å§„ÇÅ„ÅØ„ÄÅÈö£Êé•Ë°åÂàó„ÅÆÂàó„Å´„Å§„ÅÑ„Å¶ÂêàË®à„Åô„Çã„Åì„Å®„Åß„Ç∞„É©„Éï„ÅÆÊ¨°Êï∞„ÇíË®àÁÆó„Åô„ÇãÊìç‰Ωú„Åß„ÅôÔºö</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">degree</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="n">adj</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>2„Å§„ÇÅ„ÅÆÈáçË¶Å„Å™Ë°å„ÅØ„ÄÅGCNÊñπÁ®ãÂºè <a class="reference internal" href="#equation-gcn">(8.3)</a> „ÇíË®àÁÆó„Åô„ÇãÈÉ®ÂàÜ„Åß„ÅôÔºà„Åì„Åì„Åß„ÅØÊ¥ªÊÄßÂåñ„ÅØÁúÅÁï•„Åó„Å¶„ÅÑ„Åæ„ÅôÔºâÔºö</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">new_nodes</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;bi,bij,bjk,kl-&gt;bil&quot;</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">degree</span><span class="p">,</span> <span class="n">adj</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">)</span>
</pre></div>
</div>
<p>„Åì„Çå„Åß„ÄÅ„ÅÑ„ÅæÂÆüË£Ö„Åó„ÅüGCN„É¨„Ç§„É§„Éº„ÇíË©¶„Åô„Åì„Å®„Åå„Åß„Åç„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åó„ÅüÔºö</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gcnlayer</span> <span class="o">=</span> <span class="n">GCNLayer</span><span class="p">(</span><span class="s2">&quot;relu&quot;</span><span class="p">)</span>
<span class="c1"># we insert a batch axis here</span>
<span class="n">gcnlayer</span><span class="p">((</span><span class="n">nodes</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">adj_mat</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="o">...</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;tf.Tensor: shape=(1, 6, 3), dtype=float32, numpy=
 array([[[0.        , 0.46567526, 0.07535715],
         [0.        , 0.12714943, 0.05325063],
         [0.01475453, 0.295794  , 0.39316285],
         [0.01475453, 0.295794  , 0.39316285],
         [0.01475453, 0.295794  , 0.39316285],
         [0.        , 0.38166213, 0.        ]]], dtype=float32)&gt;,
 &lt;tf.Tensor: shape=(1, 6, 6), dtype=float32, numpy=
 array([[[1., 1., 1., 1., 1., 0.],
         [1., 1., 0., 0., 0., 1.],
         [1., 0., 1., 0., 0., 0.],
         [1., 0., 0., 1., 0., 0.],
         [1., 0., 0., 0., 1., 0.],
         [0., 1., 0., 0., 0., 1.]]], dtype=float32)&gt;)
</pre></div>
</div>
</div>
</div>
<p>„Åì„Çå„Å´„Çà„Çä (1) Êñ∞„Åó„ÅÑ„Éé„Éº„ÉâÁâπÂæ¥„ÄÅ(2) Èö£Êé•Ë°åÂàó„ÅåÂá∫Âäõ„Åï„Çå„Åæ„Åô„ÄÇ„Åì„ÅÆ„É¨„Ç§„É§„Éº„ÇíÁ©ç„ÅøÈáç„Å≠„Å¶„ÄÅGCN„ÇíË§áÊï∞ÂõûÈÅ©Áî®„Åß„Åç„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">adj_mat</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">gcnlayer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;tf.Tensor: shape=(1, 6, 3), dtype=float32, numpy=
array([[[0.        , 0.18908624, 0.        ],
        [0.        , 0.        , 0.        ],
        [0.        , 0.145219  , 0.        ],
        [0.        , 0.145219  , 0.        ],
        [0.        , 0.145219  , 0.        ],
        [0.        , 0.        , 0.        ]]], dtype=float32)&gt;, &lt;tf.Tensor: shape=(1, 6, 6), dtype=float32, numpy=
array([[[1., 1., 1., 1., 1., 0.],
        [1., 1., 0., 0., 0., 1.],
        [1., 0., 1., 0., 0., 0.],
        [1., 0., 0., 1., 0., 0.],
        [1., 0., 0., 0., 1., 0.],
        [0., 1., 0., 0., 0., 1.]]], dtype=float32)&gt;)
</pre></div>
</div>
</div>
</div>
<p>„ÅÜ„Åæ„Åè„ÅÑ„Åç„Åæ„Åó„ÅüÔºÅ„Åó„Åã„Åó„ÄÅ„Å™„Åú„Çº„É≠„ÅÆÂÄ§„Åå„ÅÇ„Çã„ÅÆ„Åß„Åó„Çá„ÅÜ„ÅãÔºü„Åì„Çå„ÅØ„Åä„Åù„Çâ„Åè„ÄÅÂá∫Âäõ„Å´Ë≤†„ÅÆÂÄ§„ÅåÂê´„Åæ„Çå„Å¶„Åä„Çä„ÄÅ„Åù„Çå„ÅåReLUÊ¥ªÊÄßÂåñ„ÇíÈÄö„Åó„ÅüÈöõ„Å´0„Å´„Å™„Å£„Åü„Åü„ÇÅ„Åß„Åó„Çá„ÅÜ„ÄÇ„Åì„Çå„ÅØ„É¢„Éá„É´„ÅÆË®ìÁ∑¥„Åå‰∏çÂçÅÂàÜ„Å™„Åü„ÇÅ„Å´Ëµ∑„Åç„Å¶„ÅÑ„Çã„Å®ËÄÉ„Åà„Çâ„Çå„ÄÅË®ìÁ∑¥„ÇíÈáç„Å≠„Çã„Åì„Å®„ÅßËß£Ê±∫„Åô„Çã„Åß„Åó„Çá„ÅÜ</p>
</section>
</section>
<section id="id13">
<h2><span class="section-number">8.5. </span>‰æãÔºöÊ∫∂Ëß£Â∫¶‰∫àÊ∏¨<a class="headerlink" href="#id13" title="Permalink to this headline">¬∂</a></h2>
<p>Ê¨°„Å´„ÄÅGCN„Å´„Çà„ÇãÊ∫∂Ëß£Â∫¶„ÅÆ‰∫àÊ∏¨„Å´„Å§„ÅÑ„Å¶Ë™¨Êòé„Åó„Åæ„Åô„ÄÇ‰ª•Ââç„Å´„ÄÅÂàÜÂ≠ê„Éá„Éº„Çø„Çª„ÉÉ„Éà„Å´Âê´„Åæ„Çå„Å¶„ÅÑ„ÇãÁâπÂæ¥Èáè„Çí‰Ωø„Å£„Å¶‰∫àÊ∏¨„É¢„Éá„É´„ÇíÁµÑ„Çì„Å†„Åì„Å®„ÇíÊÄù„ÅÑÂá∫„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ„ÅÑ„ÅæÊàë„ÄÖ„ÅØGCN„Çí‰Ωø„Åà„Çã„Çà„ÅÜ„Å´„Å™„Å£„Åü„ÅÆ„Åß„ÄÅÁâπÂæ¥Èáè„Å´È†≠„ÇíÊÇ©„Åæ„Åô„Åì„Å®„Å™„Åè„ÄÅÂàÜÂ≠êÊßãÈÄ†„ÇíÁõ¥Êé•„Éã„É•„Éº„É©„É´„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Å´ÂÖ•Âäõ„Åß„Åç„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åó„Åü„ÄÇGCN„É¨„Ç§„É§„Éº„ÅØÂêÑ„Éé„Éº„Éâ„Å´„Å§„ÅÑ„Å¶„ÅÆÁâπÂæ¥„ÇíÂá∫Âäõ„Åó„Åæ„Åô„Åå„ÄÅÊ∫∂Ëß£Â∫¶„Çí‰∫àÊ∏¨„Åô„Çã„Åü„ÇÅ„Å´„ÅØ„ÄÅ„Ç∞„É©„ÉïÂÖ®‰Ωì„Å´„Å§„ÅÑ„Å¶„ÅÆÁâπÂæ¥„ÇíÂæó„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ„Åì„ÅÆ„Éó„É≠„Çª„Çπ„Çí„Åï„Çâ„Å´Ê¥óÁ∑¥„Åô„ÇãÊñπÊ≥ï„Å´„Å§„ÅÑ„Å¶„ÅØÂæå„ÅßË™¨Êòé„Åó„Åæ„Åô„Åå„ÄÅ„Åì„Åì„Åß„ÅØ„ÄÅGCN„É¨„Ç§„É§„ÉºÂæå„ÅÆ„Åô„Åπ„Å¶„ÅÆ„Éé„Éº„ÉâÁâπÂæ¥„ÅÆÂπ≥Âùá„Çí‰Ωø„ÅÜ„Åì„Å®„Å´„Åó„Åæ„Åô„ÄÇ„Åì„Çå„Å´„Çà„ÇäÂçòÁ¥î„Åã„Å§È†ÜÂ∫è‰∏çÂ§â„Å´„ÄÅ„Éé„Éº„ÉâÁâπÂæ¥„Çí„Ç∞„É©„ÉïÁâπÂæ¥„Å´Â§âÊèõ„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ„Åì„ÅÆÂÆüË£Ö„ÅØÊ¨°„ÅÆ„Å®„Åä„Çä„Åß„ÅôÔºö</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GRLayer</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Layer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A GNN layer that computes average over all node features&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;GRLayer&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GRLayer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
        <span class="n">nodes</span><span class="p">,</span> <span class="n">adj</span> <span class="o">=</span> <span class="n">inputs</span>
        <span class="n">reduction</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reduction</span>
</pre></div>
</div>
</div>
</div>
<p>‰∏ä„ÅÆ„Ç≥„Éº„Éâ„ÅßÈáçË¶Å„Å™ÁÇπ„ÅØ„ÄÅ„Éé„Éº„Éâ„Å´„Å§„ÅÑ„Å¶Âπ≥Âùá„Çí„Å®„Å£„Å¶„ÅÑ„Çã(<code class="docutils literal notranslate"><span class="pre">axis=1</span></code>)Ê¨°„ÅÆÈÉ®ÂàÜ„Å†„Åë„Åß„ÅôÔºö</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">reduction</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>„Åì„ÅÆÊ∫∂Ëß£Â∫¶‰∫àÊ∏¨Âô®„ÇíÂÆåÊàê„Åï„Åõ„Çã„Åü„ÇÅ„ÄÅ„ÅÑ„Åè„Å§„Åã„ÅÆÂÖ®ÁµêÂêàÂ±§„ÇíËøΩÂä†„Åó„Å¶„ÄÅÂõûÂ∏∞„ÅåË°å„Åà„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇÂõûÂ∏∞„ÅÆÂ†¥Âêà„ÅØÊúÄÁµÇÂ±§„ÅÆÂá∫Âäõ„Åå„Åù„ÅÆ„Åæ„Åæ‰∫àÊ∏¨ÁµêÊûú„Å®„Å™„Çã„Åü„ÇÅ„ÄÅÊúÄÁµÇÂ±§„Å´„ÅØÊ¥ªÊÄßÂåñ„ÇíÈÅ©Áî®„Åó„Å™„ÅÑ„Åì„Å®„Å´Ê≥®ÊÑè„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ„Åì„ÅÆ„É¢„Éá„É´„ÅØ <a class="reference external" href="https://keras.io/guides/functional_api/">Keras functional API</a> „Çí‰Ωø„Å£„Å¶ÂÆüË£Ö„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ninput</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span>
    <span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="mi">100</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">ainput</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span>
    <span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="c1"># GCN block</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">GCNLayer</span><span class="p">(</span><span class="s2">&quot;relu&quot;</span><span class="p">)([</span><span class="n">ninput</span><span class="p">,</span> <span class="n">ainput</span><span class="p">])</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">GCNLayer</span><span class="p">(</span><span class="s2">&quot;relu&quot;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">GCNLayer</span><span class="p">(</span><span class="s2">&quot;relu&quot;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">GCNLayer</span><span class="p">(</span><span class="s2">&quot;relu&quot;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
<span class="c1"># reduce to graph features</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">GRLayer</span><span class="p">()(</span><span class="n">x</span><span class="p">)</span>
<span class="c1"># standard layers (the readout)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;tanh&quot;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">(</span><span class="n">ninput</span><span class="p">,</span> <span class="n">ainput</span><span class="p">),</span> <span class="n">outputs</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>„Åì„ÅÆ100„ÅØ„Å©„Åì„Åã„ÇâÊù•„Åü„ÅÆ„Åß„Åó„Çá„ÅÜ„ÅãÔºü„Åù„ÅÆÁ≠î„Åà„ÅØ„Éá„Éº„Çø„Çª„ÉÉ„Éà„Å´Âê´„Åæ„Çå„ÇãÂÖÉÁ¥†„ÅÆÊï∞„Å´„ÅÇ„Çä„Åæ„Åô„ÄÇ„Åì„ÅÆ„Éá„Éº„Çø„Çª„ÉÉ„Éà„ÅØÂ§öÊï∞„ÅÆÂÖÉÁ¥†„ÇíÂê´„ÇÄ„Åü„ÇÅ„ÄÅ‰ª•Ââç‰Ωø„Å£„Åü„Çµ„Ç§„Ç∫3„ÅÆone-hot encoding„Åß„ÅØ„ÄÅÂÖ®„Å¶„ÅÆÂÖÉÁ¥†„ÇíË°®Áèæ„Åß„Åç„Åæ„Åõ„Çì„ÄÇÂâçÂõû„ÅØC, H, O„ÅÆÂÖÉÁ¥†„Åï„ÅàË°®Áèæ„Åß„Åç„Çå„Å∞ÂçÅÂàÜ„Åß„Åó„Åü„Åå„ÄÅ‰ªäÂõû„ÅØ„Çà„ÇäÂ§öÊï∞„ÅÆÂÖÉÁ¥†„ÇíÊâ±„ÅÜÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ„Åù„ÅÆ„Åü„ÇÅ„ÄÅone-hot encoding„ÅÆ„Çµ„Ç§„Ç∫„ÇÇ100„Å´Â¢ó„ÇÑ„Åô„Åì„Å®„Å´„Åó„Åæ„Åó„Åü„ÄÇ„Åì„Çå„ÅßÊúÄÂ§ß100Á®ÆÈ°û„ÅÆÂÖÉÁ¥†„ÇíË°®Áèæ„Åß„Åç„Åæ„Åô„ÄÇ„Åì„ÅÆÊã°Âºµ„ÅÆ„Åü„ÇÅ„Å´„ÄÅ„É¢„Éá„É´„Å†„Åë„Åß„Å™„Åè<code class="docutils literal notranslate"><span class="pre">smiles2graph</span></code>Èñ¢Êï∞„ÇÇÊõ¥Êñ∞„Åô„Çã„Åì„Å®„Å´„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>
<div class="cell tag_hidden-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gen_smiles2graph</span><span class="p">(</span><span class="n">sml</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Argument for the RD2NX function should be a valid SMILES sequence</span>
<span class="sd">    returns: the graph</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">rdkit</span><span class="o">.</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">sml</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">rdkit</span><span class="o">.</span><span class="n">Chem</span><span class="o">.</span><span class="n">AddHs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="n">order_string</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">rdkit</span><span class="o">.</span><span class="n">Chem</span><span class="o">.</span><span class="n">rdchem</span><span class="o">.</span><span class="n">BondType</span><span class="o">.</span><span class="n">SINGLE</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">rdkit</span><span class="o">.</span><span class="n">Chem</span><span class="o">.</span><span class="n">rdchem</span><span class="o">.</span><span class="n">BondType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">rdkit</span><span class="o">.</span><span class="n">Chem</span><span class="o">.</span><span class="n">rdchem</span><span class="o">.</span><span class="n">BondType</span><span class="o">.</span><span class="n">TRIPLE</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">rdkit</span><span class="o">.</span><span class="n">Chem</span><span class="o">.</span><span class="n">rdchem</span><span class="o">.</span><span class="n">BondType</span><span class="o">.</span><span class="n">AROMATIC</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">()))</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">():</span>
        <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">GetIdx</span><span class="p">(),</span> <span class="n">i</span><span class="o">.</span><span class="n">GetAtomicNum</span><span class="p">()]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">adj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">GetBonds</span><span class="p">():</span>
        <span class="n">u</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">GetBeginAtomIdx</span><span class="p">(),</span> <span class="n">j</span><span class="o">.</span><span class="n">GetEndAtomIdx</span><span class="p">())</span>
        <span class="n">v</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">GetBeginAtomIdx</span><span class="p">(),</span> <span class="n">j</span><span class="o">.</span><span class="n">GetEndAtomIdx</span><span class="p">())</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">GetBondType</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">order</span> <span class="ow">in</span> <span class="n">order_string</span><span class="p">:</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">order_string</span><span class="p">[</span><span class="n">order</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s2">&quot;Ignoring bond order&quot;</span> <span class="o">+</span> <span class="n">order</span><span class="p">)</span>
        <span class="n">adj</span><span class="p">[</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">adj</span><span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">adj</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">adj</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nodes</span><span class="p">,</span> <span class="n">adj</span> <span class="o">=</span> <span class="n">gen_smiles2graph</span><span class="p">(</span><span class="s2">&quot;CO&quot;</span><span class="p">)</span>
<span class="n">model</span><span class="p">((</span><span class="n">nodes</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">adj_mat</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;tf.Tensor: shape=(1, 1), dtype=float32, numpy=array([[0.0107595]], dtype=float32)&gt;
</pre></div>
</div>
</div>
</div>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>GCN„Åß„ÅØ„Ç®„ÉÉ„Ç∏ÁâπÂæ¥„Åå‰Ωø„Åà„Å™„ÅÑ„ÅÆ„Åß„ÄÅÈö£Êé•„ÉÜ„É≥„ÇΩ„É´„ÅÆ‰ª£„Çè„Çä„Å´Ë°åÂàó„Çí‰Ωø„ÅÜ„Çà„ÅÜÂ§âÊõ¥„ÇíÂä†„Åà„Åæ„Åó„Åü„ÄÇ</p>
</aside>
<p>„Åì„ÅÆ„É¢„Éá„É´„ÅØ1„Å§„ÅÆÊï∞ÂÄ§Ôºà„Çπ„Ç´„É©„ÉºÔºâ„ÇíÂá∫Âäõ„Åó„Åæ„Åô„ÄÇ
„Åï„Å¶„ÄÅÂ≠¶ÁøíÂèØËÉΩ„Å™„Éá„Éº„Çø„Çª„ÉÉ„Éà„ÇíÂæó„Çã„Åü„ÇÅ„Å´„ÄÅ„ÅÑ„Åè„Å§„Åã‰ΩúÊ•≠„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ„Åì„ÅÆ„Éá„Éº„Çø„Çª„ÉÉ„Éà„ÅØÂ∞ë„ÅóË§áÈõë„Åß„ÄÅÁâπÂæ¥„ÅØ„ÉÜ„É≥„ÇΩ„É´(<span class="math notranslate nohighlight">\(mathbf{V}, \mathbf{E}\)</span>)„ÅÆ„Çø„Éó„É´„Å™„ÅÆ„Åß„ÄÅ„Éá„Éº„Çø„Çª„ÉÉ„Éà„ÅØÊ¨°„ÅÆ„Çà„ÅÜ„Å™„Çø„Éó„É´„ÅÆ„Çø„Éó„É´„Å´„Å™„Çä„Åæ„ÅôÔºö <span class="math notranslate nohighlight">\(\left((\mathbf{V}, \mathbf{E}), y\right)\)</span> <strong>generator</strong>„ÅØPython„ÅÆÈñ¢Êï∞„Åß„ÄÅÂÄ§„ÇíÁπ∞„ÇäËøî„ÅóËøî„Åô„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ„Åì„Åì„Åß„ÅØ„ÄÅÂ≠¶Áøí„Éá„Éº„Çø„Çí1„Å§„Åö„Å§Âèñ„ÇäÂá∫„Åô„Åü„ÇÅ„Å´generator„Çí‰Ωø„ÅÑ„Åæ„Åô„ÄÇÁ∂ö„ÅÑ„Å¶„ÄÅ„Åì„Çå„Çí <code class="docutils literal notranslate"><span class="pre">from_generator</span></code> <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/data/Dataset" title="(in TensorFlow v2.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tf.data.Dataset</span></code></a> „Ç≥„É≥„Çπ„Éà„É©„ÇØ„Çø„Å´Ê∏°„Åó„Åæ„Åô„ÄÇ„Åì„ÅÆ„Ç≥„É≥„Çπ„Éà„É©„ÇØ„Çø„Åß„ÅØ„ÄÅÂÖ•Âäõ„Éá„Éº„Çø„ÅÆshape„ÇíÊòéÁ§∫ÁöÑ„Å´ÊåáÂÆö„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">example</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">soldata</span><span class="p">)):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">gen_smiles2graph</span><span class="p">(</span><span class="n">soldata</span><span class="o">.</span><span class="n">SMILES</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">soldata</span><span class="o">.</span><span class="n">Solubility</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">yield</span> <span class="n">graph</span><span class="p">,</span> <span class="n">sol</span>


<span class="n">data</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_generator</span><span class="p">(</span>
    <span class="n">example</span><span class="p">,</span>
    <span class="n">output_types</span><span class="o">=</span><span class="p">((</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
    <span class="n">output_shapes</span><span class="o">=</span><span class="p">(</span>
        <span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="mi">100</span><span class="p">]),</span> <span class="n">tf</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">([]),</span>
    <span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>„Åì„Åì„Åæ„ÅßÊù•„Åü„Çâ„ÇÇ„ÅÜÂ∞ë„Åó„Åß„Åô„ÄÇ„Åì„Çå„Åß„ÄÅ„ÅÑ„Å§„ÇÇ„ÅÆ„Çà„ÅÜ„Å´„Éá„Éº„Çø„Çª„ÉÉ„Éà„Çítrain/val/test„Å´ÂàÜÂâ≤„Åß„Åç„Åæ„Åô„ÄÇ</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="n">val_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>„Åù„Åó„Å¶„ÄÅ„ÅÑ„Çà„ÅÑ„Çà„É¢„Éá„É´„ÅÆË®ìÁ∑¥„Åß„Åô</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;adam&quot;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s2">&quot;mean_squared_error&quot;</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">validation_data</span><span class="o">=</span><span class="n">val_data</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;training&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s2">&quot;val_loss&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;validation&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epoch&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Loss&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/gnn_39_0.png" src="../_images/gnn_39_0.png" />
</div>
</div>
<p>„Åì„ÅÆ„É¢„Éá„É´„ÅØÊòé„Çâ„Åã„Å´„Ç¢„É≥„ÉÄ„Éº„Éï„Ç£„ÉÉ„Éà„Åß„Åô„ÄÇËÄÉ„Åà„Çâ„Çå„ÇãÁêÜÁî±„ÅÆ‰∏Ä„Å§„ÅØ„Éê„ÉÉ„ÉÅ„Çµ„Ç§„Ç∫„Åå1„Åß„ÅÇ„Çã„Åì„Å®„Åß„Åô„ÄÇ„Åì„ÅÆ„É¢„Éá„É´„Åß„ÅØ„ÄÅÂéüÂ≠êÂÄãÊï∞„ÇíÂèØÂ§â„Å´„Åó„ÅüÂâØ‰ΩúÁî®„Å®„Åó„Å¶„Éê„ÉÉ„ÉÅ„Çµ„Ç§„Ç∫„Çí1„Çà„ÇäÂ§ß„Åç„Åè„Åß„Åç„Å™„ÅÑÂà∂Á¥Ñ„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ„ÇÇ„ÅÜÂ∞ë„ÅóË©≥„Åó„ÅèË™¨Êòé„Åô„Çã„Å®„ÄÅ‰ªªÊÑè„ÅÆ„Éê„ÉÉ„ÉÅ„Çµ„Ç§„Ç∫„ÇíÂÖ•Âäõ„Åß„Åç„Çã„Çà„ÅÜ„Å´„Åô„Çã„Å®„ÄÅÂéüÂ≠êÂÄãÊï∞„Å®„Éê„ÉÉ„ÉÅ„Çµ„Ç§„Ç∫„ÅÆ2„Å§„Åå‰∏çÂÆö„Å®„Å™„Çä„Åæ„Åô„ÄÇKeras/tensorflow„ÅØÂÖ•Âäõ„Éá„Éº„Çø„ÅÆshape„Å´Êú™Áü•„ÅÆÊ¨°ÂÖÉ„Åå2„Å§‰ª•‰∏ä„ÅÇ„ÇãÂ†¥Âêà„Éá„Éº„Çø„ÇíÂá¶ÁêÜ„Åß„Åç„Å™„ÅÑ„Åü„ÇÅ„ÄÅ„Éê„ÉÉ„ÉÅ„Çµ„Ç§„Ç∫„Çí1„Å´Âõ∫ÂÆö„Åô„Çã„Åì„Å®„ÅßÂØæÂá¶„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åì„Åì„Åß„ÅØÊâ±„ÅÑ„Åæ„Åõ„Çì„Åå„ÄÅ„Åì„ÅÆÂïèÈ°å„ÇíÂõûÈÅø„Åó„Å¶„Éê„ÉÉ„ÉÅ„Çµ„Ç§„Ç∫„Çí1„Çà„ÇäÂ§ß„Åç„Åè„Åô„Çã„Åü„ÇÅ„ÅÆÊ®ôÊ∫ñÁöÑ„Éà„É™„ÉÉ„ÇØ„ÅØ„ÄÅË§áÊï∞„ÅÆÂàÜÂ≠ê„ÇíÔºàÂàÜÂ≠êÈñì„ÅÆÁµêÂêà„Åå„Å™„ÅÑÔºâ1„Å§„ÅÆ„Ç∞„É©„Éï„Å´„Åæ„Å®„ÇÅ„Å¶„Åó„Åæ„ÅÜ„Åì„Å®„Åß„Åô„ÄÇ„Åì„Çå„Å´„Çà„Çä„Éá„Éº„Çø„ÅÆÊ¨°ÂÖÉ„ÅØ„Åù„ÅÆ„Åæ„Åæ„Å´„ÄÅÂàÜÂ≠ê„Çí„Éê„ÉÉ„ÉÅÂá¶ÁêÜ„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ</p>
<p>„Åù„Çå„Åß„ÅØ„Éë„É™„ÉÜ„Ç£„Éó„É≠„ÉÉ„Éà„Åß‰∫àÊ∏¨Á≤æÂ∫¶„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yhat</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">test_y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">test_data</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_y</span><span class="p">,</span> <span class="n">test_y</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_y</span><span class="p">,</span> <span class="n">yhat</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
    <span class="nb">min</span><span class="p">(</span><span class="n">test_y</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nb">max</span><span class="p">(</span><span class="n">test_y</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span>
    <span class="sa">f</span><span class="s2">&quot;correlation = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">test_y</span><span class="p">,</span> <span class="n">yhat</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
    <span class="nb">min</span><span class="p">(</span><span class="n">test_y</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nb">max</span><span class="p">(</span><span class="n">test_y</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span>
    <span class="sa">f</span><span class="s2">&quot;loss = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">test_y</span> <span class="o">-</span> <span class="n">yhat</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Testing Data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/gnn_41_0.png" src="../_images/gnn_41_0.png" />
</div>
</div>
</section>
<section id="message-passinggcn">
<h2><span class="section-number">8.6. </span>Message Passing„Å®GCN<a class="headerlink" href="#message-passinggcn" title="Permalink to this headline">¬∂</a></h2>
<p>„Çà„ÇäÂ∫É„ÅÑÊÑèÂë≥„ÅßGCN„É¨„Ç§„É§„Éº„ÇíÊçâ„Åà„Çã„Å®„ÄÅGCN„É¨„Ç§„É§„Éº„ÅØ‚Äùmessage-passing‚Äù„É¨„Ç§„É§„Éº„ÅÆ‰∏Ä„Å§„Å®Ë®Ä„Åà„Åæ„Åô„ÄÇGCN„Åß„ÅØ„ÄÅ„Åæ„ÅöËøëÂÇç„Éé„Éº„Éâ„Åã„Çâ„ÇÑ„Å£„Å¶„Åè„Çã„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂá¶ÁêÜ„Åó„Åæ„ÅôÔºö</p>
<div class="amsmath math notranslate nohighlight" id="equation-49d82e17-a649-489d-b984-a16d307ed956">
<span class="eqno">(8.4)<a class="headerlink" href="#equation-49d82e17-a649-489d-b984-a16d307ed956" title="Permalink to this equation">¬∂</a></span>\[\begin{equation}
\vec{e}_{{s_i}j} = \vec{v}_{{s_i}j} \mathbf{W}
\end{equation}\]</div>
<p>„Åì„Åì„Åß <span class="math notranslate nohighlight">\(v_{{s_i}j}\)</span> „ÅØ „Éé„Éº„Éâ <span class="math notranslate nohighlight">\(i\)</span> „ÅÆ <span class="math notranslate nohighlight">\(j\)</span> Áï™ÁõÆ„ÅÆËøëÂÇç„Åß„Åô„ÄÇ <span class="math notranslate nohighlight">\(s_i\)</span> „ÅØ <span class="math notranslate nohighlight">\(i\)</span> „Å´ÂØæ„Åô„Çã„Çª„É≥„ÉÄ„ÉºÔºàÈÄÅ‰ø°ËÄÖÔºâ„Åß„Åô„ÄÇ „Åì„Çå„ÅØGCN„Åå„Å©„ÅÆ„Çà„ÅÜ„Å´„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË®àÁÆó„Åô„Çã„ÅãÁ§∫„Åó„Åü„ÇÇ„ÅÆ„Åß„Åô„Åå„ÄÅ„ÇÑ„Å£„Å¶„ÅÑ„Çã„Åì„Å®„ÅØÂçòÁ¥î„Åß„ÄÅÂêÑËøëÂÇç„Éé„Éº„Éâ„ÅÆÁâπÂæ¥„Å´Èáç„ÅøË°åÂàó„Çí„Åã„Åë„Å¶„ÅÑ„Çã„Å†„Åë„Åß„Åô„ÄÇ„Éé„Éº„Éâ <span class="math notranslate nohighlight">\(i\)</span> „Å´Âêë„Åã„ÅÜ„É°„ÉÉ„Çª„Éº„Ç∏ <span class="math notranslate nohighlight">\(\vec{e}_{{s_i}j}\)</span> „ÇíÂæó„ÅüÂæå„ÄÅ„Åì„Çå„Çâ„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„Çí„Éé„Éº„Éâ„ÅÆÈ†ÜÁï™„Å´ÂØæ„Åó„Å¶‰∏çÂ§â„Å™Èñ¢Êï∞„ÇíÁî®„ÅÑ„Å¶ÈõÜÁ¥Ñ„Åó„Åæ„ÅôÔºö</p>
<div class="amsmath math notranslate nohighlight" id="equation-c03ab854-0ba2-4c66-9a5a-33aa917c7202">
<span class="eqno">(8.5)<a class="headerlink" href="#equation-c03ab854-0ba2-4c66-9a5a-33aa917c7202" title="Permalink to this equation">¬∂</a></span>\[\begin{equation}
\vec{e}_{i} = \frac{1}{|\vec{e}_{{s_i}j}|}\sum \vec{e}_{{s_i}j} 
\end{equation}\]</div>
<p>‰∏ä„ÅßÊâ±„Å£„Åü„Çà„ÅÜ„Å´„ÄÅGCN„Åß„ÅØ„Åì„ÅÆÈõÜÁ¥Ñ„ÅØÂçò„Å™„ÇãÂπ≥Âùá„Åß„Åô„Åå„ÄÅ‰ªªÊÑè„ÅÆÔºà‰æã„Åà„Å∞Â≠¶ÁøíÂèØËÉΩ„Å™ÔºâÈ†ÜÂ∫è‰∏çÂ§â„ÅÆÈñ¢Êï∞„Çí‰Ωø„ÅÜ„Åì„Å®„ÇÇ„Åß„Åç„Åæ„ÅôÔºö</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>Ë®≥Ê≥®Ôºö„ÄåÂ≠¶ÁøíÂèØËÉΩ„Å™Èñ¢Êï∞„Äç„Å®„ÅÑ„ÅÜË°®Áèæ„ÅåÊôÇ„ÄÖÂá∫„Å¶„Åç„Åæ„Åô„Åå„ÄÅ„Åì„Çå„ÅØtrainable function„ÅÆË®≥„Åß„Äå„Åù„ÅÆÈñ¢Êï∞Ëá™‰Ωì„ÇíÔºàÂÖ∑‰ΩìÁöÑ„Å™Èñ¢Êï∞ÂΩ¢„ÇíÊòéÁ§∫ÁöÑ„Å´Ë®òËø∞„Åô„Çã„ÅÆ„Åß„ÅØ„Å™„ÅèÔºâMLPÁ≠â„ÅÆÊ©üÊ¢∞Â≠¶Áøí„É¢„Éá„É´„Å®„Éá„Éº„Çø„Å´„Çà„Çä„É¢„Éá„É™„É≥„Ç∞„Åô„Çã„Åì„Å®„Åß„ÄÅÊâÄÊúõ„ÅÆÊÄßË≥™„ÇíÂÇô„Åà„ÅüÈñ¢Êï∞„ÇíÊßãÊàê„Åô„Çã„Äç„Å®„ÅÑ„ÅÜ„Ç¢„Éó„É≠„Éº„ÉÅ„Å´„Çà„ÇäÊßãÊàê„Åï„Çå„ÅüÈñ¢Êï∞„ÇíÊåá„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ</p>
</aside>
<div class="amsmath math notranslate nohighlight" id="equation-a0d6bf16-039c-42fb-8770-493f4dc85f9d">
<span class="eqno">(8.6)<a class="headerlink" href="#equation-a0d6bf16-039c-42fb-8770-493f4dc85f9d" title="Permalink to this equation">¬∂</a></span>\[\begin{equation}
\vec{v}^{'}_{i} = \sigma(\vec{e}_i)
\end{equation}\]</div>
<p><span class="math notranslate nohighlight">\(v^{'}\)</span> „ÅØÊñ∞„Åó„ÅÑ„Éé„Éº„ÉâÁâπÂæ¥„ÇíÁ§∫„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åì„Çå„ÅØÂçòÁ¥î„Å´„ÄÅÈõÜÁ¥Ñ„Åï„Çå„ÅüÂæå„ÅßÊ¥ªÊÄßÂåñÈñ¢Êï∞„ÇíÈÅ©Áî®„Åó„Åü„É°„ÉÉ„Çª„Éº„Ç∏„Åß„Åô„ÄÇ„Åì„ÅÆ„Çà„ÅÜ„Å´Êõ∏„ÅçÂá∫„Åô„Åì„Å®„Åß„ÄÅ„Åì„Çå„Çâ„ÅÆÊâãÈ†Ü„Å´„ÅÑ„Åè„Çâ„Åß„ÇÇÂ∞è„Åï„Å™Â§âÊõ¥„ÅåÂä†„Åà„Çâ„Çå„Çã„Åì„Å®„Å´Ê∞ó„Å•„ÅÑ„Åü„ÅÆ„Åß„ÅØ„Å™„ÅÑ„Åß„Åó„Çá„ÅÜ„Åã„ÄÇGilmer„Çâ„Å´„Çà„ÇãÈáçË¶Å„Å™Ë´ñÊñá <span id="id14">[<a class="reference internal" href="#id81" title="Justin Gilmer, Samuel S Schoenholz, Patrick F Riley, Oriol Vinyals, and George E Dahl. Neural message passing for quantum chemistry. arXiv preprint arXiv:1704.01212, 2017.">GSR+17</a>]</span> „Åß„ÅØ„ÄÅ„ÅÑ„Åè„Å§„Åã„ÅÆÈÅ∏ÊäûËÇ¢„ÇíÊ§úË®é„Åó„ÄÅ„Åì„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„Éë„ÉÉ„Ç∑„É≥„Ç∞„É¨„Ç§„É§„Éº„ÅÆÂü∫Êú¨ÁöÑ„Å™„Ç¢„Ç§„Éá„Ç£„Ç¢„Åå„ÄÅÈáèÂ≠êÂäõÂ≠¶„Å´Âü∫„Å•„ÅÑ„Å¶ÂàÜÂ≠ê„Ç®„Éç„É´„ÇÆ„Éº„Çí‰∫àÊ∏¨„Åô„Çã„Çø„Çπ„ÇØ„Åß„ÅÜ„Åæ„Åè„ÅÑ„Åè„Åì„Å®„ÅåËø∞„Åπ„Çâ„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇGCNÂºè„Å´Â§âÊõ¥„ÇíÂä†„Åà„Åü‰æã„Å®„Åó„Å¶„ÅØ„ÄÅËøëÂÇç„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆË®àÁÆó„Å´„Åä„ÅÑ„Å¶„Ç®„ÉÉ„Ç∏ÁâπÂæ¥„ÇíÂê´„ÇÅ„Åü„Çä„ÄÅÂçò„Å´ <span class="math notranslate nohighlight">\(\sigma\)</span> „ÅßÂíå„Çí„Å®„Çã‰ª£„Çè„Çä„Å´ÂÖ®ÁµêÂêàÂ±§„Çí‰Ωø„ÅÜ„Å®„ÅÑ„Å£„ÅüË©¶„Åø„ÅåÊåô„Åí„Çâ„Çå„Åæ„Åô„ÄÇ
„Åì„Çå„Çâ„Åã„Çâ„ÄÅGCN„ÅØ„ÄÅ„É°„ÉÉ„Çª„Éº„Ç∏„Éë„ÉÉ„Ç∑„É≥„Ç∞„Ç∞„É©„Éï„Éã„É•„Éº„É©„É´„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÔºàMPNN„Å®Áï•„Åï„Çå„Çã„Åì„Å®„ÇÇ„ÅÇ„Çä„Åæ„ÅôÔºâ„ÅÆ‰∏ÄÁ®Æ„Å®ËÄÉ„Åà„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ</p>
</section>
<section id="gated-graph-neural-network">
<h2><span class="section-number">8.7. </span>Gated Graph Neural Network<a class="headerlink" href="#gated-graph-neural-network" title="Permalink to this headline">¬∂</a></h2>
<p>„É°„ÉÉ„Çª„Éº„Ç∏„Éë„ÉÉ„Ç∑„É≥„Ç∞„É¨„Ç§„É§„Éº„ÅÆÊúÄ„ÇÇÊúâÂêç„Å™‰∫úÁ®Æ„ÅÆ‰∏Ä„Å§„ÅØ„ÄÅ <strong>gated graph neural network</strong> (GGN) <span id="id15">[<a class="reference internal" href="#id79" title="Yujia Li, Daniel Tarlow, Marc Brockschmidt, and Richard Zemel. Gated graph sequence neural networks. arXiv preprint arXiv:1511.05493, 2015.">LTBZ15</a>]</span> „Åß„Åô„ÄÇ„Åì„Çå„ÅØÊúÄÂæå„ÅÆÂºè„ÅÆ„Éé„Éº„ÉâÊõ¥Êñ∞„ÇíÊ¨°„ÅßÁΩÆ„ÅçÊèõ„Åà„Åü„ÇÇ„ÅÆ„Åß„ÅôÔºö</p>
<div class="amsmath math notranslate nohighlight" id="equation-5598e065-a4e0-4b42-93fa-229539f86ba1">
<span class="eqno">(8.7)<a class="headerlink" href="#equation-5598e065-a4e0-4b42-93fa-229539f86ba1" title="Permalink to this equation">¬∂</a></span>\[\begin{equation}
\vec{v}^{'}_{i} = \textrm{GRU}(\vec{v}_i, \vec{e}_i)
\end{equation}\]</div>
<p><span class="math notranslate nohighlight">\(\textrm{GRU}(\cdot, \cdot)\)</span> „ÅØ„Ç≤„Éº„ÉàÂÜçÂ∏∞„É¶„Éã„ÉÉ„ÉàÔºàgated recurrent unitÔºâ<span id="id16">[<a class="reference internal" href="#id80" title="Junyoung Chung, Caglar Gulcehre, KyungHyun Cho, and Yoshua Bengio. Empirical evaluation of gated recurrent neural networks on sequence modeling. arXiv preprint arXiv:1412.3555, 2014.">CGCB14</a>]</span> „Åß„Åô„ÄÇ GRU „ÅØ„Éê„Ç§„Éä„É™ÔºàÂÖ•ÂäõÂºïÊï∞„Çí2„Å§ÊåÅ„Å§Ôºâ„Éã„É•„Éº„É©„É´„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Åß„ÄÅÂÖ∏ÂûãÁöÑ„Å´„ÅØÁ≥ªÂàó„Éá„Éº„Çø„ÅÆ„É¢„Éá„É™„É≥„Ç∞„Å´‰ΩøÁî®„Åï„Çå„Åæ„Åô„ÄÇGCN„Å®ÊØîËºÉ„Åó„Å¶„ÄÅGGN„ÅÆËààÂë≥Ê∑±„ÅÑÁâπÂæ¥„ÅØ„ÄÅÔºàGRU„Åã„Çâ„ÅÆÔºâ„Éé„Éº„ÉâÊõ¥Êñ∞„Å´„Åä„ÅÑ„Å¶Â≠¶ÁøíÂèØËÉΩ„Å™„Éë„É©„É°„Éº„Çø„ÇíÊåÅ„Å§„Åì„Å®„Åß„ÄÅ„Çà„ÇäÊüîËªüÊÄß„ÇíÂÇô„Åà„Åü„É¢„Éá„É´„Å®„Å™„Å£„Å¶„ÅÑ„Çã„Åì„Å®„Åß„Åô„ÄÇGGN„Åß„ÅØ„ÄÅGRU„ÅÆ„Éë„É©„É°„Éº„Çø„ÅØÂêÑÂ±§„ÅßÂÖ±Êúâ„Åï„Çå„Åæ„ÅôÔºàGRU„Çí‰Ωø„Å£„Å¶Á≥ªÂàó„Éá„Éº„Çø„Çí„É¢„Éá„É™„É≥„Ç∞„Åô„ÇãÊñπÊ≥ï„Å®Âêå„Åò„Åß„ÅôÔºâ„ÄÇ„Éë„É©„É°„Éº„ÇøÂÖ±Êúâ„Å´„Çà„Çã„É°„É™„ÉÉ„Éà„ÅØ„ÄÅÂ≠¶Áøí„Åô„Åπ„Åç„Éë„É©„É°„Éº„Çø„ÇíÂ¢ó„ÇÑ„Åô„Åì„Å®„Å™„ÅèGGN„ÅÆÂ±§„ÇíÁÑ°Èôê„Å´Á©ç„ÅøÈáç„Å≠„Çâ„Çå„Çã„Åì„Å®„Åß„ÅôÔºàÂêÑÂ±§„Åß <span class="math notranslate nohighlight">\(\mathbf{W}\)</span> „ÇíÊèÉ„Åà„Çã„Åì„Å®„ÅåÂâçÊèê„Åß„ÅôÔºâ„ÄÇ„Åì„ÅÆ„Åü„ÇÅ„ÄÅGGN„ÅØÂ§ß„Åç„Å™„Çø„É≥„Éë„ÇØË≥™„ÇÑÂ§ß„Åç„Å™„É¶„Éã„ÉÉ„Éà„Çª„É´„Çí„ÇÇ„Å§ÁµêÊô∂ÊßãÈÄ†„ÅÆ„Çà„ÅÜ„Å™„ÄÅÂ§ß„Åç„Å™„Ç∞„É©„Éï„Å´ÈÅ©„Åó„Å¶„ÅÑ„Åæ„ÅôÔºàË®≥Ê≥®ÔºöGGN„É¨„Ç§„É§„Éº„Çí‰ΩïÂ±§„ÇÇ„Çπ„Çø„ÉÉ„ÇØ„Åô„Çã„Åì„Å®„Åß„ÄÅ„Çà„ÇäÈÅ†„Åè„ÅÆ„Éé„Éº„Éâ„Åã„Çâ„ÅÆÊÉÖÂ†±„ÇíÂèñ„ÇäËæº„ÇÄ„Åì„Å®„Åå„Åß„Åç„Çã„Åü„ÇÅ„Åß„ÅôÔºâ„ÄÇ</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>GNN„Å´„ÅØ„Çà„Åè‚Äùgated‚Äù„Å®„ÅÑ„ÅÜÊé•È†≠Ë™û„Åå„Å§„ÅÑ„Å¶„ÅÑ„Åæ„Åô„Åå„ÄÅ„Åì„Çå„ÅØ„Éé„Éº„Éâ„ÅåGRU„Å´„Çà„Å£„Å¶Êõ¥Êñ∞„Åï„Çå„Çã„Åì„Å®„ÇíÊÑèÂë≥„Åó„Åæ„Åô„ÄÇ</p>
</aside>
</section>
<section id="pooling">
<h2><span class="section-number">8.8. </span>Pooling<a class="headerlink" href="#pooling" title="Permalink to this headline">¬∂</a></h2>
<p>„É°„ÉÉ„Çª„Éº„Ç∏„Éë„ÉÉ„Ç∑„É≥„Ç∞„ÅÆË¶≥ÁÇπ„ÄÅ„Åä„Çà„Å≥‰∏ÄËà¨„Å´GNNS„Åß„ÅØ„ÄÅËøëÂÇç„Åã„Çâ„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÁµêÂêà„Åô„ÇãÊñπÊ≥ï„ÅåÈáçË¶Å„Å™„Çπ„ÉÜ„ÉÉ„Éó„Å®„Å™„Çä„Åæ„Åô„ÄÇ„Åì„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÅØÁï≥„ÅøËæº„Åø„Éã„É•„Éº„É©„É´„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Åß‰Ωø„Çè„Çå„Çã„Éó„Éº„É™„É≥„Ç∞Â±§„Å´‰ºº„Å¶„ÅÑ„Çã„Åü„ÇÅ„ÄÅ<strong>„Éó„Éº„É™„É≥„Ç∞</strong>„Å®Âëº„Å∞„Çå„Çã„Åì„Å®„ÇÇ„ÅÇ„Çä„Åæ„Åô„ÄÇÁï≥„ÅøËæº„Åø„Éã„É•„Éº„É©„É´„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„ÅÆ„Éó„Éº„É™„É≥„Ç∞„Å®Âêå„Åò„Çà„ÅÜ„Å´„ÄÅ„Åì„ÅÆ„Åü„ÇÅ„Å´‰ΩøÁî®„Åß„Åç„ÇãÁ∏ÆÁ¥ÑÊìç‰Ωú„ÅØË§áÊï∞„ÅÇ„Çä„Åæ„Åô„ÄÇ‰∏ÄËà¨ÁöÑ„Å´„ÄÅGNN„ÅÆ„Éó„Éº„É™„É≥„Ç∞„Å´„ÅØ„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÂêàË®à„Åæ„Åü„ÅØÂπ≥Âùá„Åå‰Ωø„Çè„Çå„Åæ„Åô„Åå„ÄÅ„Ç∞„É©„ÉïÂêåÂûã„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÔºàGraph Isomorphism NetworksÔºâ <span id="id17">[<a class="reference internal" href="#id94" title="Keyulu Xu, Weihua Hu, Jure Leskovec, and Stefanie Jegelka. How powerful are graph neural networks? In International Conference on Learning Representations. 2018.">XHLJ18</a>]</span> „ÅÆ„Çà„ÅÜ„Å´ÈùûÂ∏∏„Å´Ê¥óÁ∑¥„Åï„Çå„ÅüÊìç‰Ωú„ÇíÁî®„ÅÑ„Çã„Åì„Å®„ÇÇ„Åß„Åç„Åæ„Åô„ÄÇ„Åì„ÅÆ‰ªñ„Å´„ÇÇ„ÄÅ‰æã„Åà„Å∞Ê≥®ÊÑèÔºàattentionÔºâ„ÅÆÁ´†„Åß„ÅØËá™Â∑±Ê≥®ÊÑèÔºàself-attentionÔºâ„Çí‰Ωø„ÅÜ‰æã„ÇíÊâ±„ÅÑ„Åæ„Åô„Åå„ÄÅ„Åì„Çå„Çâ„ÅÆÊìç‰Ωú„ÇÇ„Éó„Éº„É™„É≥„Ç∞„Å´‰Ωø„Åà„Åæ„Åô„ÄÇ„Éó„Éº„É™„É≥„Ç∞„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÇíËâ≤„ÄÖ„Å®Â∑•Â§´„Åó„Åü„Åè„Å™„Çã„Åì„Å®„ÇÇ„ÅÇ„Çä„Åæ„Åô„Åå„ÄÅ„Éó„Éº„É™„É≥„Ç∞Êìç‰Ωú„ÅÆÈÅ∏Êäû„ÅØ„É¢„Éá„É´„ÅÆÊÄßËÉΩ„Å´„Å®„Å£„Å¶„Åù„Çå„Åª„Å©ÈáçË¶Å„Åß„ÅØ„Å™„ÅÑ„Åì„Å®„ÅåÁµåÈ®ìÁöÑ„Å´ÂàÜ„Åã„Å£„Å¶„ÅÑ„Åæ„Åô <span id="id18">[<a class="reference internal" href="#id93" title="Enxhell Luzhnica, Ben Day, and Pietro Li√≤. On graph classification networks, datasets and baselines. arXiv preprint arXiv:1905.04682, 2019.">LDLio19</a>, <a class="reference internal" href="#id92" title="Diego Mesquita, Amauri Souza, and Samuel Kaski. Rethinking pooling in graph neural networks. Advances in Neural Information Processing Systems, 2020.">MSK20</a>]</span>„ÄÇ„Éó„Éº„É™„É≥„Ç∞„ÅÆÈáçË¶Å„Å™ÁâπÊÄß„ÅØ<em>È†ÜÂ∫è‰∏çÂ§âÊÄß</em>„Åß„ÄÅÈõÜÁ¥ÑÊìç‰Ωú„ÅØ„Éé„Éº„ÉâÔºà„Éó„Éº„É™„É≥„Ç∞„ÅÆÂ†¥Âêà„ÅØ„Ç®„ÉÉ„Ç∏Ôºâ„ÅÆÈ†ÜÂ∫è„Å´‰æùÂ≠ò„Åó„Å™„ÅÑÊÄßË≥™„ÇíÂÇô„Åà„Çã„Åì„Å®„ÅåÊúõ„Åæ„Çå„Åæ„Åô„ÄÇGrattarola„Çâ <span id="id19">[<a class="reference internal" href="#id199" title="Daniele Grattarola, Daniele Zambon, Filippo Maria Bianchi, and Cesare Alippi. Understanding pooling in graph neural networks. arXiv preprint arXiv:2110.05292, 2021.">GZBA21</a>]</span>„Åå„ÄÅ„Éó„Éº„É™„É≥„Ç∞ÊâãÊ≥ï„Å´Èñ¢„Åô„ÇãÊúÄËøë„ÅÆ„É¨„Éì„É•„Éº„ÇíÂá∫Áâà„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ</p>
<p>Daigavane„Çâ„ÅÆË´ñÊñá <span id="id20">[<a class="reference internal" href="#id201" title="Ameya Daigavane, Balaraman Ravindran, and Gaurav Aggarwal. Understanding convolutions on graphs. Distill, 2021. https://distill.pub/2021/understanding-gnns. doi:10.23915/distill.00032.">DRA21</a>]</span> „Åß„ÅØ„ÄÅÊßò„ÄÖ„Å™„Éó„Éº„É™„É≥„Ç∞Êà¶Áï•„ÅÆÊØîËºÉ„Å®Ê¶ÇË¶Å„ÅåË¶ñË¶öÁöÑ„Å´Á¥π‰ªã„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ</p>
</section>
<section id="readout-function">
<h2><span class="section-number">8.9. </span>Readout Function<a class="headerlink" href="#readout-function" title="Permalink to this headline">¬∂</a></h2>
<p>GNN„ÅÆÂá∫Âäõ„ÅØ„Ç∞„É©„Éï„Åß„ÅôÔºà„Åù„ÅÜË®≠Ë®à„Åï„Çå„Å¶„ÅÑ„Çã„ÅÆ„ÅßÂΩì„Åü„ÇäÂâç„Åß„Åô„ÅåÔºâ„ÄÇ„Åó„Åã„Åó„ÄÅ‰∫àÊ∏¨„Åó„Åü„ÅÑ„É©„Éô„É´„ÇÇ„Ç∞„É©„Éï„Åß„ÅÇ„Çã„Åì„Å®„ÅØÁ®Ä„Åß„ÄÅ‰∏ÄËà¨ÁöÑ„Å´„ÅØ„É©„Éô„É´„ÅØÂêÑ„Éé„Éº„Éâ„Åæ„Åü„ÅØ„Ç∞„É©„ÉïÂÖ®‰Ωì„Å´ÂØæ„Åó„Å¶‰ªò‰∏é„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Éé„Éº„Éâ„É©„Éô„É´„ÅÆ‰æã„ÅØÂéüÂ≠ê„ÅÆÈÉ®ÂàÜÈõªËç∑„ÄÅ„Ç∞„É©„Éï„É©„Éô„É´„ÅÆ‰æã„ÅØÂàÜÂ≠ê„ÅÆ„Ç®„Éç„É´„ÇÆ„Éº„Åß„Åô„ÄÇGNN„Åã„ÇâÂá∫Âäõ„Åï„Çå„Çã„Ç∞„É©„Éï„Çí„ÄÅ‰∫àÊ∏¨„Çø„Éº„Ç≤„ÉÉ„Éà„Åß„ÅÇ„Çã„Éé„Éº„Éâ„É©„Éô„É´„ÇÑ„Ç∞„É©„Éï„É©„Éô„É´„Å´Â§âÊèõ„Åô„Çã„Éó„É≠„Çª„Çπ„Çí <strong>Ë™≠„ÅøÂá∫„Åó ÔºàreadoutÔºâ</strong> „Å®Âëº„Å≥„Åæ„Åô„ÄÇ„Éé„Éº„Éâ„É©„Éô„É´„Çí‰∫àÊ∏¨„Åô„ÇãÂ†¥Âêà„Åß„ÅÇ„Çå„Å∞„ÄÅÂçòÁ¥î„Å´„Ç®„ÉÉ„Ç∏ÁâπÂæ¥„ÇíÊç®„Å¶„Å¶„ÄÅGNN„Åã„ÇâÂá∫Âäõ„Åï„Çå„Çã„Éé„Éº„ÉâÁâπÂæ¥„Éô„ÇØ„Éà„É´„Çí‰∫àÊ∏¨ÁµêÊûú„Å®„Åó„Å¶Êâ±„ÅÜ„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ„Åì„ÅÆÂ†¥Âêà„ÄÅÂá∫ÂäõÂ±§„ÅÆÂâç„Å´„ÅÑ„Åè„Å§„Åã„ÅÆÂÖ®ÁµêÂêàÂ±§„ÇíÊåü„ÇÄ„Åì„Å®„ÅåÂ§ö„ÅÑ„Åß„Åó„Çá„ÅÜ„ÄÇ</p>
<p>ÂàÜÂ≠ê„ÅÆ„Ç®„Éç„É´„ÇÆ„Éº„ÇÑÂÆüÂäπÈõªËç∑„ÅÆ„Çà„ÅÜ„Å™„Ç∞„É©„Éï„É¨„Éô„É´„ÅÆ„É©„Éô„É´„Çí‰∫àÊ∏¨„Åô„ÇãÂ†¥Âêà„ÄÅ„Éé„Éº„Éâ/„Ç®„ÉÉ„Ç∏ÁâπÂæ¥„Çí„Ç∞„É©„Éï„É©„Éô„É´„Å´Â§âÊèõ„Åô„Çã„Éó„É≠„Çª„Çπ„Å´Ê≥®ÊÑè„ÅåÂøÖË¶Å„Åß„Åô„ÄÇÊâÄÊúõ„ÅÆshape„ÅÆ„Ç∞„É©„Éï„É©„Éô„É´„ÇíÂæó„Çã„Åü„ÇÅ„Å´„ÄÅÂçòÁ¥î„Å´„Éé„Éº„ÉâÁâπÂæ¥„ÇíÂÖ®ÁµêÂêàÂ±§„Å´ÂÖ•Âäõ„Åó„ÅüÂ†¥Âêà„ÄÅÈ†ÜÂ∫èÁ≠â‰æ°ÊÄß„ÅåÂ§±„Çè„Çå„Å¶„Åó„Åæ„ÅÑ„Åæ„ÅôÔºàÂá∫Âäõ„ÅØ„Éé„Éº„Éâ„É©„Éô„É´„Åß„ÅØ„Å™„Åè„Ç∞„É©„Éï„É©„Éô„É´„Å™„ÅÆ„Åß„ÄÅÂé≥ÂØÜ„Å´„ÅØ„ÄÅÈ†ÜÂ∫èÁ≠â‰æ°ÊÄß„Åß„ÅØ„Å™„ÅèÈ†ÜÂ∫è‰∏çÂ§âÊÄß„Åß„ÅôÔºâ„ÄÇÊ∫∂Ëß£Â∫¶„ÅÆ‰æã„ÅßÁî®„ÅÑ„ÅüË™≠„ÅøÂá∫„Åó„ÅØ„ÄÅ„Éé„Éº„ÉâÁâπÂæ¥Èáè„Å´ÂØæ„Åó„Å¶Á∏ÆÁ¥ÑÊìç‰Ωú„ÇíË°å„ÅÜ„Åì„Å®„Åß„Åó„Åü„ÄÇ„Åù„ÅÆÂæå„Åß„Ç∞„É©„ÉïÁâπÂæ¥„ÇíÂÖ®ÁµêÂêàÂ±§„Å´ÂÖ•Âäõ„Åó„Å¶‰∫àÊ∏¨ÁµêÊûú„ÇíÂæó„Åæ„Åó„Åü„ÄÇÂÆü„ÅØ„ÄÅ„Åì„Çå„Åå„Ç∞„É©„ÉïÁâπÂæ¥„ÅÆË™≠„ÅøÂá∫„Åó„ÇíË°å„ÅÜÂîØ‰∏Ä„ÅÆÊñπÊ≥ï„Åß„ÅÇ„Çã„Åì„Å®„ÅåÁ§∫„Åï„Çå„Å¶„ÅÑ„Åæ„Åô <span id="id21">[<a class="reference internal" href="#id119" title="Manzil Zaheer, Satwik Kottur, Siamak Ravanbakhsh, Barnabas Poczos, Russ R Salakhutdinov, and Alexander J Smola. Deep sets. In Advances in neural information processing systems, 3391‚Äì3401. 2017.">ZKR+17</a>]</span> „ÄÇ„Åô„Å™„Çè„Å°„ÄÅ„Ç∞„É©„ÉïÁâπÂæ¥„ÇíÂæó„Çã„Åü„ÇÅ„Å´„Éé„Éº„ÉâÁâπÂæ¥„ÅÆÁ∏ÆÁ¥ÑÊìç‰Ωú„ÇíË°å„ÅÑ„ÄÅ„Åì„ÅÆ„Ç∞„É©„ÉïÁâπÂæ¥„ÇíÂÖ®ÁµêÂêàÂ±§„Å´ÂÖ•Âäõ„Åô„Çã„Åì„Å®„Åß‰∫àÊ∏¨ÁµêÊûú„Åß„ÅÇ„Çã„Ç∞„É©„Éï„É©„Éô„É´„ÇíÂæó„Åæ„Åô„ÄÇÂêÑ„Éé„Éº„Éâ„ÅÆÁâπÂæ¥Èáè„Å´ÂØæ„Åó„Å¶„Åù„Çå„Åû„ÇåÂÖ®ÁµêÂêàÂ±§„ÇíÈÄö„ÅôÊìç‰Ωú„ÇÇ„Åß„Åç„Åæ„Åô„Åå„ÄÅ„Éé„Éº„ÉâÁâπÂæ¥„Å∏„ÅÆÂÖ®ÁµêÂêàÂ±§„ÅÆÈÅ©Áî®„ÅØGNNÂÜÖÈÉ®„ÅßÊó¢„Å´Ë°å„Çè„Çå„Å¶„ÅÑ„Çã„ÅÆ„Åß„ÄÅ„ÅÇ„Åæ„Çä„ÅäÂãß„ÇÅ„Åó„Åæ„Åõ„Çì„ÄÇ„Åì„ÅÆ„Ç∞„É©„ÉïÁâπÂæ¥„ÅÆË™≠„ÅøÂá∫„Åó„ÅØDeepSets„Å®Âëº„Å∞„Çå„Çã„Åì„Å®„ÇÇ„ÅÇ„Çä„Åæ„Åô„ÄÇ„Åì„Çå„ÅØ„ÄÅÁâπÂæ¥„ÅåÈõÜÂêàÔºàË®≥Ê≥®ÔºöÈ†ÜÂ∫è„ÇíÊåÅ„Åü„Åö„ÄÅÂÄãÊï∞„Åå‰∏çÂÆöÔºâ„Å®„Åó„Å¶‰∏é„Åà„Çâ„Çå„ÇãÂ†¥Âêà„ÅÆ„Åü„ÇÅ„Å´Ë®≠Ë®à„Åï„Çå„Åü„ÄÅÈ†ÜÂ∫è‰∏çÂ§â„Å™„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£„Åß„ÅÇ„ÇãDeepSets <span id="id22">[<a class="reference internal" href="#id119" title="Manzil Zaheer, Satwik Kottur, Siamak Ravanbakhsh, Barnabas Poczos, Russ R Salakhutdinov, and Alexander J Smola. Deep sets. In Advances in neural information processing systems, 3391‚Äì3401. 2017.">ZKR+17</a>]</span> „Å®Âêå„ÅòÂΩ¢„Åß„ÅÇ„Çã„Åü„ÇÅ„Åß„Åô„ÄÇ</p>
<p>„Éó„Éº„É™„É≥„Ç∞„ÇÇË™≠„ÅøÂá∫„Åó„ÇÇÈ†ÜÂ∫è‰∏çÂ§â„ÅÆÈñ¢Êï∞„Åå‰Ωø„Çè„Çå„Å¶„ÅÑ„Çã„Åì„Å®„Å´„ÅäÊ∞ó„Å•„Åç„Åß„Åó„Çá„ÅÜ„Åã„ÄÇ„Åó„Åü„Åå„Å£„Å¶„ÄÅDeepSets„ÅØ„Éó„Éº„É™„É≥„Ç∞„Å´„ÄÅattention„ÅØË™≠„ÅøÂá∫„Åó„Å´‰ΩøÁî®„Åô„Çã„Åì„Å®„ÇÇ„Åß„Åç„Åæ„Åô„ÄÇ</p>
<section id="intensive-vs-extensive">
<h3><span class="section-number">8.9.1. </span>Intensive vs Extensive<a class="headerlink" href="#intensive-vs-extensive" title="Permalink to this headline">¬∂</a></h3>
<p>ÂõûÂ∏∞„Çø„Çπ„ÇØ„Åß„ÅÆË™≠„ÅøÂá∫„Åó„Å´„Åä„ÅÑ„Å¶ËÄÉÊÖÆ„Åô„Åπ„ÅçÈáçË¶Å„Å™ÁÇπ„ÅÆ1„Å§„ÅØ„ÄÅ„É©„Éô„É´„Åå <strong>intensive</strong> „Åã <strong>extensive</strong> „Åã„Åß„Åô„ÄÇIntensive„É©„Éô„É´„ÅØ„ÄÅ„Éé„Éº„ÉâÔºàÔºùÂéüÂ≠êÔºâ„ÅÆÊï∞„Å´‰æùÂ≠ò„Åó„Å™„ÅÑÂÄ§„ÇíÊåÅ„Å§„É©„Éô„É´„Åß„Åô„ÄÇ‰æã„Åà„Å∞„ÄÅÂ±àÊäòÁéá„ÇÑÊ∫∂Ëß£Â∫¶„Å™„Å©„ÅØIntensive„É©„Éô„É´„Åß„Åô„ÄÇIntensive„É©„Éô„É´„ÅÆË™≠„ÅøÂá∫„Åó„ÅØ„ÄÅ‰∏ÄËà¨„Å´„Éé„Éº„Éâ„ÅÆÊï∞„Å´‰æùÂ≠ò„Åó„Å™„ÅÑ„Åì„Å®„ÅåË¶ÅË´ã„Åï„Çå„Åæ„Åô„ÄÇ„Åó„Åü„Åå„Å£„Å¶„ÄÅ„Åì„ÅÆÂ†¥Âêà„ÅÆË™≠„ÅøÂá∫„Åó„Å´„Åä„Åë„ÇãÁ∏ÆÁ¥ÑÊìç‰Ωú„Å®„Åó„Å¶„ÄÅÂπ≥Âùá„ÇÑÊúÄÂ§ß„Çí„Å®„ÇãÊìç‰Ωú„ÅØÈÅ©Áî®ÂèØËÉΩ„Åß„Åô„Åå„ÄÅ„Éé„Éº„ÉâÊï∞„Å´„Çà„ÇäÂÄ§„ÅåÂ§â„Çè„Çã„Åü„ÇÅÂêàË®à„ÅØÈÅ©„Åó„Åæ„Åõ„Çì„ÄÇÂØæÁÖßÁöÑ„Å´„ÄÅExtensive„É©„Éô„É´„Åß„ÅØ„ÄÅÔºà‰∏ÄËà¨ÁöÑ„Å´„ÅØÔºâË™≠„ÅøÂá∫„Åó„ÅÆÁ∏ÆÁ¥ÑÊìç‰Ωú„Å´„ÅØÔºà„Éé„Éº„ÉâÊï∞„ÇíÂèçÊò†„Åß„Åç„Çã„Åü„ÇÅÔºâÂêàË®à„ÅåÈÅ©„Åó„Åæ„Åô„ÄÇextensive„Å™ÂàÜÂ≠êÁâπÊÄß„ÅÆ‰æã„Å´„ÅØ„ÄÅÁîüÊàê„Ç®„É≥„Çø„É´„Éî„Éº„ÅåÊåô„Åí„Çâ„Çå„Åæ„Åô„ÄÇ</p>
</section>
</section>
<section id="battaglia-general-equations">
<h2><span class="section-number">8.10. </span>Battaglia General Equations<a class="headerlink" href="#battaglia-general-equations" title="Permalink to this headline">¬∂</a></h2>
<p>„Åì„Åì„Åæ„Åß„ÅßÂ≠¶„Çì„Å†„Çà„ÅÜ„Å´„ÄÅGNN„É¨„Ç§„É§„Éº„ÅØ„É°„ÉÉ„Çª„Éº„Ç∏„Éë„ÉÉ„Ç∑„É≥„Ç∞„É¨„Ç§„É§„Éº„Å®„Åó„Å¶‰∏ÄËà¨Âåñ„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åó„Åü„ÄÇBattaglia„Çâ <span id="id23">[<a class="reference internal" href="#id78" title="Peter W Battaglia, Jessica B Hamrick, Victor Bapst, Alvaro Sanchez-Gonzalez, Vinicius Zambaldi, Mateusz Malinowski, Andrea Tacchetti, David Raposo, Adam Santoro, Ryan Faulkner, and others. Relational inductive biases, deep learning, and graph networks. arXiv preprint arXiv:1806.01261, 2018.">BHB+18</a>]</span> „ÅØ„Åï„Çâ„Å´ÈÄ≤„Çì„Åß„ÄÅ„Åª„Åº„Åô„Åπ„Å¶„ÅÆGNN„ÇíË®òËø∞„Åß„Åç„Çã‰∏ÄËà¨ÁöÑ„Å™ÊñπÁ®ãÂºè„ÅÆÈõÜÂêà„ÇíËÄÉÊ°à„Åó„Åæ„Åó„Åü„ÄÇÂΩº„Çâ„ÅØGNN„É¨„Ç§„É§„Éº„ÅÆÊñπÁ®ãÂºè„Çí„ÄÅ„É°„ÉÉ„Çª„Éº„Ç∏„Éë„ÉÉ„Ç∑„É≥„Ç∞„É¨„Ç§„É§„Éº„ÅÆÊñπÁ®ãÂºè„Å´„Åä„Åë„Çã„Éé„Éº„ÉâÊõ¥Êñ∞Âºè„ÅÆ„Çà„ÅÜ„Å™3„Å§„ÅÆÊõ¥Êñ∞ÊñπÁ®ãÂºè„Å®„ÄÅ3„Å§„ÅÆÈõÜÁ¥ÑÊñπÁ®ãÂºè„Å®„ÅÑ„ÅÜÂêàË®à6„Å§„ÅÆÂºè„Å´ÂàÜËß£„Åó„Åæ„Åó„Åü„ÄÇ„Åì„Çå„Çâ„ÅÆÂºè„Åß„ÅØ„ÄÅ„Ç∞„É©„ÉïÁâπÂæ¥„Éô„ÇØ„Éà„É´„Å®„ÅÑ„ÅÜÊñ∞„Åó„ÅÑÊ¶ÇÂøµ„ÅåÂ∞éÂÖ•„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åì„ÅÆ„Ç¢„Ç§„Éá„Ç£„Ç¢„Åß„ÅØ„ÄÅ„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Å´2„Å§„ÅÆÈÉ®ÂàÜÔºàGNN„Å®Ë™≠„ÅøÂá∫„ÅóÔºâ„ÇíÊåÅ„Åü„Åõ„Çã‰ª£„Çè„Çä„Å´„ÄÅ„Ç∞„É©„Éï„É¨„Éô„É´„ÅÆÁâπÂæ¥„ÇíÂêÑGNN„É¨„Ç§„É§„Éº„ÅßÊõ¥Êñ∞„Åô„Çã„Ç¢„Éó„É≠„Éº„ÉÅ„Çí„Å®„Çä„Åæ„Åô„ÄÇ„Ç∞„É©„ÉïÁâπÂæ¥„Éô„ÇØ„Éà„É´„ÅØ„ÄÅ„Ç∞„É©„ÉïÂÖ®‰Ωì„ÇíË°®„ÅôÁâπÂæ¥„ÅÆÈõÜÂêà„Åß„Åô„ÄÇ‰æã„Åà„Å∞Ê∫∂Ëß£Â∫¶„ÇíË®àÁÆó„Åô„ÇãÂ†¥Âêà„ÅØ„ÄÅË™≠„ÅøÂá∫„ÅóÈñ¢Êï∞„ÇíÊåÅ„Å§‰ª£„Çè„Çä„Å´ÂàÜÂ≠êÂÖ®‰Ωì„ÅÆÁâπÂæ¥„Éô„ÇØ„Éà„É´„ÇíÊßãÁØâ„Åó„ÄÅ„Åì„Çå„ÇíÊõ¥Êñ∞„Åó„Å¶ÊúÄÁµÇÁöÑ„Å´Ê∫∂Ëß£Â∫¶„Çí‰∫àÊ∏¨„Åô„ÇãÊñπÊ≥ï„ÅåÊúâÂäπ„Å†„Å£„ÅüÂèØËÉΩÊÄß„ÇÇ„ÅÇ„Çä„Åæ„Åô„ÄÇ„Åì„ÅÆ„Çà„ÅÜ„Å´„ÄÅÂàÜÂ≠êÂÖ®‰Ωì„Å´„Å§„ÅÑ„Å¶ÂÆöÁæ©„Åï„Çå„Çã„ÅÇ„Çâ„ÇÜ„ÇãÁ®ÆÈ°û„ÅÆÈáèÔºà‰æãÔºöÊ∫∂Ëß£Â∫¶„ÄÅ„Ç®„Éç„É´„ÇÆ„ÉºÔºâ„ÅØ„ÄÅ„Ç∞„É©„Éï„É¨„Éô„É´„ÅÆÁâπÂæ¥„Éô„ÇØ„Éà„É´„ÇíÁî®„ÅÑ„Å¶‰∫àÊ∏¨„Åß„Åç„Çã„Åß„Åó„Çá„ÅÜ„ÄÇ</p>
<p>„Åì„Çå„Çâ„ÅÆÂºè„ÅÆÊúÄÂàù„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÅØ„Ç®„ÉÉ„Ç∏„ÅÆÁâπÂæ¥„Éô„ÇØ„Éà„É´„ÅÆÊõ¥Êñ∞„Åß„ÅÇ„Çä„ÄÅÊñ∞„Åü„Å´Â∞éÂÖ•„Åô„ÇãÂ§âÊï∞„Åß„ÅÇ„Çã <span class="math notranslate nohighlight">\(\vec{e}_k\)</span> „Å´„Å§„ÅÑ„Å¶„ÅÆÂºè„Å®„Åó„Å¶Ë®òËø∞„Åï„Çå„Åæ„ÅôÔºö</p>
<div class="math notranslate nohighlight" id="equation-edge-update">
<span class="eqno">(8.8)<a class="headerlink" href="#equation-edge-update" title="Permalink to this equation">¬∂</a></span>\[
\vec{e}^{'}_k = \phi^e\left( \vec{e}_k, \vec{v}_{rk}, \vec{v}_{sk}, \vec{u}\right)
\]</div>
<p><span class="math notranslate nohighlight">\(\vec{e}_k\)</span> „ÅØ„Ç®„ÉÉ„Ç∏ <span class="math notranslate nohighlight">\(k\)</span>„ÄÄ„ÅÆÁâπÂæ¥„Éô„ÇØ„Éà„É´„ÄÅ <span class="math notranslate nohighlight">\(\vec{v}_{rk}\)</span> „ÅØ„Ç®„ÉÉ„Ç∏ <span class="math notranslate nohighlight">\(k\)</span> „Å´„Å§„ÅÑ„Å¶Âèó‰ø°„Åï„Çå„Åü„Éé„Éº„ÉâÁâπÂæ¥„Éô„ÇØ„Éà„É´„ÄÅ <span class="math notranslate nohighlight">\(\vec{v}_{sk}\)</span> „ÅØ„Ç®„ÉÉ„Ç∏ <span class="math notranslate nohighlight">\(k\)</span> „Å´„Å§„ÅÑ„Å¶„Éé„Éº„ÉâÁâπÂæ¥„Éô„ÇØ„Éà„É´„ÇíÈÄÅ‰ø°„Åó„Åü„Éé„Éº„Éâ„ÄÅ <span class="math notranslate nohighlight">\(\vec{u}\)</span> „ÅØ„Ç∞„É©„ÉïÁâπÂæ¥„Éô„ÇØ„Éà„É´„ÄÅ <span class="math notranslate nohighlight">\(\phi^e\)</span> „ÅØGNN„É¨„Ç§„É§„Éº„ÅÆÂÆöÁæ©„Å´‰Ωø„Çè„Çå„Çã3Á®ÆÈ°û„ÅÆÊõ¥Êñ∞Èñ¢Êï∞„ÅÆ„ÅÜ„Å°„ÅÆ‰∏Ä„Å§„Åß„Åô„ÄÇ„Åü„Å†„Åó„ÄÅ„Åì„Åì„ÅßË®Ä„ÅÜ3Á®ÆÈ°û„ÅÆÊõ¥Êñ∞Èñ¢Êï∞„Å®„ÅØ‰∏ÄËà¨Âåñ„Åó„ÅüË°®Áèæ„Åß„ÅÇ„Çä„ÄÅÂøÖ„Åö„Åó„ÇÇ3Á®ÆÈ°û„ÇíÂÆöÁæ©„Åô„ÇãÂøÖË¶Å„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ„Åì„Åì„Åß„ÅØ„Åù„ÅÆ„ÅÜ„Å°„ÅÆ‰∏Ä„Å§„Åß„ÅÇ„Çã <span class="math notranslate nohighlight">\(\phi^e\)</span> „ÇíÁî®„ÅÑ„Å¶GNN„É¨„Ç§„É§„Éº„ÇíÂÆöÁæ©„Åó„Åæ„Åô„ÄÇ</p>
<p>„Åì„Åì„ÅßÊâ±„ÅÜÂàÜÂ≠ê„Ç∞„É©„Éï„ÅØÁÑ°Âêë„Ç∞„É©„Éï„Å™„ÅÆ„Åß„ÄÅ„Å©„ÅÆ„Éé„Éº„Éâ„Åå <span class="math notranslate nohighlight">\(\vec{v}_{rk}\)</span> „ÇíÂèó‰ø°„Åó„ÄÅ„Å©„ÅÆ„Éé„Éº„Éâ„Åå <span class="math notranslate nohighlight">\(\vec{v}_{sk}\)</span> „ÇíÈÄÅ‰ø°„Åô„Çã„Åã„Çí„Å©„ÅÆ„Çà„ÅÜ„Å´Ê±∫„ÇÅ„Çå„Å∞ËâØ„ÅÑ„Åß„Åó„Çá„ÅÜ„ÅãÔºü „Åù„Çå„Åû„Çå„ÅÆ <span class="math notranslate nohighlight">\(\vec{e}^{'}_k\)</span> „ÅØÊ¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„Åß„Éé„Éº„Éâ <span class="math notranslate nohighlight">\(v_{rk}\)</span> „Å∏„ÅÆÂÖ•Âäõ„Å®„Åó„Å¶ÈõÜÁ¥Ñ„Åï„Çå„Åæ„Åô„ÄÇÂàÜÂ≠ê„Ç∞„É©„Éï„Åß„ÅØ„ÄÅÂÖ®„Å¶„ÅÆÁµêÂêà„ÅØÂéüÂ≠ê„Åã„Çâ„ÅÆ„ÄåÂÖ•Âäõ„Äç„Å®„ÄåÂá∫Âäõ„Äç„ÅÆ‰∏°Êñπ„ÇíÂÖº„Å≠„Çã„Åü„ÇÅ„ÄÅÂÖ®„Å¶„ÅÆÁµêÂêà„Çí2„Å§„ÅÆÊúâÂêë„Ç®„ÉÉ„Ç∏„Å®„Åó„Å¶Âèñ„ÇäÊâ±„ÅÜ„Åì„Å®„Å´„Åó„Åæ„ÅôÔºà‰ªñ„Å´ËâØ„ÅÑÊñπÊ≥ï„Åå„Å™„ÅÑ„ÅÆ„Åß„ÅôÔºâÔºöC-HÁµêÂêà„ÅØC„Åã„ÇâH„Å∏„ÅÆËæ∫„Å®H„Åã„ÇâC„Å∏„ÅÆ„Ç®„ÉÉ„Ç∏„ÅßÊßãÊàê„Åï„Çå„Çã„Åì„Å®„Å´„Å™„Çä„Åæ„Åô„ÄÇÊúÄÂàù„ÅÆÁñëÂïè„Å´Êàª„Çä„Åæ„Åô„Åå„ÄÅ <span class="math notranslate nohighlight">\(\vec{v}_{rk} \)</span>„Å® <span class="math notranslate nohighlight">\(\vec{v}_{sk}\)</span> „Å®„ÅØ‰Ωï„Åß„Åó„Çá„ÅÜ„ÅãÔºüÈö£Êé•Ë°åÂàó„ÅÆ„Åô„Åπ„Å¶„ÅÆË¶ÅÁ¥†Ôºà<span class="math notranslate nohighlight">\(k\)</span>Ôºâ„ÇíËÄÉ„Åà„ÄÅ<span class="math notranslate nohighlight">\(k = \{ij\}\)</span> „Åô„Å™„Çè„Å°Ë¶ÅÁ¥† <span class="math notranslate nohighlight">\(A_{ij}\)</span> „Å´„Å§„ÅÑ„Å¶„ÅØ„ÄÅÂèó‰ø°„Éé„Éº„Éâ„Åå <span class="math notranslate nohighlight">\(j\)</span> „ÄÅÈÄÅ‰ø°„Éé„Éº„Éâ„Åå <span class="math notranslate nohighlight">\(i\)</span> „Åß„ÅÇ„Çã„Åì„Å®„ÇíË°®„Åó„Åæ„Åô„ÄÇÈÄÜÂêë„Åç„ÅÆ„Ç®„ÉÉ„Ç∏„Å´„Åä„Åë„ÇãÈö£Êé•Ë°åÂàó„ÅÆË¶ÅÁ¥† <span class="math notranslate nohighlight">\(A_{ji}\)</span> „ÇíËÄÉ„Åà„Çã„Å®„ÄÅÂèó‰ø°„Éé„Éº„Éâ„Åå <span class="math notranslate nohighlight">\(i\)</span> „ÄÅÈÄÅ‰ø°„Éé„Éº„Éâ„Åå <span class="math notranslate nohighlight">\(j\)</span> „Å®„Å™„Çä„Åæ„Åô„ÄÇ</p>
<p><span class="math notranslate nohighlight">\(\vec{e}^{'}_k\)</span> „ÅØGCN„Åã„Çâ„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆ„Çà„ÅÜ„Å™„ÇÇ„ÅÆ„Åß„Åô„Åå„ÄÅ„Çà„Çä‰∏ÄËà¨ÁöÑ„Åß„ÄÅÂèó‰ø°„Éé„Éº„Éâ„Å®„Ç∞„É©„ÉïÁâπÂæ¥„Éô„ÇØ„Éà„É´ <span class="math notranslate nohighlight">\(\vec{u}\)</span> „ÅÆÊÉÖÂ†±„ÇíÂèçÊò†„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇÊó•Â∏∏ÁöÑ„Å™ÊÑèÂë≥„Åß„ÅÆ„Äå„É°„ÉÉ„Çª„Éº„Ç∏„Äç„ÅØ‰∏ÄÂ∫¶ÈÄÅ‰ø°„Åï„Çå„Çå„Å∞Ë™∞Ôºà„ÅÇ„Çã„ÅÑ„ÅØ‰ΩïÔºâ„Å´Âèó‰ø°„Åï„Çå„Çã„Åã„Å´„Çà„Å£„Å¶ÂÜÖÂÆπ„ÅåÂ§â„Çè„Çã„Çè„Åë„Åß„ÅØ„Å™„ÅÑ„ÅÆ„Åß„ÄÅ <span class="math notranslate nohighlight">\(\vec{e}^{'}_k\)</span> „Çí„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÊØîÂñ©„ÅßË™¨Êòé„Åó„Çà„ÅÜ„Å®„Åô„Çã„Å®„Åä„Åã„Åó„Å™„Åì„Å®„Å´„Å™„Çä„Åæ„Åô„ÄÇ„Å®„ÇÇ„Åã„Åè„ÄÅÊñ∞„Åó„ÅÑ„Ç®„ÉÉ„Ç∏„ÅÆÊõ¥Êñ∞„ÅØ„ÄÅÊúÄÂàù„ÅÆÈõÜÁ¥ÑÈñ¢Êï∞„ÅßÈõÜÁ¥Ñ„Åï„Çå„Åæ„ÅôÔºö</p>
<div class="math notranslate nohighlight" id="equation-edge-aggregation">
<span class="eqno">(8.9)<a class="headerlink" href="#equation-edge-aggregation" title="Permalink to this equation">¬∂</a></span>\[
\bar{e}^{'}_i = \rho^{e\rightarrow v}\left( E_i^{'}\right)
\]</div>
<p><span class="math notranslate nohighlight">\(\rho^{e\rightarrow v}\)</span> „ÅØÊàë„ÄÖ„ÅåÂÆöÁæ©„Åó„ÅüÈñ¢Êï∞„ÄÅ <span class="math notranslate nohighlight">\(E_i^{'}\)</span> „ÅØ„Éé„Éº„Éâ <span class="math notranslate nohighlight">\(i\)</span> „Å´ <strong>Âêë„Åã„ÅÜ</strong> ÂÖ®„Å¶„ÅÆ„Ç®„ÉÉ„Ç∏„Åã„Çâ„ÅÆ <span class="math notranslate nohighlight">\(\vec{e}^{'}_k\)</span> „Çí„Çπ„Çø„ÉÉ„ÇØ„Åó„Åü„ÇÇ„ÅÆ„Åß„Åô„ÄÇÈõÜÁ¥Ñ„Åï„Çå„Åü„Ç®„ÉÉ„Ç∏„Çí‰Ωø„Å£„Å¶„ÄÅ„Éé„Éº„Éâ„ÅÆÊõ¥Êñ∞„ÇíË®àÁÆó„Åß„Åç„Åæ„ÅôÔºö</p>
<div class="math notranslate nohighlight" id="equation-node-update">
<span class="eqno">(8.10)<a class="headerlink" href="#equation-node-update" title="Permalink to this equation">¬∂</a></span>\[
\vec{v}^{'}_i = \phi^v\left( \bar{e}^{'}_i, \vec{v}_i, \vec{u}\right)
\]</div>
<p>‰ª•‰∏ä„ÅßÊñ∞„Åó„ÅÑ„Éé„Éº„Éâ„Å®„Ç®„ÉÉ„Ç∏„ÅåÂæó„Çâ„Çå„Åü„ÅÆ„Åß„ÄÅGNN„É¨„Ç§„É§„Éº„ÅÆÈÄöÂ∏∏„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÅØÂÆå‰∫Ü„Åß„Åô„ÄÇ„ÇÇ„Åó„Ç∞„É©„ÉïÁâπÂæ¥ (<span class="math notranslate nohighlight">\(\vec{u}\)</span>) „ÇíÊõ¥Êñ∞„Åô„ÇãÂ†¥Âêà„ÄÅ‰ª•‰∏ã„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÅåËøΩÂä†„ÅßÂÆöÁæ©„Åï„Çå„Çã„Åì„Å®„Åå„ÅÇ„Çä„Åæ„ÅôÔºö</p>
<div class="math notranslate nohighlight" id="equation-edge-all-aggregation">
<span class="eqno">(8.11)<a class="headerlink" href="#equation-edge-all-aggregation" title="Permalink to this equation">¬∂</a></span>\[
\bar{e}^{'} = \rho^{e\rightarrow u}\left( E^{'}\right)
\]</div>
<p>„Åì„ÅÆÂºè„ÅØ„ÄÅ„Ç∞„É©„ÉïÂÖ®‰Ωì„Å´„Å§„ÅÑ„Å¶ÂÖ®„Å¶„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏/ÈõÜÁ¥Ñ„Åï„Çå„Åü„Ç®„ÉÉ„Ç∏„ÇíÈõÜÁ¥Ñ„Åó„Åæ„Åô„ÄÇ„Åì„Çå„Å´„Çà„Çä„ÄÅÊñ∞„Åó„ÅÑ„Éé„Éº„Éâ„Çí„Ç∞„É©„ÉïÂÖ®‰Ωì„Å´„Å§„ÅÑ„Å¶ÈõÜÁ¥Ñ„Åß„Åç„Åæ„ÅôÔºö</p>
<div class="math notranslate nohighlight" id="equation-node-all-aggregation">
<span class="eqno">(8.12)<a class="headerlink" href="#equation-node-all-aggregation" title="Permalink to this equation">¬∂</a></span>\[
\bar{v}^{'} = \rho^{v\rightarrow u}\left( V^{'}\right)
\]</div>
<p>„Åù„Åó„Å¶ÊúÄÂæå„Å´„ÄÅÊ¨°„ÅÆ„Çà„ÅÜ„Å´„Åó„Å¶„Ç∞„É©„ÉïÁâπÂæ¥„Éô„ÇØ„Éà„É´„ÇíÊõ¥Êñ∞„Åß„Åç„Åæ„ÅôÔºö</p>
<div class="math notranslate nohighlight" id="equation-global-update">
<span class="eqno">(8.13)<a class="headerlink" href="#equation-global-update" title="Permalink to this equation">¬∂</a></span>\[
\vec{u}^{'} = \phi^u\left( \bar{e}^{'},\bar{v}^{'}, \vec{u}\right)
\]</div>
<section id="battaglia-equationsgcn">
<h3><span class="section-number">8.10.1. </span>Battaglia equations„Å´„Çà„ÇãGCN„ÅÆÂÜçÂÆöÂºèÂåñ<a class="headerlink" href="#battaglia-equationsgcn" title="Permalink to this headline">¬∂</a></h3>
<p>Battaglia„ÅÆÂºè„Å´„Çà„ÇäGCN„Åå„Å©„ÅÆ„Çà„ÅÜ„Å´Ë®òËø∞„Åï„Çå„Çã„ÅãË¶ã„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ„Åæ„Åö <a class="reference internal" href="#equation-edge-update">(8.8)</a> „Çí‰Ωø„Å£„Å¶„ÄÅÈö£Êé•„Åô„ÇãÂèØËÉΩÊÄß„ÅÆ„ÅÇ„Çã„Åô„Åπ„Å¶„ÅÆÈö£Êé•„Éé„Éº„Éâ„Å´ÂØæ„Åó„Å¶„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË®àÁÆó„Åó„Åæ„Åô„ÄÇGCN„Åß„ÅØ„ÄÅ„É°„ÉÉ„Çª„Éº„Ç∏„ÅØÈÄÅ‰ø°ËÄÖ„Å´„ÅÆ„Åø‰æùÂ≠ò„Åó„ÄÅÂèó‰ø°ËÄÖ„Å´„ÅØ‰æù„Çâ„Å™„ÅÑ„Åì„Å®„Å´Ê≥®ÊÑè„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>„Åì„Åì„Åß‚Äù„Ç®„ÉÉ„Ç∏„ÅÆÊõ¥Êñ∞‚ÄùÈñ¢Êï∞„Çí‰Ωø„Å£„Å¶„ÅÑ„Åæ„Åô„Åå„ÄÅGCN„Åß„ÅØ„Ç®„ÉÉ„Ç∏„ÅÆÁâπÂæ¥„ÇíÁÑ°Ë¶ñ„Åó„Å¶„ÅÑ„Çã„Åì„Å®„Å´Ê≥®ÊÑè„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ„Åì„Åì„Åß„ÅØ„ÄÅ„Ç®„ÉÉ„Ç∏„ÅØ„Ç∞„É©„Éï„ÅÆÊé•Á∂ö„ÇíÂÆöÁæ©„Åô„Çã„Åü„ÇÅ„Å´„ÅÆ„Åø‰Ωø„Çè„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ</p>
</aside>
<div class="math notranslate nohighlight">
\[
\vec{e}^{'}_k = \phi^e\left( \vec{e}_k, \vec{v}_{rk}, \vec{v}_{sk}, \vec{u}\right) = \vec{v}_{sk} \mathbf{W}
\]</div>
<p><a class="reference internal" href="#equation-edge-aggregation">(8.9)</a> „Å´„Åä„ÅÑ„Å¶„Éé„Éº„Éâ <span class="math notranslate nohighlight">\(i\)</span> „Å´„ÇÑ„Å£„Å¶„Åè„Çã„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÈõÜÁ¥Ñ„Åô„Çã„Åü„ÇÅ„Å´„ÄÅ„Åì„Çå„Çâ„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÂπ≥Âùá„Çí„Å®„Çä„Åæ„ÅôÔºö</p>
<div class="math notranslate nohighlight">
\[
\bar{e}^{'}_i = \rho^{e\rightarrow v}\left( E_i^{'}\right) = \frac{1}{|E_i^{'}|}\sum E_i^{'}
\]</div>
<p>Á∂ö„ÅÑ„Å¶„ÄÅ„Éé„Éº„Éâ„ÅÆÊõ¥Êñ∞„ÇíË°å„ÅÑ„Åæ„Åô„Åå„ÄÅ„Åì„Çå„ÅØÂçò„Å´„É°„ÉÉ„Çª„Éº„Ç∏„Å´„Å§„ÅÑ„Å¶Ê¥ªÊÄßÂåñÈñ¢Êï∞„ÇíÈÅ©Áî®„Åô„Çã„Å†„Åë„Åß„Åô <a class="reference internal" href="#equation-node-update">(8.10)</a></p>
<div class="math notranslate nohighlight">
\[
\vec{v}^{'}_i = \phi^v\left( \bar{e}^{'}_i, \vec{v}_i, \vec{u}\right) = \sigma(\bar{e}^{'}_i)
\]</div>
<p>‰∏äÂºè„Å´„Åä„ÅÑ„Å¶ <span class="math notranslate nohighlight">\(\sigma(\bar{e}^{'}_i + \vec{v}_i)\)</span> „Å®Â§âÊõ¥„ÇíÂä†„Åà„Çã„Åì„Å®„Åß„ÄÅ„Ç∞„É©„Éï„Å´Ëá™Â∑±„É´„Éº„Éó„ÇíÊåÅ„Åü„Åõ„Çã„Åì„Å®„ÇÇÂèØËÉΩ„Åß„Åô„ÄÇGCN„Åß„ÅØ‰ªñ„ÅÆÈñ¢Êï∞„ÅØÂøÖË¶Å„Å™„ÅÑ„ÅÆ„Åß„ÄÅ„Åì„Çå„Çâ3„Å§„ÅÆÂºè„Å†„Åë„ÅßGCN„ÇíÂÆöÁæ©„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ</p>
</section>
</section>
<section id="the-schnet-architecture">
<h2><span class="section-number">8.11. </span>The SchNet Architecture<a class="headerlink" href="#the-schnet-architecture" title="Permalink to this headline">¬∂</a></h2>
<p>ÊúÄ„ÇÇÂè§„Åè„ÄÅ„Åã„Å§„Çà„ÅèÁî®„ÅÑ„Çâ„Çå„ÇãGNN„ÅÆ1„Å§„Å´„ÄÅSchNet„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ <span id="id24">[<a class="reference internal" href="#id227" title="Kristof T Sch√ºtt, Huziel E Sauceda, P-J Kindermans, Alexandre Tkatchenko, and K-R M√ºller. Schnet‚Äìa deep learning architecture for molecules and materials. The Journal of Chemical Physics, 148(24):241722, 2018.">SchuttSK+18</a>]</span> „Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÁô∫Ë°®ÂΩìÊôÇ„ÅØ„ÅÇ„Åæ„ÇäGNN„Å®„Åó„Å¶„ÅØË™çË≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„Åß„Åó„Åü„Åå„ÄÅÁèæÂú®„Åß„ÅØ„Åù„ÅÆ‰∏Ä„Å§„Å®„Åó„Å¶Ë™çË≠ò„Åï„Çå„ÄÅ„Éô„Éº„Çπ„É©„Ç§„É≥„É¢„Éá„É´„Å®„Åó„Å¶„Çà„Åè‰Ωø„Çè„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ<strong>„Éô„Éº„Çπ„É©„Ç§„É≥</strong>„É¢„Éá„É´„Å®„ÅØ„ÄÅÊñ∞ÊâãÊ≥ï„Å®„ÅÆÊØîËºÉ„Å´Áî®„ÅÑ„Çâ„Çå„Çã„É¢„Éá„É´„ÅÆ„Åì„Å®„Åß„ÄÅÂ∫É„ÅèÂèó„ÅëÂÖ•„Çå„Çâ„Çå„ÄÅ„Åã„Å§Êßò„ÄÖ„Å™ÂÆüÈ®ì„ÇíÈÄö„Åò„Å¶ËâØ„ÅÑÊÄßËÉΩ„ÇíÁ§∫„Åô„Åì„Å®„ÅåÁ¢∫Ë™ç„Åï„Çå„Å¶„ÅÑ„Çã„É¢„Éá„É´„Åå‰Ωø„Çè„Çå„Åæ„Åô„ÄÇ</p>
<aside class="margin sidebar">
<p class="sidebar-title">„Éô„Éº„Çπ„É©„Ç§„É≥„É¢„Éá„É´„Å´„Å§„ÅÑ„Å¶</p>
<p>Tips„Å®„Åó„Å¶„ÄÅ„Éá„Ç£„Éº„Éó„É©„Éº„Éã„É≥„Ç∞„ÅßÂÆüÈöõ„ÅÆÂïèÈ°å„ÇíËß£Ê±∫„Åó„Åü„ÅÑ„ÅÆ„Åß„ÅÇ„Çå„Å∞„ÄÅ„Åù„ÅÆÂàÜÈáé„ÅÆÊúÄÊñ∞„ÅÆ‰∫∫Ê∞óË´ñÊñá„Å´„Åä„ÅÑ„Å¶ÊèêÊ°à„Åï„Çå„Åü„É¢„Éá„É´„Åß„ÅØ„Å™„Åè„ÄÅ„Åù„ÅÆË´ñÊñá„ÅßÊØîËºÉ„Å´Áî®„ÅÑ„Çâ„Çå„Å¶„ÅÑ„Çã„Éô„Éº„Çπ„É©„Ç§„É≥„É¢„Éá„É´„Çí‰Ωø„ÅÜ„Åπ„Åç„Å†„Å®„ÅÑ„ÅÜ„ÇÇ„ÅÆ„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ„Åì„ÅÆÁêÜÁî±„ÅØ„ÄÅ„Éô„Éº„Çπ„É©„Ç§„É≥„É¢„Éá„É´„ÅØ„ÄÅÊúÄ„ÇÇÊ≠£Á¢∫„Åß„ÅÇ„Çã„Åì„Å®„Çà„Çä„ÇÇ„ÄÅÁ∞°Âçò„Åß„ÄÅÈÄü„Åè„ÄÅ„Çà„Åè„ÉÜ„Çπ„Éà„Åï„Çå„Å¶„ÅÑ„Çã„Åì„Å®„ÅåÈáçË¶Å„Åß„ÅÇ„Çã„Åü„ÇÅ„ÄÅ„Åì„ÅÜ„Åó„ÅüÊÄßË≥™„ÅåÂÆüÂïèÈ°å„ÅÆËß£Ê±∫„Å´„ÇÇÈáçË¶Å„Åß„ÅÇ„Çã„Åü„ÇÅ„Åß„Åô„ÄÇ</p>
</aside>
<p>„Åì„Çå„Åæ„Åß„Å´Êâ±„Å£„ÅüÂÖ®„Å¶„ÅÆ‰æã„Åß„ÅØ„ÄÅÂàÜÂ≠ê„Çí„Ç∞„É©„Éï„Å®„Åó„Å¶„É¢„Éá„É´„Å∏ÂÖ•Âäõ„Åó„Å¶„ÅÑ„Åæ„Åó„Åü„ÄÇ‰∏ÄÊñπSchNet„Åß„ÅØ„ÄÅÂàÜÂ≠ê„Ç∞„É©„Éï„Åß„ÅØ„Å™„Åè„ÄÅÂéüÂ≠ê„ÇíxyzÂ∫ßÊ®ôÔºàÁÇπÔºâ„Å®„Åó„Å¶Ë°®Áèæ„ÅóÂÖ•Âäõ„Åó„ÄÅxyzÂ∫ßÊ®ô„Çí„Ç∞„É©„Éï„Å´Â§âÊèõ„Åô„Çã„Åì„Å®„ÅßGNNN„ÇíÈÅ©Áî®„Åó„Åæ„Åô„ÄÇSchNet„ÅØ„ÄÅÁµêÂêàÊÉÖÂ†±„Å™„Åó„ÅßÂéüÂ≠ê„ÅÆÈÖçÁΩÆ„ÅÆ„Åø„Åã„Çâ„Ç®„Éç„É´„ÇÆ„Éº„ÇÑÂäõ„Çí‰∫àÊ∏¨„Åô„Çã„Åü„ÇÅ„Å´ÈñãÁô∫„Åï„Çå„Åæ„Åó„Åü„ÄÇ„Åó„Åü„Åå„Å£„Å¶„ÄÅSchNet„ÇíÁêÜËß£„Åô„Çã„Åü„ÇÅ„Å´„ÄÅ„Åæ„ÅöÂéüÂ≠ê„Å®„Åù„ÅÆ‰ΩçÁΩÆ„ÅÆ„Çª„ÉÉ„Éà„Åå„Å©„ÅÆ„Çà„ÅÜ„Å´„Ç∞„É©„Éï„Å´Â§âÊèõ„Åï„Çå„Çã„Åã„ÇíÁ¢∫Ë™ç„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇÂêÑÂéüÂ≠ê„Çí„Éé„Éº„ÉâÂåñ„Åô„ÇãÊâãÈ†Ü„ÅØÁ∞°Âçò„Åß„ÄÅ‰∏äË®ò„Å®ÂêåÊßò„ÅÆÂá¶ÁêÜ„ÇíË°å„Å£„ÅüÂæå„ÄÅÂéüÂ≠êÁï™Âè∑„Çíembedding„É¨„Ç§„É§„Éº„Å´Ê∏°„Åó„Åæ„Åô„ÄÇ„Åì„Çå„ÅØ„ÄÅÂêÑÂéüÂ≠êÁï™Âè∑„Å´Â≠¶ÁøíÂèØËÉΩ„Å™„Éô„ÇØ„Éà„É´„ÇíÂâ≤„ÇäÂΩì„Å¶„Çã„Åì„Å®ÔºàË®≥Ê≥®ÔºöÂ≠¶Áøí„Å´„Çà„Çä„ÄÅÂêÑÂéüÂ≠ê„ÅÆÊäΩË±°ÁöÑÁâπÂæ¥„ÇíÊçâ„Åà„ÅüÈ´òÊ¨°ÂÖÉ„Éô„ÇØ„Éà„É´„ÇíÂæó„Çã„Åì„Å®Ôºâ„ÇíÊÑèÂë≥„Åó„Åæ„ÅôÔºàembedding„Å´„Å§„ÅÑ„Å¶„ÅÆÂæ©Áøí„ÅØ <a class="reference internal" href="layers.html"><span class="doc">Standard Layers</span></a> „ÇíÂèÇÁÖß„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºâ„ÄÇ</p>
<p>Èö£Êé•Ë°åÂàó„ÅÆË®àÁÆó„ÇÇÁ∞°Âçò„Åß„ÄÅÂÖ®„Å¶„ÅÆÂéüÂ≠ê„ÅåÂÖ®„Å¶„ÅÆÂéüÂ≠ê„Å´Êé•Á∂ö„Åï„Çå„Çã„Çà„ÅÜ„Å´„Åô„Çã„Å†„Åë„Åß„Åô„ÄÇÂçò„Å´ÂÖ®ÂéüÂ≠ê„ÅåÁõ∏‰∫í„Å´Êé•Á∂ö„Åô„Çã„ÅÆ„Å†„Å®„Åó„Åü„Çâ„ÄÅGNN„Çí‰Ωø„ÅÜÊÑèÂë≥„Åå„Çà„Åè„Çè„Åã„Çâ„Å™„ÅÑ„Å®ÊÄù„Çè„Çå„Çã„Åã„ÇÇ„Åó„Çå„Åæ„Åõ„Çì„ÄÇ„Åì„ÅÆ„Çà„ÅÜ„Å™Êìç‰Ωú„Çí„Åô„ÇãÁêÜÁî±„ÅØ„ÄÅGNN„ÅØÈ†ÜÂ∫èÁ≠â‰æ°„Åß„ÅÇ„Çã„Åã„Çâ„Åß„Åô„ÄÇ„ÇÇ„ÅóÂéüÂ≠ê„ÇíxyzÂ∫ßÊ®ô„Å®„Åó„Å¶Â≠¶Áøí„Åó„Çà„ÅÜ„Å®„Åô„Çã„Å®ÔºåÂéüÂ≠ê„ÅÆ‰∏¶„Å≥Êñπ„Å´„Çà„Å£„Å¶Èáç„Åø„ÅåÂ§â„Çè„Å£„Å¶„Åó„Åæ„ÅÜ‰∏ä„Å´„ÄÅÊßãÈÄ†„Åî„Å®„ÅÆÂéüÂ≠êÊï∞„ÅÆÈÅï„ÅÑ„Çí„ÅÜ„Åæ„ÅèÂèñ„ÇäÊâ±„Åà„Å™„ÅÑ„Åì„Å®„Åß„Åó„Çá„ÅÜ„ÄÇ</p>
<p>SchNet„ÇíÁêÜËß£„Åô„Çã„Åü„ÇÅ„Å´„ÇÇ„ÅÜ‰∏Ä„Å§Êäº„Åï„Åà„Çã„Åπ„ÅçÁÇπ„ÅØ„ÄÅÂêÑÂéüÂ≠ê„ÅÆxyzÂ∫ßÊ®ô„ÅÆÊÉÖÂ†±„ÅØ„Å©„ÅÜÊâ±„Çè„Çå„Çã„ÅÆ„Åã„ÄÅ„Å®„ÅÑ„ÅÜ„Åì„Å®„Åß„Åô„ÄÇSchNet„Åß„ÅØ„ÄÅxyzÂ∫ßÊ®ô„Åã„Çâ„Ç®„ÉÉ„Ç∏ÁâπÂæ¥„ÇíÊßãÁØâ„Åô„Çã„Åì„Å®„Å´„Çà„Çä„ÄÅ„É¢„Éá„É´„Å´Â∫ßÊ®ô„ÅÆÊÉÖÂ†±„ÇíÂèñ„ÇäËæº„Çì„Åß„ÅÑ„Åæ„Åô„ÄÇÂéüÂ≠ê <span class="math notranslate nohighlight">\(i\)</span> „Å® <span class="math notranslate nohighlight">\(j\)</span> „ÅÆÈñì„ÅÆ„Ç®„ÉÉ„Ç∏ <span class="math notranslate nohighlight">\(\vec{e}\)</span> „ÅØ„ÄÅ„Ç∑„É≥„Éó„É´„Å´„Åì„Çå„Çâ„ÅÆÂéüÂ≠êÈñìË∑ùÈõ¢ <span class="math notranslate nohighlight">\(r\)</span> „Åã„ÇâË®àÁÆó„Åï„Çå„Åæ„Åô„ÄÇ</p>
<div class="math notranslate nohighlight" id="equation-rbf-edge">
<span class="eqno">(8.14)<a class="headerlink" href="#equation-rbf-edge" title="Permalink to this equation">¬∂</a></span>\[
e_k = \exp\left(-\gamma \left(r - \mu_k\right)^2\right)
\]</div>
<p><span class="math notranslate nohighlight">\(\gamma\)</span> „ÅØ„Éè„Ç§„Éë„Éº„Éë„É©„É°„Éº„ÇøÔºà‰æãÔºö 10√ÖÔºâ <span class="math notranslate nohighlight">\(\mu_k\)</span> „ÅØ <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">5,</span> <span class="pre">10,</span> <span class="pre">15</span> <span class="pre">,</span> <span class="pre">20]</span></code> „ÅÆ„Çà„ÅÜ„Å™„Çπ„Ç´„É©„Éº„ÅÆÁ≠âÈñìÈöî„Ç∞„É™„ÉÉ„Éâ„Åß„Åô„ÄÇ <a class="reference internal" href="#equation-rbf-edge">(8.14)</a> „ÅÆÊìç‰Ωú„ÅØ„ÄÅÂéüÂ≠êÁï™Âè∑„ÇÑÂÖ±ÊúâÁµêÂêà„ÅÆÁ®ÆÈ°û„ÅÆ„Çà„ÅÜ„Å™„Ç´„ÉÜ„Ç¥„É™ÁâπÂæ¥„Çíone-hot„Éô„ÇØ„Éà„É´„Å´Â§âÊèõ„Åô„Çã„Åì„Å®„Å´‰ºº„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åó„Åã„Åó„ÄÅ„Ç´„ÉÜ„Ç¥„É™„Ç´„É´„Å™Èáè„Å®Áï∞„Å™„Çä„ÄÅË∑ùÈõ¢„ÅØÈÄ£Á∂öÂÄ§„ÅßÁÑ°Èôê„Å´„ÅÇ„Çã„ÅÆ„Åß„ÄÅone-hot„Éô„ÇØ„Éà„É´„Å®„Åó„Å¶Ë°®Áèæ„Åô„Çã„Åì„Å®„ÅØ„Åß„Åç„Åæ„Åõ„Çì„ÄÇ„Åù„Åì„Åß„ÄÅ‰∏ÄÁ®Æ„ÅÆ„Äå„Çπ„É†„Éº„Ç∏„É≥„Ç∞„Äç„Å´„Çà„Å£„Å¶„ÄÅË∑ùÈõ¢„ÇíÊì¨‰ººÁöÑ„Å´one-hotË°®Áèæ„Åó„Å¶„ÅÑ„Çã„ÅÆ„Åß„Åô„ÄÇ„Åì„ÅÆÊÑüË¶ö„Çí„Å§„Åã„ÇÄ„Åü„ÇÅ„Å´„ÄÅ‰æã„ÇíË¶ã„Å¶„Åø„Åæ„Åó„Çá„ÅÜÔºö</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">rbf</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">gamma</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">rbf</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>input 2
output [0.02 0.78 0.   0.   0.  ]
</pre></div>
</div>
</div>
</div>
<p>Ë∑ùÈõ¢„ÄÄ<span class="math notranslate nohighlight">\(r=2\)</span> „ÅØ„ÄÅ <span class="math notranslate nohighlight">\(k = 1\)</span>„ÄÄ„ÅÆ‰ΩçÁΩÆÔºàË®≥Ê≥®Ôºök„ÅØ„Åì„ÅÆlist„ÅÆindex„ÅÆ„Åì„Å®„Åß„ÅôÔºâ„ÅåÂº∑„ÅèÊ¥ªÊÄßÂåñ„Åó„Åü„Éô„ÇØ„Éà„É´„Çí‰∏é„Åà„Çã„Åì„Å®„Åå„Çè„Åã„Çä„Åæ„Åô„ÄÇ„Åì„Çå„ÅØ <span class="math notranslate nohighlight">\(\mu_1 = 2\)</span> „Åß„ÅÇ„Çã„Åì„Å®„Å´ÂØæÂøú„Åó„Åæ„Åô„ÄÇ</p>
<p>„Åì„Åì„Åæ„Åß„Åß„Éé„Éº„Éâ„Å®„Ç®„ÉÉ„Ç∏„Åä„Çà„Å≥„ÄÅGNN„ÅÆÊõ¥Êñ∞ÊñπÁ®ãÂºè„ÇíÂÆöÁæ©„Åó„Åæ„Åó„Åü„ÄÇ„Åï„Çâ„Å´„ÇÇ„ÅÜÂ∞ë„Åó„Å†„ÅëË®òÂè∑„ÇíÂÆöÁæ©„Åó„Å¶„Åä„ÅèÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ„Åì„Åì„Åß„ÅØ„ÄÅMLPÔºàMultilayer perceptronÔºâ„ÇíË°®„Åô„Åü„ÇÅ„Å´ <span class="math notranslate nohighlight">\(h(\vec{x})\)</span> „Çí‰ΩøÁî®„Åó„Åæ„Åô„ÄÇMLP„ÅØ„ÄÅÂü∫Êú¨ÁöÑ„Å´1Â±§„ÅÇ„Çã„ÅÑ„ÅØ2Â±§„ÅÆÂÖ®ÁµêÂêà„É¨„Ç§„É§„Éº„Åã„Çâ„Å™„Çã„Éã„É•„Éº„É©„É´„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Åß„Åô„ÄÇ„Åì„Çå„Çâ„ÅÆMLP„Å´„Åä„Åë„ÇãÂÖ®ÁµêÂêà„É¨„Ç§„É§„Éº„ÅÆÊ≠£Á¢∫„Å™Êï∞„ÇÑ„ÄÅ„ÅÑ„Å§„Éª„Å©„Åì„ÅßÊ¥ªÊÄßÂåñ„ÇíË°å„ÅÜ„Åã„Å®„ÅÑ„Å£„ÅüË©≥Á¥∞„ÅØ„ÄÅÈáçË¶Å„Å™ÁÇπ„ÇíÁêÜËß£„Åô„Çã‰∏ä„Åß‰∏çË¶Å„Å™„Åü„ÇÅË™¨Êòé„ÅØÁúÅÁï•„Åó„Åæ„ÅôÔºà„Åì„Çå„Çâ„ÅÆË©≥Á¥∞„ÅØ‰ª•‰∏ã„ÅÆÂÆüË£Ö‰æã„ÇíÂèÇÁÖß„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºâ„ÄÇ„Åß„ÅØ„Åì„Åì„Åß„ÄÅÂÖ®ÁµêÂêà„É¨„Ç§„É§„Éº„ÅÆÂÆöÁæ©„ÇíÊÄù„ÅÑÂá∫„Åó„Åæ„Åó„Çá„ÅÜÔºö</p>
<div class="math notranslate nohighlight">
\[
h(\vec{x}) = \sigma\left(Wx + b\right)
\]</div>
<p>„Åæ„Åü„ÄÅSchNet„Åß„ÅØ ‚Äúshifted softplus‚Äù „Å®Âëº„Å∞„Çå„ÇãÊñ∞„Åü„Å™Ê¥ªÊÄßÂåñÈñ¢Êï∞ <span class="math notranslate nohighlight">\(\sigma\)</span> „ÇíÁî®„ÅÑ„Åæ„ÅôÔºö <span class="math notranslate nohighlight">\(\sigma = \ln\left(0.5e^{x} + 0.5\right)\)</span> „ÄÇ <a class="reference internal" href="#softplus"><span class="std std-numref">Fig. 8.4</span></a> „Å´„Åä„ÅÑ„Å¶„ÄÅ <span class="math notranslate nohighlight">\(\sigma(x)\)</span> „Å®ÈÄöÂ∏∏„ÅÆReLUÊ¥ªÊÄßÂåñ„ÇíÊØîËºÉ„Åó„ÅüÂàÜÊûê„ÅåÂ†±Âëä„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇshifted softplus„Çí‰Ωø„ÅÜÁêÜÁî±„ÅØ„ÄÅÂÖ•Âäõ„Å´ÂØæ„Åó„Å¶Êªë„Çâ„Åã„Åß„ÅÇ„Çã„Åü„ÇÅ„Åß„Åô„ÄÇ„Åì„ÅÆ„Åü„ÇÅ„ÄÅÁ≤íÂ≠êÂêåÂ£´„ÅÆË∑ùÈõ¢Ôºàpairwise distanceÔºâ„Å´ÂØæ„Åó„Å¶Êªë„Çâ„Åã„Å™ÂæÆÂàÜ„ÅåÂøÖË¶Å„Å®„Åï„Çå„ÇãÂàÜÂ≠êÂãïÂäõÂ≠¶„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„ÅÆ„Çà„ÅÜ„Å™„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Å´„Åä„ÅÑ„Å¶„ÄÅ„Éï„Ç©„Éº„ÇπÔºàË®≥Ê≥®ÔºöÁ≤íÂ≠êÂêåÂ£´„Å´ÂÉç„ÅèÂäõÔºâ„ÇíË®àÁÆó„Åô„Çã„Åü„ÇÅ„Å´SchNet„Çí‰Ωø„ÅÜ„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ</p>
<figure class="align-default" id="softplus">
<div class="cell_output docutils container">
<img alt="../_images/gnn_49_0.png" src="../_images/gnn_49_0.png" />
</div>
<figcaption>
<p><span class="caption-number">Fig. 8.4 </span><span class="caption-text">‰∏ÄËà¨ÁöÑ„Å™ReLUÊ¥ªÊÄßÂåñÈñ¢Êï∞„Å®„ÄÅSchNet„Åß‰ΩøÁî®„Åï„Çå„Å¶„ÅÑ„Çãshifted softplus„ÅÆÊØîËºÉ</span><a class="headerlink" href="#softplus" title="Permalink to this image">¬∂</a></p>
</figcaption>
</figure>
<p>„Åï„Å¶„ÄÅÂâçÁΩÆ„Åç„ÅåÁ∂ö„Åç„Åæ„Åó„Åü„Åå„ÄÅ„Çà„ÅÜ„ÇÑ„ÅèGNNÊñπÁ®ãÂºè„Å´Ë©±„ÇíÁßª„Åó„Åæ„Åô„ÄÇ„Ç®„ÉÉ„Ç∏„ÅÆÊõ¥Êñ∞ÊñπÁ®ãÂºè <a class="reference internal" href="#equation-edge-update">(8.8)</a> „ÅØ2„Å§„ÅÆÈÉ®ÂàÜ„Åã„ÇâÊàê„Çä„Åæ„Åô„ÄÇ„Åæ„Åö„ÄÅ„ÇÑ„Å£„Å¶„Åè„Çã„Ç®„ÉÉ„Ç∏ÔºàÔºùÁµêÂêàÔºâÁâπÂæ¥„Å®„ÄÅ„Éé„Éº„ÉâÔºàÔºùÂéüÂ≠êÔºâ„ÅÆÁâπÂæ¥„ÇíMLP„Å´ÈÄö„Åó„Åæ„Åô„ÄÇÁ∂ö„ÅÑ„Å¶„ÄÅ„Åù„Çå„Çâ„ÅÆÁµêÊûú„ÇíÊ¨°„ÅÆMLP„Å´ÈÄö„Åó„Åæ„ÅôÔºö</p>
<div class="math notranslate nohighlight">
\[
\vec{e}^{'}_k = \phi^e\left( \vec{e}_k, \vec{v}_{rk}, \vec{v}_{sk}, \vec{u}\right) =h_1\left(\vec{v}_{sk}\right) \cdot h_2\left(\vec{e}_k\right)
\]</div>
<p>Ê¨°„Å´„Ç®„ÉÉ„Ç∏„ÅÆÈõÜÁ¥ÑÈñ¢Êï∞ <a class="reference internal" href="#equation-edge-aggregation">(8.9)</a> „ÇíËÄÉ„Åà„Åæ„Åó„Çá„ÅÜ„ÄÇSchNet„Åß„ÅØ„ÄÅ„Ç®„ÉÉ„Ç∏ÈõÜÁ¥Ñ„ÅØËøëÂÇç„ÅÆÂéüÂ≠êÁâπÂæ¥Èáè„Å´ÂØæ„Åô„ÇãÂíå„Åß„Åô„ÄÇ</p>
<div class="math notranslate nohighlight">
\[
\bar{e}^{'}_i = \sum E_i^{'}
\]</div>
<p>ÊúÄÂæå„Å´„ÄÅSchNet„ÅÆ„Éé„Éº„ÉâÊõ¥Êñ∞Èñ¢Êï∞„ÅØ‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å´„Å™„Çä„Åæ„ÅôÔºö</p>
<div class="math notranslate nohighlight">
\[
\vec{v}^{'}_i = \phi^v\left( \bar{e}^{'}_i, \vec{v}_i, \vec{u}\right) = \vec{v}_i + h_3\left(\bar{e}^{'}_i\right)
\]</div>
<p>ÈÄöÂ∏∏„ÄÅGNN„ÅÆÊõ¥Êñ∞„ÅØ3„Äú6ÂõûÈÅ©Áî®„Åï„Çå„Åæ„Åô„ÄÇ‰∏äË®ò„ÅÆSchNet„ÅÆË™¨Êòé„Å´„Åä„ÅÑ„Å¶„ÄÅ„Ç®„ÉÉ„Ç∏„ÅÆÊõ¥Êñ∞Âºè„ÇíÂÆöÁæ©„Åó„Åæ„Åó„Åü„Åå„ÄÅGCNÂêåÊßò„Å´ÂÆüÈöõ„Å´„ÅØ„Ç®„ÉÉ„Ç∏ÁâπÂæ¥„Çí‰∏äÊõ∏„Åç„Åõ„Åö„ÄÅÂêÑÂ±§„ÅßÂêå„Åò„Ç®„ÉÉ„Ç∏ÁâπÂæ¥„Åå‰øù„Åü„Çå„Åæ„Åô„ÄÇÂÖÉ„ÄÖ„ÅÆSchNet„ÅØ„Ç®„Éç„É´„ÇÆ„Éº„ÇÑÂäõ„Çí‰∫àÊ∏¨„Åô„Çã„Åü„ÇÅ„ÅÆ„ÇÇ„ÅÆ„Å™„ÅÆ„Åß„ÄÅË™≠„ÅøÂá∫„Åó„ÅØsum-pooling„ÇÑ‰∏äË®ò„ÅÆ„Çà„ÅÜ„Å™Êà¶Áï•„ÅßË°å„ÅÜ„Åì„Å®„ÅåÂèØËÉΩ„Åß„Åô„ÄÇ</p>
<p>„Åì„Çå„Çâ„ÅÆÂºè„ÅÆË©≥Á¥∞„ÅØÂ§âÊõ¥„Åï„Çå„Çã„Åì„Å®„ÇÇ„ÅÇ„Çä„Åæ„Åô„Åå„ÄÅ„Ç™„É™„Ç∏„Éä„É´„ÅÆSchNet„ÅÆË´ñÊñá„Åß„ÅØ„ÄÅ <span class="math notranslate nohighlight">\(h_1\)</span> „ÅØÊ¥ªÊÄßÂåñ„Å™„Åó„ÅÆdense„Å™1Â±§„ÄÅ<span class="math notranslate nohighlight">\(h_2\)</span> „ÅØÊ¥ªÊÄßÂåñ„ÅÇ„Çä„ÅÆ2Â±§„ÄÅ<span class="math notranslate nohighlight">\(h_3\)</span> „ÅØ1Â±§„Å´Ê¥ªÊÄßÂåñ„ÅÇ„Çä„Éª2Â±§ÁõÆ„ÅØÊ¥ªÊÄßÂåñÁÑ°„Åó„ÅÆdense„Å™2Â±§„ÅÆÊßãÊàê„ÅåÁî®„ÅÑ„Çâ„Çå„Åæ„Åó„Åü„ÄÇ</p>
<div class="admonition-schnet admonition">
<p class="admonition-title">SchNet„Å®„ÅØ?</p>
<p>SchNet„Éô„Éº„Çπ„ÅÆGNN„ÅÆ‰∏ª„Å™ÁâπÂæ¥„ÅØ„ÄÅÔºà1Ôºâ„Ç®„ÉÉ„Ç∏„ÅÆÊõ¥Êñ∞Ôºà„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÁµÑ„ÅøÁ´ã„Å¶Ôºâ„Å´„Ç®„ÉÉ„Ç∏„Å®„Éé„Éº„Éâ„ÅÆÁâπÂæ¥„ÇíÁî®„ÅÑ„Çã„Åì„Å®„Åß„ÅôÔºö</p>
<div class="math notranslate nohighlight">
\[
\vec{e}^{'}_k = h_1(\vec{v}_{sk}) \cdot h_2(\vec{e}_k)
\]</div>
<p>„Åì„Åì„Åß <span class="math notranslate nohighlight">\(h_i()\)</span> „ÅØ‰Ωï„Çâ„Åã„ÅÆÂ≠¶ÁøíÂèØËÉΩ„Å™Èñ¢Êï∞„Åß„Åô„ÄÇÁâπÂæ¥Ôºà2Ôºâ„ÅØ„ÄÅ„Éé„Éº„ÉâÊõ¥Êñ∞„Å´ÊÆãÂ∑Æ„ÇíÂà©Áî®„Åô„Çã„Åì„Å®„Åß„ÅôÔºö</p>
<div class="math notranslate nohighlight">
\[
\vec{v}^{'}_i = \vec{v}_i + h_3\left(\bar{e}^{'}_i\right)
\]</div>
</div>
<p>„Åù„ÅÆ‰ªñ„ÄÅ„Ç®„ÉÉ„Ç∏ÁâπÂæ¥„ÅÆ‰Ωú„ÇäÊñπ„ÄÅ<span class="math notranslate nohighlight">\(h_i\)</span> „ÅÆÂ±§Êï∞„ÄÅÊ¥ªÊÄßÂåñÈñ¢Êï∞„ÅÆÈÅ∏Êäû„ÄÅË™≠„ÅøÂá∫„Åó„ÅÆÊñπÊ≥ï„ÄÅ„Éù„Ç§„É≥„Éà„ÇØ„É©„Ç¶„Éâ„Çí„Ç∞„É©„Éï„Å´Â§âÊèõ„Åô„ÇãÊñπÊ≥ï„Å™„Å©„ÄÅË©≥Á¥∞„ÅØÂÖ®„Å¶ <span id="id25">[<a class="reference internal" href="#id227" title="Kristof T Sch√ºtt, Huziel E Sauceda, P-J Kindermans, Alexandre Tkatchenko, and K-R M√ºller. Schnet‚Äìa deep learning architecture for molecules and materials. The Journal of Chemical Physics, 148(24):241722, 2018.">SchuttSK+18</a>]</span> „ÅßÊèêÊ°à„Åï„Çå„ÅüSchNet„É¢„Éá„É´„ÅÆÂÆöÁæ©„Å´Ê∫ñÊã†„Åó„Åæ„Åô„ÄÇ</p>
</section>
<section id="schnet-example-predicting-space-groups">
<h2><span class="section-number">8.12. </span>SchNet Example: Predicting Space Groups<a class="headerlink" href="#schnet-example-predicting-space-groups" title="Permalink to this headline">¬∂</a></h2>
<p>Our next example will be a SchNet model that predict space groups of points. Identifying the space group of atoms is an important part of crystal structure identification, and when doing simulations of crystallization. Our SchNet model will take as input points and output the predicted space group. This is a classification problem; specifically it is multi-class becase a set of points should only be in one space group. To simplify our plots and analysis, we will work in 2D where there are 17 possible space groups.</p>
<p>Our data for this is a set of points from various point groups. The features are xyz coordinates and the label is the space group. We will not have multiple atom types for this problem. The hidden cell below loads the data and reshapes it for the example.</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gzip</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">urllib</span>

<span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span>
    <span class="s2">&quot;https://github.com/whitead/dmol-book/raw/master/data/sym_trajs.pb.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sym_trajs.pb.gz&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;sym_trajs.pb.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">trajs</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">label_str</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">trajs</span><span class="p">]))</span>

<span class="c1"># now build dataset</span>
<span class="k">def</span> <span class="nf">generator</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">trajs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">ls</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">label_str</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span>
        <span class="n">traj</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">traj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">yield</span> <span class="n">traj</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span>


<span class="n">data</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_generator</span><span class="p">(</span>
    <span class="n">generator</span><span class="p">,</span>
    <span class="n">output_signature</span><span class="o">=</span><span class="p">(</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">TensorSpec</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">TensorSpec</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
    <span class="p">),</span>
<span class="p">)</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

<span class="c1"># The shuffling above is really important because this dataset is in order of labels!</span>

<span class="n">val_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let‚Äôs take a look at a few examples from the dataset</p>
<div class="dropdown admonition">
<p class="admonition-title">The Data</p>
<p>This data was generated from <span id="id26">[<a class="reference internal" href="#id228" title="Sam Cox and Andrew D White. Symmetric molecular dynamics. arXiv preprint arXiv:2204.01114, 2022.">CW22</a>]</span> and all points are constrained to match the space group exactly during a molecular dynamics simulation. The trajectories were NPT with a positive pressure and followed the procedure in that paper for Figure 2. The force field is Lennard-Jones with <span class="math notranslate nohighlight">\(\sigma=1\)</span> and <span class="math notranslate nohighlight">\(\epsilon=1\)</span></p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="c1"># get a few example and plot them</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">20</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">label_str</span><span class="p">[</span><span class="n">y</span><span class="o">.</span><span class="n">numpy</span><span class="p">()])</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/gnn_55_0.png" src="../_images/gnn_55_0.png" />
</div>
</div>
<p>You can see that there is a variable number of points and a few examples for each space group. The goal is to infer those titles on the plot from the points alone.</p>
<section id="building-the-graphs">
<h3><span class="section-number">8.12.1. </span>Building the graphs<a class="headerlink" href="#building-the-graphs" title="Permalink to this headline">¬∂</a></h3>
<p>We now need to build the graphs for the points. The nodes are all identical - so they can just be 1s (we‚Äôll reserve 0 in case we want to mask or pad at some point in the future). As described in the SchNet section above, the edges should be distance to every other atom. In most implementations of SchNet, we practically add a cut-off on either distance or maximum degree (edges per node). We‚Äôll do maximum degree for this work of 16.</p>
<p>I have a function below that is a bit sophisticated. It takes a matrix of point positions in arbitrary dimension and returns the distances and indices to the nearest <code class="docutils literal notranslate"><span class="pre">k</span></code> neighbors - exactly what we need. It uses some tricks from <a class="reference internal" href="../math/tensors-and-shapes.html"><span class="doc">Tensors and Shapes</span></a>. However, it is not so important for you to understand this function. Just know it takes in points and gives us the edge features and edge nodes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># this decorator speeds up the function by &quot;compiling&quot; it (tracing it)</span>
<span class="c1"># to run efficienty</span>
<span class="nd">@tf</span><span class="o">.</span><span class="n">function</span><span class="p">(</span>
    <span class="n">reduce_retracing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">get_edges</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">NN</span><span class="p">,</span> <span class="nb">sorted</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">positions</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># adjust NN</span>
    <span class="n">NN</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">NN</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
    <span class="n">qexpand</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># one column</span>
    <span class="n">qTexpand</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># one row</span>
    <span class="c1"># repeat it to make matrix of all positions</span>
    <span class="n">qtile</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">qexpand</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">qTtile</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">qTexpand</span><span class="p">,</span> <span class="p">[</span><span class="n">M</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="c1"># subtract them to get distance matrix</span>
    <span class="n">dist_mat</span> <span class="o">=</span> <span class="n">qTtile</span> <span class="o">-</span> <span class="n">qtile</span>
    <span class="c1"># mask distance matrix to remove zros (self-interactions)</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">tensor</span><span class="o">=</span><span class="n">dist_mat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">&gt;=</span> <span class="mf">5e-4</span>
    <span class="n">mask_cast</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dist</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="c1"># make masked things be really far</span>
    <span class="n">dist_mat_r</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">*</span> <span class="n">mask_cast</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">mask_cast</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="n">topk</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">top_k</span><span class="p">(</span><span class="o">-</span><span class="n">dist_mat_r</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">NN</span><span class="p">,</span> <span class="nb">sorted</span><span class="o">=</span><span class="nb">sorted</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">topk</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">topk</span><span class="o">.</span><span class="n">indices</span>
</pre></div>
</div>
</div>
</div>
<p>Let‚Äôs see how this function works by showing the connections between points in one of our examples. I‚Äôve hidden the code below. It shows some point‚Äôs neighbors and connects them so you can get a sense of how a set of points is converted into a graph. The complete graph will have all points‚Äô neighborhoods.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">collections</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">e_f</span><span class="p">,</span> <span class="n">e_i</span> <span class="o">=</span> <span class="n">get_edges</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

    <span class="c1"># make things easier for plotting</span>
    <span class="n">e_i</span> <span class="o">=</span> <span class="n">e_i</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="c1"># make lines from origin to its neigbhors</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">23</span><span class="p">):</span>
        <span class="c1"># lines are [(xstart, ystart), (xend, yend)]</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">([[(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">])]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">e_i</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span>
        <span class="n">colors</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">e_i</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
    <span class="n">lc</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">LineCollection</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">label_str</span><span class="p">[</span><span class="n">y</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/gnn_59_0.png" src="../_images/gnn_59_0.png" />
</div>
</div>
<p>We will now add this function and the edge featurization of SchNet <a class="reference internal" href="#equation-rbf-edge">(8.14)</a> to get the graphs for the GNN steps.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MAX_DEGREE</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">EDGE_FEATURES</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">MAX_R</span> <span class="o">=</span> <span class="mi">20</span>

<span class="n">gamma</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">MAX_R</span><span class="p">,</span> <span class="n">EDGE_FEATURES</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">rbf</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">gamma</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">make_graph</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">edge_r</span><span class="p">,</span> <span class="n">edge_i</span> <span class="o">=</span> <span class="n">get_edges</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">MAX_DEGREE</span><span class="p">)</span>
    <span class="n">edge_features</span> <span class="o">=</span> <span class="n">rbf</span><span class="p">(</span><span class="n">edge_r</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span> <span class="n">edge_features</span><span class="p">,</span> <span class="n">edge_i</span><span class="p">),</span> <span class="n">y</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>


<span class="n">graph_train_data</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">make_graph</span><span class="p">)</span>
<span class="n">graph_val_data</span> <span class="o">=</span> <span class="n">val_data</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">make_graph</span><span class="p">)</span>
<span class="n">graph_test_data</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">make_graph</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let‚Äôs examine one graph to see what it looks like. We‚Äôll slice out only the first nodes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">nn</span><span class="p">),</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">graph_train_data</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;first node:&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;first node, first edge features:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;first node, all neighbors&quot;</span><span class="p">,</span> <span class="n">nn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
    <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>first node: 1
first node, first edge features: [2.6120767e-01 5.5859104e-02 9.6979469e-10 1.3669308e-24 0.0000000e+00
 0.0000000e+00 0.0000000e+00 0.0000000e+00]
first node, all neighbors [283  15 262 266 302 199 277 204 212 112 269   9 201 192 275 259]
label [12]
</pre></div>
</div>
</div>
</div>
</section>
<section id="implementing-the-mlps">
<h3><span class="section-number">8.12.2. </span>Implementing the MLPs<a class="headerlink" href="#implementing-the-mlps" title="Permalink to this headline">¬∂</a></h3>
<p>Now we can implement the SchNet model! Let‚Äôs start with the <span class="math notranslate nohighlight">\(h_1,h_2,h_3\)</span> MLPs that are used in the GNN update equations. In the SchNet paper these each had different numbers of layers and different decisions about which layers had activation. Let‚Äôs create them now.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ssp</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="c1"># shifted softplus activation</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">make_h1</span><span class="p">(</span><span class="n">units</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="p">)])</span>


<span class="k">def</span> <span class="nf">make_h2</span><span class="p">(</span><span class="n">units</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">ssp</span><span class="p">),</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">ssp</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">make_h3</span><span class="p">(</span><span class="n">units</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
        <span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">ssp</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="p">)]</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>One detail that can be missed is that the weights in each MLP should change in each layer of SchNet. Thus, we‚Äôve written the functions above to always return a new MLP. This means that a new set of trainable weights is generated on each call, meaning there is no way we could erroneously have the same weights in multiple layers.</p>
</section>
<section id="implementing-the-gnn">
<h3><span class="section-number">8.12.3. </span>Implementing the GNN<a class="headerlink" href="#implementing-the-gnn" title="Permalink to this headline">¬∂</a></h3>
<p>Now we have all the pieces to make the GNN. This code will be very similar to the GCN example above, except we now have edge features. One more detail is that our readout will be an MLP as well, following the SchNet paper. The only change we‚Äôll make is that we want our output property to be (1) multi-class classification and (2) intensive (independent of number of atoms). So we‚Äôll end with an average (intensive) and end with an output vector of logits the size of our labels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SchNetModel</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Implementation of SchNet Model&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gnn_blocks</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">label_dim</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SchNetModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gnn_blocks</span> <span class="o">=</span> <span class="n">gnn_blocks</span>

        <span class="c1"># build our layers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedding</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">channels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h1s</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_h1</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gnn_blocks</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h2s</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_h2</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gnn_blocks</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h3s</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_h3</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gnn_blocks</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readout_l1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">channels</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">ssp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readout_l2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">label_dim</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
        <span class="n">nodes</span><span class="p">,</span> <span class="n">edge_features</span><span class="p">,</span> <span class="n">edge_i</span> <span class="o">=</span> <span class="n">inputs</span>
        <span class="c1"># turn node types as index to features</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gnn_blocks</span><span class="p">):</span>
            <span class="c1"># get the node features per edge</span>
            <span class="n">v_sk</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">edge_i</span><span class="p">)</span>
            <span class="n">e_k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h1s</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">v_sk</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">h2s</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">edge_features</span><span class="p">)</span>
            <span class="n">e_i</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="n">e_k</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">nodes</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h3s</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">e_i</span><span class="p">)</span>
        <span class="c1"># readout now</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readout_l1</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readout_l2</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Remember that the key attributes of a SchNet GNN are the way that we use edge and node features. We can see the mixing of these two in the key line for computing the edge update (computing message values):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">e_k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h1s</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">v_sk</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">h2s</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">edge_features</span><span class="p">)</span>
</pre></div>
</div>
<p>followed by aggregation of the edges updates (pooling messages):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">e_i</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="n">e_k</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>and the node update</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nodes</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h3s</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">e_i</span><span class="p">)</span>
</pre></div>
</div>
<p>Also of note is how we go from node features to multi-classs. We use dense layers that get the shape per-node into the number of classes</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">readout_l1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">channels</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">ssp</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">readout_l2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">label_dim</span><span class="p">)</span>
</pre></div>
</div>
<p>and then we take the average over all nodes</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<hr class="docutils" />
<p>Let‚Äôs give now use the model on some data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">small_schnet</span> <span class="o">=</span> <span class="n">SchNetModel</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">label_str</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">graph_train_data</span><span class="p">:</span>
    <span class="n">yhat</span> <span class="o">=</span> <span class="n">small_schnet</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">break</span>
<span class="nb">print</span><span class="p">(</span><span class="n">yhat</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 0.02455037  0.01222102 -0.01053292 -0.01197899  0.00917386  0.01241873
  0.03160297  0.02135343  0.00017726  0.00664034 -0.01682034 -0.01577481
  0.00546044 -0.00450091 -0.01376736  0.01938844  0.01023705]
</pre></div>
</div>
</div>
</div>
<p>The output is the correct shape and remember it is logits. To get a class prediction that sums to probability 1, we need to use a softmax:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;predicted class&quot;</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">yhat</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>predicted class [0.05999666 0.05926148 0.05792827 0.05784456 0.05908117 0.0592732
 0.06042128 0.05980515 0.05855203 0.05893168 0.05756519 0.05762541
 0.05886219 0.05827875 0.05774121 0.05968775 0.05914402]
</pre></div>
</div>
</div>
</div>
</section>
<section id="training">
<h3><span class="section-number">8.12.4. </span>Training<a class="headerlink" href="#training" title="Permalink to this headline">¬∂</a></h3>
<p>Great! It is untrained though. Now we can set-up training. Our loss will be cross-entropy from logits, but we need to be careful on the form. Our labels are integers - which is called ‚Äúsparse‚Äù labels because they are not full one-hots. Mult-class classification is also known as categorical classification. Thus, the loss we want is sparse categorical cross entropy from logits.</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">small_schnet</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">),</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">SparseCategoricalCrossentropy</span><span class="p">(</span><span class="n">from_logits</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">metrics</span><span class="o">=</span><span class="s2">&quot;sparse_categorical_accuracy&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">small_schnet</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">graph_train_data</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="n">graph_val_data</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s2">&quot;sparse_categorical_accuracy&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;training accuracy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s2">&quot;val_sparse_categorical_accuracy&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;validation accuracy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">17</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epoch&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Accuracy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/gnn_75_0.png" src="../_images/gnn_75_0.png" />
</div>
</div>
<p>The accuracy is not great, but it looks like we could keep training. We have a very small SchNet here. Standard SchNet described in <span id="id27">[<a class="reference internal" href="#id227" title="Kristof T Sch√ºtt, Huziel E Sauceda, P-J Kindermans, Alexandre Tkatchenko, and K-R M√ºller. Schnet‚Äìa deep learning architecture for molecules and materials. The Journal of Chemical Physics, 148(24):241722, 2018.">SchuttSK+18</a>]</span> uses 6 layers and 64 channels and 300 edge features. We have 3 layers and 32 channels. Nevertheless, we‚Äôre able to get some learning. Let‚Äôs visually see what‚Äôs going on with the trained model on some test data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">gx</span><span class="p">,</span> <span class="n">_</span><span class="p">))</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">graph_test_data</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">20</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>
    <span class="n">yhat</span> <span class="o">=</span> <span class="n">small_schnet</span><span class="p">(</span><span class="n">gx</span><span class="p">)</span>
    <span class="n">yhat_i</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">yhat</span><span class="p">))</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;True: </span><span class="si">{</span><span class="n">label_str</span><span class="p">[</span><span class="n">y</span><span class="o">.</span><span class="n">numpy</span><span class="p">()]</span><span class="si">}</span><span class="se">\n</span><span class="s2">Predicted: </span><span class="si">{</span><span class="n">label_str</span><span class="p">[</span><span class="n">yhat_i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/gnn_77_0.png" src="../_images/gnn_77_0.png" />
</div>
</div>
<p>We‚Äôll revisit this example later! One unique fact about this dataset is that it is <em>synthetic</em>, meaning there is no label noise. As discussed in <a class="reference internal" href="../ml/regression.html"><span class="doc">Regression &amp; Model Assessment</span></a>, that removes the possibility of overfitting and leads us to favor high variance models. The goal of teaching a model to predict space groups is to apply it on real simulations or microscopy data, which will certainly have noise. We could have mimicked this by adding noise to the labels in the data and/or by randomly removing atoms to simulate defects. This would better help our model work in a real setting.</p>
</section>
</section>
<section id="current-research-directions">
<h2><span class="section-number">8.13. </span>Current Research Directions<a class="headerlink" href="#current-research-directions" title="Permalink to this headline">¬∂</a></h2>
<section id="common-architecture-motifs-and-comparisons">
<h3><span class="section-number">8.13.1. </span>Common Architecture Motifs and Comparisons<a class="headerlink" href="#common-architecture-motifs-and-comparisons" title="Permalink to this headline">¬∂</a></h3>
<p>We‚Äôve now seen message passing layer GNNs, GCNs, GGNs, and the generalized Battaglia equations. You‚Äôll find common motifs in the architectures, like gating, <a class="reference internal" href="attention.html"><span class="doc">„Ç¢„ÉÜ„É≥„Ç∑„Éß„É≥„É¨„Ç§„É§„Éº</span></a>, and pooling strategies. For example, Gated GNNS (GGNs) can be combined with attention pooling to create Gated Attention GNNs (GAANs)<span id="id28">[<a class="reference internal" href="#id84" title="Jiani Zhang, Xingjian Shi, Junyuan Xie, Hao Ma, Irwin King, and Dit-Yan Yeung. Gaan: gated attention networks for learning on large and spatiotemporal graphs. arXiv preprint arXiv:1803.07294, 2018.">ZSX+18</a>]</span>. GraphSAGE is a similar to a GCN but it samples when pooling, making the neighbor-updates of fixed dimension<span id="id29">[<a class="reference internal" href="#id95" title="Will Hamilton, Zhitao Ying, and Jure Leskovec. Inductive representation learning on large graphs. In Advances in neural information processing systems, 1024‚Äì1034. 2017.">HYL17</a>]</span>. So you‚Äôll see the suffix ‚Äúsage‚Äù when you sample over neighbors while pooling. These can all be represented in the Battaglia equations, but you should be aware of these names.</p>
<p>The enormous variety of architectures has led to work on identifying the ‚Äúbest‚Äù or most general GNN architecture <span id="id30">[<a class="reference internal" href="#id98" title="Vijay Prakash Dwivedi, Chaitanya K Joshi, Thomas Laurent, Yoshua Bengio, and Xavier Bresson. Benchmarking graph neural networks. arXiv preprint arXiv:2003.00982, 2020.">DJL+20</a>, <a class="reference internal" href="#id97" title="Federico Errica, Marco Podda, Davide Bacciu, and Alessio Micheli. A fair comparison of graph neural networks for graph classification. In International Conference on Learning Representations. 2019.">EPBM19</a>, <a class="reference internal" href="#id96" title="Oleksandr Shchur, Maximilian Mumme, Aleksandar Bojchevski, and Stephan G√ºnnemann. Pitfalls of graph neural network evaluation. arXiv preprint arXiv:1811.05868, 2018.">SMBGunnemann18</a>]</span>. Unfortunately, the question of which GNN architecture is best is as difficult as ‚Äúwhat benchmark problems are best?‚Äù Thus there are no agreed-upon conclusions on the best architecture. However, those papers are great resources on training, hyperparameters, and reasonable starting guesses and I highly recommend reading them before designing your own GNN. There has been some theoretical work to show that simple architectures, like GCNs, cannot distinguish between certain simple graphs <span id="id31">[<a class="reference internal" href="#id94" title="Keyulu Xu, Weihua Hu, Jure Leskovec, and Stefanie Jegelka. How powerful are graph neural networks? In International Conference on Learning Representations. 2018.">XHLJ18</a>]</span>. How much this practically matters depends on your data. Ultimately, there is so much variety in hyperparameters, data equivariances, and training decisions that you should think carefully about how much the GNN architecture matters before exploring it with too much depth.</p>
</section>
<section id="nodes-edges-and-features">
<h3><span class="section-number">8.13.2. </span>Nodes, Edges, and Features<a class="headerlink" href="#nodes-edges-and-features" title="Permalink to this headline">¬∂</a></h3>
<p>You‚Äôll find that most GNNs use the node-update equation in the Battaglia equations but do not update edges. For example, the GCN will update nodes at each layer but the edges are constant. Some recent work has shown that updating edges can be important for learning when the edges have geometric information, like if the input graph is a molecule and the edges are distance between the atoms <span id="id32">[<a class="reference internal" href="#id110" title="Johannes Klicpera, Janek Gro√ü, and Stephan G√ºnnemann. Directional message passing for molecular graphs. In International Conference on Learning Representations. 2020.">KGrossGunnemann20</a>]</span>. As we‚Äôll see in the chapter on equivariances (<a class="reference internal" href="data.html"><span class="doc">Input Data &amp; Equivariances</span></a>), one of the key properties of neural networks with point clouds (i.e., Cartesian xyz coordinates) is to have rotation equivariance. <span id="id33">[<a class="reference internal" href="#id110" title="Johannes Klicpera, Janek Gro√ü, and Stephan G√ºnnemann. Directional message passing for molecular graphs. In International Conference on Learning Representations. 2020.">KGrossGunnemann20</a>]</span> showed that you can achieve this if you do edge updates and encode the edge vectors using a rotation equivariant basis set with spherical harmonics and Bessel functions. These kind of edge updating GNNs can be used to predict protein structure <span id="id34">[<a class="reference internal" href="#id111" title="Bowen Jing, Stephan Eismann, Patricia Suriana, Raphael JL Townshend, and Ron Dror. Learning from protein structure with geometric vector perceptrons. arXiv preprint arXiv:2009.01411, 2020.">JES+20</a>]</span>.</p>
<p>Another common variation on node features is to pack more into node features than just element identity. In many examples, you will see people inserting valence, elemental mass, electronegativity, a bit indicating if the atom is in a ring, a bit indicating if the atom is aromatic, etc. Typically these are unnecessary, since a model should be able to learn any of these features which are computed from the graph and node elements. However, we and others have empirically found that some can help, specifically indicating if an atom is in a ring <span id="id35">[<a class="reference internal" href="#id112" title="Zhiheng Li, Geemi P Wellawatte, Maghesree Chakraborty, Heta A Gandhi, Chenliang Xu, and Andrew D White. Graph neural network based coarse-grained mapping prediction. Chemical Science, 11(35):9524‚Äì9531, 2020.">LWC+20</a>]</span>. Choosing extra features to include though should be at the bottom of your list of things to explore when designing and using GNNs.</p>
</section>
<section id="beyond-message-passing">
<h3><span class="section-number">8.13.3. </span>Beyond Message Passing<a class="headerlink" href="#beyond-message-passing" title="Permalink to this headline">¬∂</a></h3>
<p>One of the common themes of GNN research is moving ‚Äúbeyond message passing,‚Äù where message passing is the message construction, aggregation, and node update with messages. Some view this as impossible ‚Äì claiming that all GNNs can be recast as message passing <span id="id36">[<a class="reference internal" href="#id229" title="Petar Veliƒçkoviƒá. Message passing all the way up. arXiv preprint arXiv:2202.11097, 2022.">Velivckovic22</a>]</span>. Another direction is on disconnecting the underlying graph being input to the GNN and the graph used to compute updates. We sort of saw this above with SchNet, where we restricted the maximum degree for the message passing. More useful are ideas like ‚Äúlifting‚Äù the graphs into more structured objects like simplicial complexes <span id="id37">[<a class="reference internal" href="#id231" title="Cristian Bodnar, Fabrizio Frasca, Nina Otter, Yuguang Wang, Pietro Lio, Guido F Montufar, and Michael Bronstein. Weisfeiler and lehman go cellular: cw networks. Advances in Neural Information Processing Systems, 34:2625‚Äì2640, 2021.">BFO+21</a>]</span>. Finally, you can also choose where to send the messages beyond just neighbors <span id="id38">[<a class="reference internal" href="#id230" title="Erik Thiede, Wenda Zhou, and Risi Kondor. Autobahn: automorphism-based graph neural nets. Advances in Neural Information Processing Systems, 2021.">TZK21</a>]</span>. For example, all nodes on a path could communicate messages or all nodes in a clique.</p>
</section>
<section id="do-we-need-graphs">
<h3><span class="section-number">8.13.4. </span>Do we need graphs?<a class="headerlink" href="#do-we-need-graphs" title="Permalink to this headline">¬∂</a></h3>
<p>It is possible to convert a graph into a string if you‚Äôre working with an adjacency matrix without continuous values. Molecules specifically can be converted into a string. This means you can use layers for sequences/strings (e.g., recurrent neural networks or 1D convolutions) and avoid the complexities of a graph neural network. SMILES is one way to convert molecular graphs into strings. With SMILES, you cannot predict a per-atom quantity and thus a graph neural network is required for atom/bond labels. However, the choice is less clear for per-molecule properties like toxicity or solubility. There is no consensus about if a graph or string/SMILES representation is better. SMILES can exceed certain graph neural networks in accuracy on some tasks. SMILES is typically better on generative tasks. Graphs obviously beat SMILES in label representations, because they have granularity of bonds/edges.  We‚Äôll see how to model SMILES in <a class="reference internal" href="NLP.html"><span class="doc">Deep Learning on Sequences</span></a>, but it is an open question of which is better.</p>
</section>
<section id="stereochemistry-chiral-molecules">
<h3><span class="section-number">8.13.5. </span>Stereochemistry/Chiral Molecules<a class="headerlink" href="#stereochemistry-chiral-molecules" title="Permalink to this headline">¬∂</a></h3>
<p>Stereochemistry is fundamentally a 3D property of molecules and thus not present in the covalent bonding. It is measured experimentally by seeing if molecules rotate polarized light and a molecule is called chiral or ‚Äúoptically active‚Äù if it is experimentally known to have this property. Stereochemistry is the categorization of how molecules can preferentially rotate polarized light through asymmetries with respect to their mirror images. In organic chemistry, the majority of stereochemistry is of enantiomers. Enantiomers are ‚Äúhandedness‚Äù around specific atoms called chiral centers which have 4 or more different bonded atoms. These may be treated in a graph by indicating which nodes are chiral centers (nodes) and what their state or mixture of states (racemic) are. This can be treated as an extra processing step. Amino acids and thus all proteins are entaniomers with only one form present. This chirality of proteins means many drug molecules can be more or less potent depending on their stereochemistry.</p>
<figure class="align-default" id="helicene">
<a class="autoplay-video reference internal image-reference" href="../_images/helicene.mp4"><video class="autoplay-video" src="../_images/helicene.mp4" title="../_images/helicene.mp4" width="500"><a href="../_images/helicene.mp4">../_images/helicene.mp4</a></video></a>
<figcaption>
<p><span class="caption-number">Fig. 8.5 </span><span class="caption-text">This is a molecule with axial stereochemistry. Its small helix could be either left or right-handed.</span><a class="headerlink" href="#helicene" title="Permalink to this image">¬∂</a></p>
</figcaption>
</figure>
<p>Adding node labels is not enough generally. Molecules can interconvert between stereoisomers at chiral centers through a process called tautomerization. There are also types of stereochemistry that are not at a specific atom, like rotamers that are around a bond. Then there is stereochemistry that involves multiple atoms like axial helecene. As shown in <a class="reference internal" href="#helicene"><span class="std std-numref">Fig. 8.5</span></a>, the molecule has no chiral centers but is ‚Äúoptically active‚Äù (experimentally measured to be chiral) because of its helix which can be left- or right-handed.</p>
</section>
</section>
<section id="relevant-videos">
<h2><span class="section-number">8.14. </span>Relevant Videos<a class="headerlink" href="#relevant-videos" title="Permalink to this headline">¬∂</a></h2>
<section id="intro-to-gnns">
<h3><span class="section-number">8.14.1. </span>Intro to GNNs<a class="headerlink" href="#intro-to-gnns" title="Permalink to this headline">¬∂</a></h3>
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/uF53xsT7mjc" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</section>
<section id="overview-of-gnn-with-molecule-compiler-examples">
<h3><span class="section-number">8.14.2. </span>Overview of GNN with Molecule, Compiler Examples<a class="headerlink" href="#overview-of-gnn-with-molecule-compiler-examples" title="Permalink to this headline">¬∂</a></h3>
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/zCEYiCxrL_0" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</section>
</section>
<section id="chapter-summary">
<h2><span class="section-number">8.15. </span>Chapter Summary<a class="headerlink" href="#chapter-summary" title="Permalink to this headline">¬∂</a></h2>
<ul class="simple">
<li><p>Molecules can be represented by graphs by using one-hot encoded feature vectors that show the elemental identity of each node (atom) and an adjacency matrix that show immediate neighbors (bonded atoms).</p></li>
<li><p>Graph neural networks are a category of deep neural networks that have graphs as inputs.</p></li>
<li><p>One of the early GNNs is the Kipf &amp; Welling GCN. The input to the GCN is the node feature vector and the adjacency matrix, and returns the updated node feature vector. The GCN is permutation invariant because it averages over the neighbors.</p></li>
<li><p>A GCN can be viewed as a message-passing layer, in which we have senders and receivers. Messages are computed from neighboring nodes, which when aggregated update that node.</p></li>
<li><p>A gated graph neural network is a variant of the message passing layer, for which the nodes are updated according to a gated recurrent unit function.</p></li>
<li><p>The aggregation of messages is sometimes called pooling, for which there are multiple reduction operations.</p></li>
<li><p>GNNs output a graph. To get a per-atom or per-molecule property, use a readout function. The readout depends on if your property is intensive vs extensive</p></li>
<li><p>The Battaglia equations encompasses almost all GNNs into a set of 6 update and aggregation equations.</p></li>
<li><p>You can convert xyz coordinates into a graph and use a GNN like SchNet</p></li>
</ul>
</section>
<section id="cited-references">
<h2><span class="section-number">8.16. </span>Cited References<a class="headerlink" href="#cited-references" title="Permalink to this headline">¬∂</a></h2>
<div class="docutils container" id="id39">
<dl class="citation">
<dt class="label" id="id98"><span class="brackets">DJL+20</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id30">2</a>)</span></dt>
<dd><p>Vijay¬†Prakash Dwivedi, Chaitanya¬†K Joshi, Thomas Laurent, Yoshua Bengio, and Xavier Bresson. Benchmarking graph neural networks. <em>arXiv preprint arXiv:2003.00982</em>, 2020.</p>
</dd>
<dt class="label" id="id99"><span class="brackets"><a class="fn-backref" href="#id2">BBL+17</a></span></dt>
<dd><p>Michael¬†M Bronstein, Joan Bruna, Yann LeCun, Arthur Szlam, and Pierre Vandergheynst. Geometric deep learning: going beyond euclidean data. <em>IEEE Signal Processing Magazine</em>, 34(4):18‚Äì42, 2017.</p>
</dd>
<dt class="label" id="id100"><span class="brackets"><a class="fn-backref" href="#id3">WPC+20</a></span></dt>
<dd><p>Zonghan Wu, Shirui Pan, Fengwen Chen, Guodong Long, Chengqi Zhang, and S¬†Yu Philip. A comprehensive survey on graph neural networks. <em>IEEE Transactions on Neural Networks and Learning Systems</em>, 2020.</p>
</dd>
<dt class="label" id="id112"><span class="brackets">LWC+20</span><span class="fn-backref">(<a href="#id4">1</a>,<a href="#id35">2</a>)</span></dt>
<dd><p>Zhiheng Li, Geemi¬†P Wellawatte, Maghesree Chakraborty, Heta¬†A Gandhi, Chenliang Xu, and Andrew¬†D White. Graph neural network based coarse-grained mapping prediction. <em>Chemical Science</em>, 11(35):9524‚Äì9531, 2020.</p>
</dd>
<dt class="label" id="id113"><span class="brackets"><a class="fn-backref" href="#id5">YCW20</a></span></dt>
<dd><p>Ziyue Yang, Maghesree Chakraborty, and Andrew¬†D White. Predicting chemical shifts with graph neural networks. <em>bioRxiv</em>, 2020.</p>
</dd>
<dt class="label" id="id59"><span class="brackets"><a class="fn-backref" href="#id6">XFLW+19</a></span></dt>
<dd><p>Tian Xie, Arthur France-Lanord, Yanming Wang, Yang Shao-Horn, and Jeffrey¬†C Grossman. Graph dynamical networks for unsupervised learning of atomic scale dynamics in materials. <em>Nature communications</em>, 10(1):1‚Äì9, 2019.</p>
</dd>
<dt class="label" id="id195"><span class="brackets"><a class="fn-backref" href="#id7">SLRPW21</a></span></dt>
<dd><p>Benjamin Sanchez-Lengeling, Emily Reif, Adam Pearce, and Alex Wiltschko. A gentle introduction to graph neural networks. <em>Distill</em>, 2021. https://distill.pub/2021/gnn-intro. <a class="reference external" href="https://doi.org/10.23915/distill.00033">doi:10.23915/distill.00033</a>.</p>
</dd>
<dt class="label" id="id136"><span class="brackets"><a class="fn-backref" href="#id9">XG18</a></span></dt>
<dd><p>Tian Xie and Jeffrey¬†C. Grossman. Crystal graph convolutional neural networks for an accurate and interpretable prediction of material properties. <em>Phys. Rev. Lett.</em>, 120:145301, Apr 2018. URL: <a class="reference external" href="https://link.aps.org/doi/10.1103/PhysRevLett.120.145301">https://link.aps.org/doi/10.1103/PhysRevLett.120.145301</a>, <a class="reference external" href="https://doi.org/10.1103/PhysRevLett.120.145301">doi:10.1103/PhysRevLett.120.145301</a>.</p>
</dd>
<dt class="label" id="id77"><span class="brackets"><a class="fn-backref" href="#id12">KW16</a></span></dt>
<dd><p>Thomas¬†N Kipf and Max Welling. Semi-supervised classification with graph convolutional networks. <em>arXiv preprint arXiv:1609.02907</em>, 2016.</p>
</dd>
<dt class="label" id="id81"><span class="brackets"><a class="fn-backref" href="#id14">GSR+17</a></span></dt>
<dd><p>Justin Gilmer, Samuel¬†S Schoenholz, Patrick¬†F Riley, Oriol Vinyals, and George¬†E Dahl. Neural message passing for quantum chemistry. <em>arXiv preprint arXiv:1704.01212</em>, 2017.</p>
</dd>
<dt class="label" id="id79"><span class="brackets"><a class="fn-backref" href="#id15">LTBZ15</a></span></dt>
<dd><p>Yujia Li, Daniel Tarlow, Marc Brockschmidt, and Richard Zemel. Gated graph sequence neural networks. <em>arXiv preprint arXiv:1511.05493</em>, 2015.</p>
</dd>
<dt class="label" id="id80"><span class="brackets"><a class="fn-backref" href="#id16">CGCB14</a></span></dt>
<dd><p>Junyoung Chung, Caglar Gulcehre, KyungHyun Cho, and Yoshua Bengio. Empirical evaluation of gated recurrent neural networks on sequence modeling. <em>arXiv preprint arXiv:1412.3555</em>, 2014.</p>
</dd>
<dt class="label" id="id94"><span class="brackets">XHLJ18</span><span class="fn-backref">(<a href="#id17">1</a>,<a href="#id31">2</a>)</span></dt>
<dd><p>Keyulu Xu, Weihua Hu, Jure Leskovec, and Stefanie Jegelka. How powerful are graph neural networks? In <em>International Conference on Learning Representations</em>. 2018.</p>
</dd>
<dt class="label" id="id93"><span class="brackets"><a class="fn-backref" href="#id18">LDLio19</a></span></dt>
<dd><p>Enxhell Luzhnica, Ben Day, and Pietro Li√≤. On graph classification networks, datasets and baselines. <em>arXiv preprint arXiv:1905.04682</em>, 2019.</p>
</dd>
<dt class="label" id="id92"><span class="brackets"><a class="fn-backref" href="#id18">MSK20</a></span></dt>
<dd><p>Diego Mesquita, Amauri Souza, and Samuel Kaski. Rethinking pooling in graph neural networks. <em>Advances in Neural Information Processing Systems</em>, 2020.</p>
</dd>
<dt class="label" id="id199"><span class="brackets"><a class="fn-backref" href="#id19">GZBA21</a></span></dt>
<dd><p>Daniele Grattarola, Daniele Zambon, Filippo¬†Maria Bianchi, and Cesare Alippi. Understanding pooling in graph neural networks. <em>arXiv preprint arXiv:2110.05292</em>, 2021.</p>
</dd>
<dt class="label" id="id201"><span class="brackets"><a class="fn-backref" href="#id20">DRA21</a></span></dt>
<dd><p>Ameya Daigavane, Balaraman Ravindran, and Gaurav Aggarwal. Understanding convolutions on graphs. <em>Distill</em>, 2021. https://distill.pub/2021/understanding-gnns. <a class="reference external" href="https://doi.org/10.23915/distill.00032">doi:10.23915/distill.00032</a>.</p>
</dd>
<dt class="label" id="id119"><span class="brackets">ZKR+17</span><span class="fn-backref">(<a href="#id21">1</a>,<a href="#id22">2</a>)</span></dt>
<dd><p>Manzil Zaheer, Satwik Kottur, Siamak Ravanbakhsh, Barnabas Poczos, Russ¬†R Salakhutdinov, and Alexander¬†J Smola. Deep sets. In <em>Advances in neural information processing systems</em>, 3391‚Äì3401. 2017.</p>
</dd>
<dt class="label" id="id78"><span class="brackets"><a class="fn-backref" href="#id23">BHB+18</a></span></dt>
<dd><p>Peter¬†W Battaglia, Jessica¬†B Hamrick, Victor Bapst, Alvaro Sanchez-Gonzalez, Vinicius Zambaldi, Mateusz Malinowski, Andrea Tacchetti, David Raposo, Adam Santoro, Ryan Faulkner, and others. Relational inductive biases, deep learning, and graph networks. <em>arXiv preprint arXiv:1806.01261</em>, 2018.</p>
</dd>
<dt class="label" id="id227"><span class="brackets">SchuttSK+18</span><span class="fn-backref">(<a href="#id24">1</a>,<a href="#id25">2</a>,<a href="#id27">3</a>)</span></dt>
<dd><p>Kristof¬†T Sch√ºtt, Huziel¬†E Sauceda, P-J Kindermans, Alexandre Tkatchenko, and K-R M√ºller. Schnet‚Äìa deep learning architecture for molecules and materials. <em>The Journal of Chemical Physics</em>, 148(24):241722, 2018.</p>
</dd>
<dt class="label" id="id228"><span class="brackets"><a class="fn-backref" href="#id26">CW22</a></span></dt>
<dd><p>Sam Cox and Andrew¬†D White. Symmetric molecular dynamics. <em>arXiv preprint arXiv:2204.01114</em>, 2022.</p>
</dd>
<dt class="label" id="id84"><span class="brackets"><a class="fn-backref" href="#id28">ZSX+18</a></span></dt>
<dd><p>Jiani Zhang, Xingjian Shi, Junyuan Xie, Hao Ma, Irwin King, and Dit-Yan Yeung. Gaan: gated attention networks for learning on large and spatiotemporal graphs. <em>arXiv preprint arXiv:1803.07294</em>, 2018.</p>
</dd>
<dt class="label" id="id95"><span class="brackets"><a class="fn-backref" href="#id29">HYL17</a></span></dt>
<dd><p>Will Hamilton, Zhitao Ying, and Jure Leskovec. Inductive representation learning on large graphs. In <em>Advances in neural information processing systems</em>, 1024‚Äì1034. 2017.</p>
</dd>
<dt class="label" id="id97"><span class="brackets"><a class="fn-backref" href="#id30">EPBM19</a></span></dt>
<dd><p>Federico Errica, Marco Podda, Davide Bacciu, and Alessio Micheli. A fair comparison of graph neural networks for graph classification. In <em>International Conference on Learning Representations</em>. 2019.</p>
</dd>
<dt class="label" id="id96"><span class="brackets"><a class="fn-backref" href="#id30">SMBGunnemann18</a></span></dt>
<dd><p>Oleksandr Shchur, Maximilian Mumme, Aleksandar Bojchevski, and Stephan G√ºnnemann. Pitfalls of graph neural network evaluation. <em>arXiv preprint arXiv:1811.05868</em>, 2018.</p>
</dd>
<dt class="label" id="id110"><span class="brackets">KGrossGunnemann20</span><span class="fn-backref">(<a href="#id32">1</a>,<a href="#id33">2</a>)</span></dt>
<dd><p>Johannes Klicpera, Janek Gro√ü, and Stephan G√ºnnemann. Directional message passing for molecular graphs. In <em>International Conference on Learning Representations</em>. 2020.</p>
</dd>
<dt class="label" id="id111"><span class="brackets"><a class="fn-backref" href="#id34">JES+20</a></span></dt>
<dd><p>Bowen Jing, Stephan Eismann, Patricia Suriana, Raphael¬†JL Townshend, and Ron Dror. Learning from protein structure with geometric vector perceptrons. <em>arXiv preprint arXiv:2009.01411</em>, 2020.</p>
</dd>
<dt class="label" id="id229"><span class="brackets"><a class="fn-backref" href="#id36">Velivckovic22</a></span></dt>
<dd><p>Petar Veliƒçkoviƒá. Message passing all the way up. <em>arXiv preprint arXiv:2202.11097</em>, 2022.</p>
</dd>
<dt class="label" id="id231"><span class="brackets"><a class="fn-backref" href="#id37">BFO+21</a></span></dt>
<dd><p>Cristian Bodnar, Fabrizio Frasca, Nina Otter, Yuguang Wang, Pietro Lio, Guido¬†F Montufar, and Michael Bronstein. Weisfeiler and lehman go cellular: cw networks. <em>Advances in Neural Information Processing Systems</em>, 34:2625‚Äì2640, 2021.</p>
</dd>
<dt class="label" id="id230"><span class="brackets"><a class="fn-backref" href="#id38">TZK21</a></span></dt>
<dd><p>Erik Thiede, Wenda Zhou, and Risi Kondor. Autobahn: automorphism-based graph neural nets. <em>Advances in Neural Information Processing Systems</em>, 2021.</p>
</dd>
</dl>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./dl"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="layers.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">7. </span>Standard Layers</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="data.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">9. </span>Input Data &amp; Equivariances</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Andrew D. White<br/>
    
        &copy; Copyright 2022.<br/>
      <div class="extra_footer">
        <a href="http://thewhitelab.org">thewhitelab.org</a> <div id="wh-modal"> <button class="wh-venti-button" aria-label="close modal" id="wh-modal-close">‚úï</button> <img id="wh-modal-img"> </div>
      </div>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>