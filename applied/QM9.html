
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<meta content="Deep Learning for Molecules &amp; Materials Book" lang="en" name="description" xml:lang="en" />
<meta content="en_US" property="og:locale" />
<meta content="summary" name="twitter:card" />
<meta content="Deep Learning for Molecules &amp; Materials Book" name="twitter:description" />
<meta content="dmol.pub üìñ" name="twitter:title" />
<meta content="https://dmol.pub/_static/logo.png" name="twitter:image" />
<meta content="&#64;andrewwhite01" name="twitter:site" />

    <title>18. GNN„Å´„Çà„ÇãDFT„Ç®„Éç„É´„ÇÆ„Éº„ÅÆ‰∫àÊ∏¨ &#8212; deep learning for molecules &amp; materials</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/a11y.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/custom.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="canonical" href="https://resnant.github.io/dmol-book-japanese/applied/QM9.html" />
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="19. Generative RNN in Browser" href="MolGenerator.html" />
    <link rel="prev" title="17. Normalizing Flows" href="../dl/flows.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">deep learning for molecules & materials</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   „Åì„ÅÆÊú¨„ÅÆÊ¶ÇË¶Å
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  A. Math Review
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../math/tensors-and-shapes.html">
   1. Tensors and Shapes
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  B. Machine Learning
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../ml/introduction.html">
   2. Ê©üÊ¢∞Â≠¶ÁøíÂÖ•ÈñÄ
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ml/regression.html">
   3. Regression &amp; Model Assessment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ml/classification.html">
   4. Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ml/kernel.html">
   5. „Ç´„Éº„Éç„É´Â≠¶Áøí
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  C. Deep Learning
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../dl/introduction.html">
   6. „Éá„Ç£„Éº„Éó„É©„Éº„Éã„É≥„Ç∞„ÅÆÊ¶ÇË¶Å
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dl/layers.html">
   7. Standard Layers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dl/gnn.html">
   8. Graph Neural Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dl/data.html">
   9. Input Data &amp; Equivariances
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dl/Equivariant.html">
   10. Equivariant Neural Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dl/molnets.html">
   11. Modern Molecular NNs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dl/xai.html">
   12. ‰∫àÊ∏¨„ÇíË™¨Êòé„Åô„Çã
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dl/attention.html">
   13. „Ç¢„ÉÜ„É≥„Ç∑„Éß„É≥„É¨„Ç§„É§„Éº
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dl/NLP.html">
   15. Deep Learning on Sequences
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dl/VAE.html">
   16. Variational Autoencoder
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dl/flows.html">
   17. Normalizing Flows
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  D. Applications
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   18. GNN„Å´„Çà„ÇãDFT„Ç®„Éç„É´„ÇÆ„Éº„ÅÆ‰∫àÊ∏¨
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="MolGenerator.html">
   19. Generative RNN in Browser
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  E. Contributed Chapters
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../dl/Hyperparameter_tuning.html">
   20. Hyperparameter Tuning
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  F. Appendix
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../style.html">
   21. Style Guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../changelog.html">
   22. Changelog
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  <script async defer src="https://api.dmol.pub/latest.js"></script><noscript><img src="https://api.dmol.pub/noscript.gif" alt="" referrerpolicy="no-referrer-when-downgrade" /></noscript> By <a href="https://twitter.com/andrewwhite01">Andrew White</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/applied/QM9.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/resnant/dmol-book-japanese/"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/resnant/dmol-book-japanese//issues/new?title=Issue%20on%20page%20%2Fapplied/QM9.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/resnant/dmol-book-japanese/blob/master/applied/QM9.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   18.1. „É©„Éô„É´„ÅÆË™¨Êòé
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   18.2. „Éá„Éº„Çø„ÅÆÊ∫ñÂÇô
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   18.3. „Åì„ÅÆ„Éé„Éº„Éà„Éñ„ÉÉ„ÇØ„ÅÆÂãï„Åã„ÅóÊñπ
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id5">
   18.4. „Éô„Éº„Çπ„É©„Ç§„É≥„É¢„Éá„É´
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#gnn">
   18.5. GNN„É¢„Éá„É´„ÅÆ‰æã
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#jax">
     18.5.1. JAX„Å´„Çà„Çã„É¢„Éá„É´„ÅÆÂÆüË£Ö
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#qm9">
   18.6. QM9„Éá„Éº„Çø„ÅÆÂ≠¶Áøí„Å´„Å§„ÅÑ„Å¶„ÅÆÈñ¢ÈÄ£Ë≥áÊñô
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id7">
   18.7. ÂèÇËÄÉÊñáÁåÆ
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>GNN„Å´„Çà„ÇãDFT„Ç®„Éç„É´„ÇÆ„Éº„ÅÆ‰∫àÊ∏¨</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   18.1. „É©„Éô„É´„ÅÆË™¨Êòé
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   18.2. „Éá„Éº„Çø„ÅÆÊ∫ñÂÇô
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   18.3. „Åì„ÅÆ„Éé„Éº„Éà„Éñ„ÉÉ„ÇØ„ÅÆÂãï„Åã„ÅóÊñπ
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id5">
   18.4. „Éô„Éº„Çπ„É©„Ç§„É≥„É¢„Éá„É´
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#gnn">
   18.5. GNN„É¢„Éá„É´„ÅÆ‰æã
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#jax">
     18.5.1. JAX„Å´„Çà„Çã„É¢„Éá„É´„ÅÆÂÆüË£Ö
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#qm9">
   18.6. QM9„Éá„Éº„Çø„ÅÆÂ≠¶Áøí„Å´„Å§„ÅÑ„Å¶„ÅÆÈñ¢ÈÄ£Ë≥áÊñô
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id7">
   18.7. ÂèÇËÄÉÊñáÁåÆ
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="gnndft">
<h1><span class="section-number">18. </span>GNN„Å´„Çà„ÇãDFT„Ç®„Éç„É´„ÇÆ„Éº„ÅÆ‰∫àÊ∏¨<a class="headerlink" href="#gnndft" title="Permalink to this headline">¬∂</a></h1>
<p>QM9„ÅØ„ÄÅ9„Å§‰ª•‰∏ã„ÅÆÂéüÂ≠êÔºàC, H, O, N, FÔºâ„ÅßÊßãÊàê„Åï„Çå„ÅüÂàÜÂ≠ê„ÅÆ„ÄÅ134,000‰ª∂„Å´„Åä„Çà„Å∂„Éá„Éº„Çø„Çª„ÉÉ„Éà„Åß„Åô<span id="id1">[<a class="reference internal" href="#id9" title="Raghunathan Ramakrishnan, Pavlo O Dral, Matthias Rupp, and O Anatole Von Lilienfeld. Quantum chemistry structures and properties of 134 kilo molecules. Scientific data, 1(1):1‚Äì7, 2014.">RDRVL14</a>]</span>„ÄÇ
ÁâπÂæ¥Èáè„Å´„ÅØ„ÄÅÂàÜÂ≠ê„ÇíÊßãÊàê„Åô„ÇãÂêÑÂéüÂ≠ê„ÅÆxyzÂ∫ßÊ®ô (<span class="math notranslate nohighlight">\(\mathbf{X}\)</span>) „Åä„Çà„Å≥ÂÖÉÁ¥† (<span class="math notranslate nohighlight">\(\vec{e}\)</span>)„ÅåÁî®„ÅÑ„Çâ„Çå„ÄÅÂêÑÂàÜÂ≠ê„ÅÆÊßãÈÄ†„ÅØ„ÄÅB3LYP/6-31G(2df,p) „É¨„Éô„É´„ÅÆDFTË®àÁÆó„Å´„Çà„ÇäÊßãÈÄ†Á∑©Âíå„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ
QM9„Éá„Éº„Çø„Çª„ÉÉ„Éà„ÅÆÂêÑ„Éá„Éº„Çø„Å´„ÅØË§áÊï∞„ÅÆ„É©„Éô„É´„Åå‰ªò‰∏é„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÅåÔºà‰∏ãË°®„ÇíÂèÇÁÖßÔºâ„ÄÅ„Åì„Åì„Åß„ÅØÁîüÊàê„Ç®„Éç„É´„ÇÆ„ÉºÔºà298.15K„Å´„Åä„Åë„Çã„Ç®„É≥„Çø„É´„Éî„ÉºÔºâ„Å´ÁùÄÁõÆ„Åó„Åæ„Åô„ÄÇ
„Åì„ÅÆÁ´†„ÅÆÁõÆÁöÑ„ÅØ„ÄÅÂàÜÂ≠ê„ÅÆÂ∫ßÊ®ô„Åå‰∏é„Åà„Çâ„Çå„Åü„Å®„Åç„Å´„ÄÅ„Ç∞„É©„Éï„Éã„É•„Éº„É©„É´„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„ÇíÂõûÂ∏∞„Åó„Å¶ÁîüÊàê„Ç®„Éç„É´„ÇÆ„Éº„Çí‰∫àÊ∏¨„Åô„Çã„Åì„Å®„Åß„Åô„ÄÇ„Åæ„ÅüÊú¨Á´†„Åß„ÅØ„ÄÅ„Åì„Çå„Åæ„Åß„Å´Â≠¶„Çì„Å†‰ª•‰∏ã„ÅÆÁ´†„ÅÆÂÜÖÂÆπ„ÇíÂü∫„Å´ÈÄ≤„ÇÅ„Å¶„ÅÑ„Åç„Åæ„Åô„ÄÇ</p>
<ol class="simple">
<li><p><a class="reference internal" href="../ml/regression.html"><span class="doc">Regression &amp; Model Assessment</span></a></p></li>
<li><p><a class="reference internal" href="../dl/gnn.html"><span class="doc">Graph Neural Networks</span></a></p></li>
<li><p><a class="reference internal" href="../dl/data.html"><span class="doc">Input Data &amp; Equivariances</span></a></p></li>
</ol>
<p>QM9„ÅØ„ÄÅ2014Âπ¥„Å´ÁôªÂ†¥„Åó„Å¶‰ª•Êù•„ÄÅÊúâÊ©üÂåñÂêàÁâ©„ÅÆÂàÜÂ≠êÊßãÈÄ†„ÇíÊâ±„ÅÜÊ©üÊ¢∞Â≠¶Áøí„Çø„Çπ„ÇØ„Å´„Åä„Åë„ÇãÊúÄ„ÇÇÊ®ôÊ∫ñÁöÑ„Å™„Éô„É≥„ÉÅ„Éû„Éº„ÇØ„Éá„Éº„Çø„Çª„ÉÉ„Éà„ÅÆ‰∏Ä„Å§„Åß„Åô„ÄÇ„Åì„ÅÆ„Éá„Éº„Çø„Çª„ÉÉ„Éà„ÅåÁôªÂ†¥„Åó„ÅüÂΩìÊôÇ„ÄÅ„Åì„ÅÆÁîüÊàê„Ç®„Éç„É´„ÇÆ„Éº„ÅÆÂõûÂ∏∞ÂïèÈ°å„Å´„Åä„Åë„Çã‰∫àÊ∏¨Ë™§Â∑Æ„ÅØ10kcal/molÁ®ãÂ∫¶„Åß„Åó„Åü„Åå„ÄÅÁèæÂú®„ÅØÔΩû1kcal/mol‰ª•‰∏ã„ÅÆÁ≤æÂ∫¶„ÅÆÊÄßËÉΩ„ÅåÂæó„Çâ„Çå„Çã„Åæ„Åß„Å´ÊîπÂñÑ„Åï„Çå„Åæ„Åó„Åü„ÄÇ
„Åì„ÅÆ„Éá„Éº„Çø„Çª„ÉÉ„Éà„ÇíÊâ±„ÅÜÊ©üÊ¢∞Â≠¶Áøí„É¢„Éá„É´„ÅØ„ÄÅÂàÜÂ≠ê„ÅÆÊßãÈÄ†„Å´ÂØæ„Åó„Å¶‰∏¶ÈÄ≤„ÄÅÂõûËª¢„ÄÅÈ†ÜÂàó‰∏çÂ§â„Åß„ÅÇ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ</p>
<section id="id2">
<h2><span class="section-number">18.1. </span>„É©„Éô„É´„ÅÆË™¨Êòé<a class="headerlink" href="#id2" title="Permalink to this headline">¬∂</a></h2>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Index</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Units</p></th>
<th class="text-align:right head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>0</p></td>
<td><p>index</p></td>
<td><p>-</p></td>
<td class="text-align:right"><p>Consecutive, 1-based integer identifier of molecule</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>1</p></td>
<td><p>A</p></td>
<td><p>GHz</p></td>
<td class="text-align:right"><p>Rotational constant A</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>2</p></td>
<td><p>B</p></td>
<td><p>GHz</p></td>
<td class="text-align:right"><p>Rotational constant B</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>3</p></td>
<td><p>C</p></td>
<td><p>GHz</p></td>
<td class="text-align:right"><p>Rotational constant C</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>4</p></td>
<td><p>mu</p></td>
<td><p>Debye</p></td>
<td class="text-align:right"><p>Dipole moment</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>5</p></td>
<td><p>alpha</p></td>
<td><p>Bohr^3</p></td>
<td class="text-align:right"><p>Isotropic polarizability</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>6</p></td>
<td><p>homo</p></td>
<td><p>Hartree</p></td>
<td class="text-align:right"><p>Energy of Highest occupied molecular orbital (HOMO)</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>7</p></td>
<td><p>lumo</p></td>
<td><p>Hartree</p></td>
<td class="text-align:right"><p>Energy of Lowest unoccupied molecular orbital (LUMO)</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>8</p></td>
<td><p>gap</p></td>
<td><p>Hartree</p></td>
<td class="text-align:right"><p>Gap, difference between LUMO and HOMO</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>9</p></td>
<td><p>r2</p></td>
<td><p>Bohr^2</p></td>
<td class="text-align:right"><p>Electronic spatial extent</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>10</p></td>
<td><p>zpve</p></td>
<td><p>Hartree</p></td>
<td class="text-align:right"><p>Zero point vibrational energy</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>11</p></td>
<td><p>U0</p></td>
<td><p>Hartree</p></td>
<td class="text-align:right"><p>Internal energy at 0 K</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>12</p></td>
<td><p>U</p></td>
<td><p>Hartree</p></td>
<td class="text-align:right"><p>Internal energy at 298.15 K</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>13</p></td>
<td><p>H</p></td>
<td><p>Hartree</p></td>
<td class="text-align:right"><p>Enthalpy at 298.15 K</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>14</p></td>
<td><p>G</p></td>
<td><p>Hartree</p></td>
<td class="text-align:right"><p>Free energy at 298.15 K</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>15</p></td>
<td><p>Cv</p></td>
<td><p>cal/(mol K)</p></td>
<td class="text-align:right"><p>Heat capacity at 298.15 K</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id3">
<h2><span class="section-number">18.2. </span>„Éá„Éº„Çø„ÅÆÊ∫ñÂÇô<a class="headerlink" href="#id3" title="Permalink to this headline">¬∂</a></h2>
<p>‰æøÂà©„Å™„Éò„É´„Éë„Éº„Ç≥„Éº„Éâ„Çí <code class="docutils literal notranslate"><span class="pre">fetch_data.py</span></code> „Å´Êõ∏„Åç„Åæ„Åó„Åü„ÄÇ„Åì„ÅÆ„Ç≥„Éº„Éâ„ÅØ„Éá„Éº„Çø„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„ÄÅPython„Åß‰Ωø„ÅÑ„ÇÑ„Åô„ÅÑÂΩ¢Âºè„Å´Â§âÊèõ„Åó„Åæ„Åô„ÄÇ„Åæ„Åü„Åì„ÅÆÈñ¢Êï∞„ÅØ„ÄÅQM9„Éá„Éº„Çø„ÇíÁâπÂæ¥Èáè <span class="math notranslate nohighlight">\(\mathbf{X}\)</span> „Å® <span class="math notranslate nohighlight">\(\vec{e}\)</span> „Å´Â§âÊèõ„Åó„Åæ„Åô„ÄÇ„Åì„Åì„Åß <span class="math notranslate nohighlight">\(\mathbf{X}\)</span> „ÅØÂéüÂ≠ê„ÅÆ‰ΩçÁΩÆ„Å®ÂéüÂ≠ê„ÅÆÈÉ®ÂàÜÈõªËç∑„ÅÆ <span class="math notranslate nohighlight">\(N\times4\)</span>  Ë°åÂàó„ÄÅ <span class="math notranslate nohighlight">\(vec{e}\)</span> „ÅØÂàÜÂ≠êÂÜÖ„ÅÆÂêÑÂéüÂ≠ê„ÅÆÂéüÂ≠êÁï™Âè∑„ÅÆ„Éô„ÇØ„Éà„É´„Åß„Åô„ÄÇÂÖàËø∞„ÅÆÈÄö„ÇäQM9„ÅÆÂêÑ„Éá„Éº„Çø„ÅØË§áÊï∞„ÅÆ„É©„Éô„É´ÔºàÔºù„É©„Éô„É´„Éô„ÇØ„Éà„É´Ôºâ„ÇíÊåÅ„Å§„Åì„Å®„Åã„Çâ„ÄÅ„Åì„ÅÆ„É©„Éô„É´„Éô„ÇØ„Éà„É´„Åã„ÇâÂøÖË¶Å„Å™„É©„Éô„É´„Çí„Çπ„É©„Ç§„Çπ„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çã„Åì„Å®„Å´Ê≥®ÊÑè„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
</section>
<section id="id4">
<h2><span class="section-number">18.3. </span>„Åì„ÅÆ„Éé„Éº„Éà„Éñ„ÉÉ„ÇØ„ÅÆÂãï„Åã„ÅóÊñπ<a class="headerlink" href="#id4" title="Permalink to this headline">¬∂</a></h2>
<p>„Åì„ÅÆ„Éö„Éº„Ç∏‰∏äÈÉ®„ÅÆ ¬†<i aria-label="Launch interactive content" class="fas fa-rocket"></i>¬† „ÇíÊäº„Åô„Å®„ÄÅ„Åì„ÅÆ„Éé„Éº„Éà„Éñ„ÉÉ„ÇØ„ÅåGoogle Colab.„ÅßÈñã„Åã„Çå„Åæ„Åô„ÄÇÂøÖË¶Å„Å™„Éë„ÉÉ„Ç±„Éº„Ç∏„ÅÆ„Ç§„É≥„Çπ„Éà„Éº„É´ÊñπÊ≥ï„Å´„Å§„ÅÑ„Å¶„ÅØ‰ª•‰∏ã„ÇíÂèÇÁÖß„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
<div class="dropdown admonition tip">
<p class="admonition-title">Tip</p>
<p>ÂøÖË¶Å„Å™„Éë„ÉÉ„Ç±„Éº„Ç∏„Çí„Ç§„É≥„Çπ„Éà„Éº„É´„Åô„Çã„Å´„ÅØ„ÄÅÊñ∞Ë¶è„Çª„É´„Çí‰ΩúÊàê„Åó„Å¶Ê¨°„ÅÆ„Ç≥„Éº„Éâ„ÇíÂÆüË°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!pip install dmol-book
</pre></div>
</div>
<p>„ÇÇ„Åó„Ç§„É≥„Çπ„Éà„Éº„É´„Åå„ÅÜ„Åæ„Åè„ÅÑ„Åã„Å™„ÅÑÂ†¥Âêà„ÄÅ„Éë„ÉÉ„Ç±„Éº„Ç∏„ÅÆ„Éê„Éº„Ç∏„Éß„É≥‰∏ç‰∏ÄËá¥„ÅåÂéüÂõ†„Åß„ÅÇ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÂãï‰ΩúÁ¢∫Ë™ç„Åå„Å®„Çå„ÅüÊúÄÊñ∞„Éê„Éº„Ç∏„Éß„É≥„ÅÆ‰∏ÄË¶ß„ÅØ<a class="reference external" href="https://github.com/whitead/dmol-book/blob/master/package/requirements.txt">„Åì„Åì</a>„Åã„ÇâÂèÇÁÖß„Åß„Åç„Åæ„Åô</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">fetch_data</span> <span class="kn">import</span> <span class="n">qm9_parse</span><span class="p">,</span> <span class="n">qm9_fetch</span>
<span class="kn">import</span> <span class="nn">dmol</span>
</pre></div>
</div>
</div>
</div>
<p>Êó©ÈÄü„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ„Éá„Éº„Çø„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åä„Çà„Å≥Âá¶ÁêÜ„Åô„Çã„Åü„ÇÅ„ÄÅ„Åì„ÅÆÊâãÈ†Ü„Å´„ÅØÊï∞ÂàÜ„Åã„Åã„Çä„Åæ„Åô„ÄÇ</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qm9_records</span> <span class="o">=</span> <span class="n">qm9_fetch</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">qm9_parse</span><span class="p">(</span><span class="n">qm9_records</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">data</span></code> „ÅØ133k‰ª∂„ÅÆÂàÜÂ≠ê„Éá„Éº„Çø„ÇíÂê´„ÇÄ„Ç§„ÉÜ„É©„Éñ„É´ÔºàË®≥Ê≥®ÔºöforÊñá„Åß„É´„Éº„Éó„Åß„Åç„Çã„Ç™„Éñ„Ç∏„Çß„ÇØ„ÉàÔºâ„Åß„Åô„ÄÇÊúÄÂàù„ÅÆÂàÜÂ≠ê„ÇíË¶ã„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((&lt;tf.Tensor: shape=(5,), dtype=int64, numpy=array([6, 1, 1, 1, 1])&gt;, &lt;tf.Tensor: shape=(5, 4), dtype=float32, numpy=
array([[-1.2698136e-02,  1.0858041e+00,  8.0009960e-03, -5.3568900e-01],
       [ 2.1504159e-03, -6.0313176e-03,  1.9761203e-03,  1.3392100e-01],
       [ 1.0117308e+00,  1.4637512e+00,  2.7657481e-04,  1.3392200e-01],
       [-5.4081506e-01,  1.4475266e+00, -8.7664372e-01,  1.3392299e-01],
       [-5.2381361e-01,  1.4379326e+00,  9.0639728e-01,  1.3392299e-01]],
      dtype=float32)&gt;), &lt;tf.Tensor: shape=(16,), dtype=float32, numpy=
array([ 1.0000000e+00,  1.5771181e+02,  1.5770998e+02,  1.5770699e+02,
        0.0000000e+00,  1.3210000e+01, -3.8769999e-01,  1.1710000e-01,
        5.0480002e-01,  3.5364101e+01,  4.4748999e-02, -4.0478931e+01,
       -4.0476063e+01, -4.0475117e+01, -4.0498596e+01,  6.4689999e+00],
      dtype=float32)&gt;)
</pre></div>
</div>
</div>
</div>
<p>„Åì„Çå„Çâ„ÅØTensorflow„ÅÆTensorÂûã„ÅÆ„Éá„Éº„Çø„Åß„Åô„ÄÇ„Åì„Çå„Çâ„ÅÆ„Éá„Éº„Çø„ÅØ„ÄÅ <code class="docutils literal notranslate"><span class="pre">x.numpy()</span></code> „Å´„Çà„Å£„Å¶NumPy„ÅÆarray„Å´Â§âÊèõ„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇÊúÄÂàù„ÅÆ„Ç¢„Ç§„ÉÜ„É†„ÅØÂÖÉÁ¥†„Éô„ÇØ„Éà„É´ <code class="docutils literal notranslate"><span class="pre">6,1,1,1,1</span></code> „Åß„Åô„ÄÇ„Åì„ÅÆ„Éô„ÇØ„Éà„É´„Åå„Å©„ÅÆÂÖÉÁ¥†„ÇíË°®„Åô„Åã„Çè„Åã„Çã„Åß„Åó„Çá„ÅÜ„ÅãÔºü„Åù„ÅÜ„ÄÅC, H, H, H, H„Åß„Åô„ÄÇÊ¨°„ÅÆ„Ç¢„Ç§„ÉÜ„É†„ÅØ‰ΩçÁΩÆ„Åß„Åô„ÄÇÂéüÂ≠ê„ÅÆÈÉ®ÂàÜÈõªËç∑„ÇíË°®„ÅôË°å„ÅåÂê´„Åæ„Çå„Åæ„Åô„Åå„ÄÅ‰ªäÂõû„Åì„Çå„ÅØÁâπÂæ¥Èáè„Å®„Åó„Å¶„ÅØ‰Ωø„Çè„Å™„ÅÑ„Åì„Å®„Å´Ê≥®ÊÑè„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ„Åù„Åó„Å¶ÊúÄÂæå„ÅØ„É©„Éô„É´„Éô„ÇØ„Éà„É´„Åß„Åô„ÄÇ</p>
<p>„Åì„Åì„Åß„ÄÅ„Åì„Çå„Çâ„ÅÆ„Éá„Éº„Çø„ÇíÂä†Â∑•„Åó„Å¶„Çà„ÇäÊâ±„ÅÑ„ÇÑ„Åô„ÅÑÂΩ¢Âºè„Å´„Åó„Åæ„Åô„ÄÇ„Åæ„ÅöNumPy„ÅÆarray„Å´Â§âÊèõ„Åó„ÅüÂæå„ÄÅÈÉ®ÂàÜÈõªËç∑„ÇíÂâäÈô§„Åó„ÄÅÂéüÂ≠êÁï™Âè∑„Çíone-hot„Éô„ÇØ„Éà„É´„Å´Â§âÊèõ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">convert_record</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="c1"># break up record</span>
    <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">y</span> <span class="o">=</span> <span class="n">d</span>
    <span class="c1">#</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
    <span class="c1"># make ohc size larger</span>
    <span class="c1"># so use same node feature</span>
    <span class="c1"># shape later</span>
    <span class="n">ohc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="mi">16</span><span class="p">))</span>
    <span class="n">ohc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span> <span class="n">e</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">ohc</span><span class="p">,</span> <span class="n">r</span><span class="p">),</span> <span class="n">y</span><span class="o">.</span><span class="n">numpy</span><span class="p">()[</span><span class="mi">13</span><span class="p">]</span>


<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">y</span> <span class="o">=</span> <span class="n">convert_record</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Element one hots</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Coordinates</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Label:&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Element one hots
 [[0. 0. 0. 0. 0. 1. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
 [1. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
 [1. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
 [1. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
 [1. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]]
Coordinates
 [[-1.2698136e-02  1.0858041e+00  8.0009960e-03]
 [ 2.1504159e-03 -6.0313176e-03  1.9761203e-03]
 [ 1.0117308e+00  1.4637512e+00  2.7657481e-04]
 [-5.4081506e-01  1.4475266e+00 -8.7664372e-01]
 [-5.2381361e-01  1.4379326e+00  9.0639728e-01]]
Label: -40.475117
</pre></div>
</div>
</div>
</div>
</section>
<section id="id5">
<h2><span class="section-number">18.4. </span>„Éô„Éº„Çπ„É©„Ç§„É≥„É¢„Éá„É´<a class="headerlink" href="#id5" title="Permalink to this headline">¬∂</a></h2>
<p>„É¢„Éá„É™„É≥„Ç∞„Å´Ê∑±ÂÖ•„Çä„Åô„ÇãÂâç„Å´„ÄÅ„Åæ„Åö„ÅØ„Ç∑„É≥„Éó„É´„Å™„É¢„Éá„É´„Åß„Å©„Åì„Åæ„ÅßÁ≤æÂ∫¶„Çí‰∏ä„Åí„Çâ„Çå„Çã„ÅãË©¶„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ„Åì„Çå„ÅØÂæå„Åß„Çà„ÇäÊ¥óÁ∑¥„Åï„Çå„ÅüÊâãÊ≥ï„Çí‰Ωú„Å£„ÅüÈöõ„Å´„ÄÅ„Åù„ÅÆÊâãÊ≥ï„Å®ÊØîËºÉ„Åô„Çã„Åü„ÇÅ„ÅÆ„Éô„Éº„Çπ„É©„Ç§„É≥„É¢„Éá„É´„ÇíÊ∫ñÂÇô„Åó„Å¶„Åä„Åè„Å®„ÅÑ„ÅÜÊÑèÂë≥„Åß„ÇÇÂΩπ„Å´Á´ã„Å°„Åæ„Åô„ÄÇ„Ç∑„É≥„Éó„É´„Å™„É¢„Éá„É´„Å´„ÅØÂ§ö„Åè„ÅÆÈÅ∏ÊäûËÇ¢„Åå„ÅÇ„Çä„Åæ„Åô„Åå„ÄÅ„Åì„Åì„Åß„ÅØÂê´„Åæ„Çå„ÇãÂÖÉÁ¥†„ÅÆÁ∑èÊï∞„Çí‰Ωø„Å£„ÅüÁ∑öÂΩ¢ÂõûÂ∏∞„É¢„Éá„É´„ÇíÁµÑ„Çì„Åß„Åø„Åæ„Åô„ÄÇ</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>
<span class="kn">import</span> <span class="nn">jax.experimental.optimizers</span> <span class="k">as</span> <span class="nn">optimizers</span>
<span class="kn">import</span> <span class="nn">jax</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>


<span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">baseline_model</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="c1"># get sum of each element type</span>
    <span class="n">atom_count</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">yhat</span> <span class="o">=</span> <span class="n">atom_count</span> <span class="o">@</span> <span class="n">w</span> <span class="o">+</span> <span class="n">b</span>
    <span class="k">return</span> <span class="n">yhat</span>


<span class="k">def</span> <span class="nf">baseline_loss</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">baseline_model</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>


<span class="n">baseline_loss_grad</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">baseline_loss</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="mf">0.0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="kn">import</span> <span class="nn">jax.experimental.optimizers</span> <span class="k">as</span> <span class="nn">optimizers</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="kn">import</span> <span class="nn">jax</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="kn">import</span> <span class="nn">warnings</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;jax.experimental.optimizers&#39;
</pre></div>
</div>
</div>
</div>
<p>„Åì„Çå„Åß„Ç∑„É≥„Éó„É´„Å™ÂõûÂ∏∞„É¢„Éá„É´„Åå„Åß„Åç„Åæ„Åó„Åü„ÄÇÂ∞ë„ÅóÈõ£„Åó„ÅÑÁÇπ„ÅØ„ÄÅÂêÑÂàÜÂ≠ê„ÅåÁï∞„Å™„ÇãÊï∞„ÅÆÂéüÂ≠ê„Åã„Çâ„Å™„Çã„ÄÅ„Å§„Åæ„ÇäÂàÜÂ≠ê„Åî„Å®„Å´tensor„ÅÆshape„ÅåÁï∞„Å™„Çã„Åü„ÇÅ„Å´„ÄÅÈÄöÂ∏∏„ÅÆ„Çà„ÅÜ„Å´ÂàÜÂ≠ê„Çí„Éê„ÉÉ„ÉÅÂá¶ÁêÜ„Åß„Åç„Å™„ÅÑÁÇπ„Åß„Åô„ÄÇ</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we&#39;ll just train on 5,000 and use 1,000 for test</span>
<span class="c1"># shuffle</span>
<span class="n">shuffled_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="mi">7000</span><span class="p">)</span>
<span class="n">test_set</span> <span class="o">=</span> <span class="n">shuffled_data</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">valid_set</span> <span class="o">=</span> <span class="n">shuffled_data</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">train_set</span> <span class="o">=</span> <span class="n">shuffled_data</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>„Åì„ÅÆ„Éá„Éº„Çø„ÅÆ„É©„Éô„É´„ÅØ„Åã„Å™„ÇäÂ§ß„Åç„Å™ÂÄ§„Çí„ÇÇ„Å§„Åü„ÇÅ„ÄÅ„Åù„ÅÆ„Åæ„Åæ„É¢„Éá„É´„Å´ÂÖ•Âäõ„Åô„Çã„Å®loss„ÇÇÈùûÂ∏∏„Å´Â§ß„Åç„Åè„Å™„Çä„ÄÅÂ≠¶Áøí„Åå‰∏çÂÆâÂÆö„Å´„Å™„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÂ≠¶Áøí„Åå„Çπ„É†„Éº„Ç∫„Å´ÈÄ≤„ÇÄ„Çà„ÅÜ„Å´„ÄÅ„É©„Éô„É´„ÅÆ„Çπ„Ç±„Éº„É´„ÇíÂ≠¶ÁøíÁéá„ÇÑ„Åù„ÅÆ‰ªñ„ÅÆ„Éë„É©„É°„Éº„Çø„Å´Âêà„Çè„Åõ„Å¶Â§âÊèõ„Åô„Çã„Åì„Å®„Å´„Åó„Åæ„Åô„ÄÇ</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">convert_record</span><span class="p">(</span><span class="n">d</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">train_set</span><span class="p">]</span>
<span class="n">train_ym</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span>
<span class="n">train_ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean = &quot;</span><span class="p">,</span> <span class="n">train_ym</span><span class="p">,</span> <span class="s2">&quot;Std =&quot;</span><span class="p">,</span> <span class="n">train_ys</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>„ÅÇ„Å®„ÅØÂ≠¶ÁøíÊôÇ„Å´Ê¨°„ÅÆÂ§âÊèõ <span class="math notranslate nohighlight">\(y_s = \frac{y - \mu_y}{\sigma_y}\)</span> „ÇíÂä†„Åà„ÄÅÂá∫Âäõ„Å´ÂØæ„Åó„Å¶„ÅØÈÄÜ„Å´ <span class="math notranslate nohighlight">\(\hat{y} = \hat{f}(e,x) \cdot \sigma_y + \mu_y\)</span> „Å®„Åô„Çã„Åì„Å®„Åß„ÄÅÂá∫Âäõ„ÅÆ„É¨„É≥„Ç∏„Çí‰∏ÄÂÆö„ÅÆÁØÑÂõ≤„Å´Âèé„ÇÅ„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„ÅôÔºàÊ≠£Ë¶èÂåñ„Å®Âëº„Å≥„Åæ„ÅôÔºâ„ÄÇ</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">transform_label</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">train_ym</span><span class="p">)</span> <span class="o">/</span> <span class="n">train_ys</span>


<span class="k">def</span> <span class="nf">transform_prediction</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">y</span> <span class="o">*</span> <span class="n">train_ys</span> <span class="o">+</span> <span class="n">train_ym</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epochs</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">eta</span> <span class="o">=</span> <span class="mf">1e-3</span>
<span class="n">baseline_val_loss</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">train_set</span><span class="p">:</span>
        <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">y_raw</span> <span class="o">=</span> <span class="n">convert_record</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">transform_label</span><span class="p">(</span><span class="n">y_raw</span><span class="p">)</span>
        <span class="n">grad_est</span> <span class="o">=</span> <span class="n">baseline_loss_grad</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="c1"># update regression weights</span>
        <span class="n">w</span> <span class="o">-=</span> <span class="n">eta</span> <span class="o">*</span> <span class="n">grad_est</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">b</span> <span class="o">-=</span> <span class="n">eta</span> <span class="o">*</span> <span class="n">grad_est</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># compute validation loss</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">valid_set</span><span class="p">:</span>
        <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">y_raw</span> <span class="o">=</span> <span class="n">convert_record</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">transform_label</span><span class="p">(</span><span class="n">y_raw</span><span class="p">)</span>
        <span class="c1"># convert SE to RMSE</span>
        <span class="n">baseline_val_loss</span><span class="p">[</span><span class="n">epoch</span><span class="p">]</span> <span class="o">+=</span> <span class="n">baseline_loss</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">baseline_val_loss</span><span class="p">[</span><span class="n">epoch</span><span class="p">]</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">baseline_val_loss</span><span class="p">[</span><span class="n">epoch</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">eta</span> <span class="o">*=</span> <span class="mf">0.9</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">baseline_val_loss</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epoch&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Val Loss&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>„Åì„ÅÆÊÄßËÉΩ„ÅØ„Åã„Å™„Çä‰Ωé„ÅÑ„Åß„Åô„Åå„ÄÅ‰ªñ„ÅÆ„Çà„ÇäÊ¥óÁ∑¥„Åï„Çå„Åü„É¢„Éá„É´„ÅåË∂Ö„Åà„Çã„Åπ„Åç„Éô„Éº„Çπ„É©„Ç§„É≥ÊÄßËÉΩ„Å®„Åó„Å¶ËâØ„ÅÑÂü∫Ê∫ñ„Å®„Å™„Çã„Åß„Åó„Çá„ÅÜ„ÄÇ„Åì„ÅÆË®ìÁ∑¥„ÅßÁî®„ÅÑ„ÅüÂ§â„Çè„Å£„ÅüÁÇπ„Å®„Åó„Å¶„ÅØ„ÄÅÂ≠¶ÁøíÁéá„ÇíÂæê„ÄÖ„Å´‰∏ã„Åí„Å¶„ÅÑ„Å£„Åü„Åì„Å®„Åß„Åô„ÄÇ„Åì„Çå„ÅØ„ÄÅÊàë„ÄÖ„ÅÆÁâπÂæ¥ÈáèÂèä„Å≥„É©„Éô„É´„ÅÆÂÄ§„Åå„Åô„Åπ„Å¶Áï∞„Å™„ÇãÂ§ß„Åç„Åï„Åß„ÅÇ„Çã„Åü„ÇÅ„Åß„Åô„ÄÇ„Åì„ÅÆ„Çà„ÅÜ„Å™Â†¥Âêà„ÄÅ„É¢„Éá„É´„ÅÆÈáç„Åø„ÅØ„ÄÅ„ÅØ„Åò„ÇÅ„ÅØÊ≠£„Åó„ÅÑ„Ç™„Éº„ÉÄ„Éº„Å´„Åô„Çã„Åü„ÇÅ„Å´Â§ß„Åç„ÅèÂãï„Åã„Åó„ÄÅ„Åù„ÅÆÂæå„ÅßÂ∞ë„ÅóÂæÆË™øÊï¥„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ„Åù„ÅÆ„Åü„ÇÅ„ÄÅÂ§ß„Åç„Å™Â≠¶ÁøíÁéá„Åß„Çπ„Çø„Éº„Éà„Åó„Å¶Âæê„ÄÖ„Å´‰∏ã„Åí„Å¶„ÅÑ„Åè„ÅÆ„Åß„Åô„ÄÇ</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ys</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">yhats</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">valid_set</span><span class="p">:</span>
    <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">y</span> <span class="o">=</span> <span class="n">convert_record</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">ys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">yhat_raw</span> <span class="o">=</span> <span class="n">baseline_model</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">yhat</span> <span class="o">=</span> <span class="n">transform_prediction</span><span class="p">(</span><span class="n">yhat_raw</span><span class="p">)</span>
    <span class="n">yhats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yhat</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">yhats</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Energy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Predicted Energy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>„Åã„Å™„Çä„Éê„É©„Å§„Åç„ÅØ„ÅÇ„Çä„Åæ„Åô„Åå„ÄÅ„Åì„ÅÆ„Ç∑„É≥„Éó„É´„Å™„É¢„Éá„É´„Åß„ÇÇ„ÄÅ„Åä„Åä„Çà„Åù„ÅÆÂÇæÂêë„ÇíÊçâ„Åà„Åü‰∫àÊ∏¨„ÅØ„Åß„Åç„Å¶„ÅÑ„Çã„Çà„ÅÜ„Åß„Åô„ÄÇ„Åù„Çå„Åß„ÅØ„É¢„Éá„É´„ÇíÊîπËâØ„Åó„Å¶„ÅÑ„Åç„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>
</section>
<section id="gnn">
<h2><span class="section-number">18.5. </span>GNN„É¢„Éá„É´„ÅÆ‰æã<a class="headerlink" href="#gnn" title="Permalink to this headline">¬∂</a></h2>
<p>„Åï„Å¶„ÄÅÊàë„ÄÖ„ÅØQM9„ÅÆ„Éá„Éº„Çø„Çí‰Ωø„Å£„Å¶„Ç®„Éç„É´„ÇÆ„Éº„ÅÆ‰∫àÊ∏¨„É¢„Éá„É´„ÇíÁµÑ„ÇÅ„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åó„Åü„ÄÇ„ÅØ„Åò„ÇÅ„Å´Ëø∞„Åπ„Åü„Çà„ÅÜ„Å´„ÄÅ„Åì„ÅÆÂïèÈ°å„Å´„ÅØÂàÜÂ≠ê„ÅÆÊßãÈÄ†„Å´„Åä„Åë„ÇãÂõûËª¢„Éª‰∏¶ÈÄ≤„ÉªÈ†ÜÂ∫è„Å´ÂØæ„Åó„Å¶‰∏çÂ§âÊÄß„ÇíÂÇô„Åà„Åü„É¢„Éá„É´„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ
„Åæ„ÅöÈ†ÜÂ∫è„Å´ÂØæ„Åó„Å¶‰∏çÂ§â„Å®„Åô„Çã„Åü„ÇÅ„ÄÅGraph Neural NetworkÔºàGNNÔºâ„ÇíÁî®„ÅÑ„Çã„Åì„Å®„Å´„Åó„Åæ„Åô„ÄÇ„Åù„Åó„Å¶„ÄÅÂ∫ßÊ®ô/ÂÖÉÁ¥†„Éô„ÇØ„Éà„É´„Å´Âü∫„Å•„ÅÑ„Å¶„ÄÅÂàÜÂ≠ê„ÇíË°®„Åô<em>„Ç∞„É©„Éï</em>„Çí‰ΩúÊàê„Åó„Åæ„Åô„ÄÇ„Åô„Å™„Çè„Å°„ÄÅÂêÑÂéüÂ≠ê„ÅåÈö£Êé•ÂéüÂ≠ê„Å®ÁµêÂêà„Åó„Å¶„ÅÑ„Çã„Å®„Åø„Å™„Åó„ÄÅ„Åì„Çå„ÇíÂéüÂ≠ê„Çí„Éé„Éº„Éâ„ÄÅÁµêÂêà„Çí„Ç®„ÉÉ„Ç∏„Å®„Åô„Çã„Ç∞„É©„Éï„ÅßË°®Áèæ„Åó„Åæ„Åô„ÄÇ„Åì„ÅÆÊôÇ„ÄÅÂêÑÂéüÂ≠êÂêåÂ£´„ÅÆË∑ùÈõ¢ÔºàpairwiseË∑ùÈõ¢Ôºâ„ÅÆÈÄÜÊï∞„Çí„Ç®„ÉÉ„Ç∏„ÅÆÈáç„Åø„Å®„Åó„Å¶Áî®„ÅÑ„Åæ„Åô„ÄÇpairwiseË∑ùÈõ¢„ÅØÂéüÂ≠êÂêåÂ£´„ÅÆÁõ∏ÂØæÁöÑ„Å™‰ΩçÁΩÆÈñ¢‰øÇ„Å´„ÅÆ„Åø‰æùÂ≠ò„Åô„Çã„Åü„ÇÅ„ÄÅ„Åì„Çå„ÇíÁî®„ÅÑ„Çã„Åì„Å®„Åß„ÄÅÂπ≥Ë°åÁßªÂãï„Å®ÂõûËª¢„Å´ÂØæ„Åô„Çã‰∏çÂ§âÊÄß„ÇíÂæó„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ„Åæ„ÅüË∑ùÈõ¢„ÅÆÈÄÜÊï∞„Å´„Çà„ÇãÈáç„Åø‰ªò„Åë„Å´„Çà„Å£„Å¶„ÄÅËøë„Åè„Å´„ÅÇ„ÇãÂéüÂ≠ê„ÅØ„Ç®„ÉÉ„Ç∏„ÅÆÈáç„Åø„ÅåÂ§ß„Åç„Åè„ÄÅÈÄÜ„Å´ÈÅ†„Åè„Å´„ÅÇ„ÇãÂéüÂ≠ê„Åß„ÅØÂ∞è„Åï„Åè„Å™„Çä„Åæ„Åô„ÄÇ</p>
<p>„Åù„Çå„Åß„ÅØ„ÄÅBattagliaÊñπÁ®ãÂºè <span id="id6">[<a class="reference internal" href="../dl/gnn.html#id78" title="Peter W Battaglia, Jessica B Hamrick, Victor Bapst, Alvaro Sanchez-Gonzalez, Vinicius Zambaldi, Mateusz Malinowski, Andrea Tacchetti, David Raposo, Adam Santoro, Ryan Faulkner, and others. Relational inductive biases, deep learning, and graph networks. arXiv preprint arXiv:1806.01261, 2018.">BHB+18</a>]</span> „Çí‰Ωø„Å£„Å¶„É¢„Éá„É´„ÇíÂÆöÁæ©„Åó„Åæ„Åô„ÄÇÔºàÊéàÊ•≠„ÅßÊ©üÊ¢∞Â≠¶Áøí„ÇíÂ≠¶„Çì„Å†„Åì„Å®„Åå„ÅÇ„Çã‰∫∫„Å´„Å®„Å£„Å¶ÔºâÊéàÊ•≠„ÅßÁøí„Å£„Åü„Åß„ÅÇ„Çç„ÅÜ„Åª„Å®„Çì„Å©„ÅÆ‰æã„Å®„ÅØÂØæË±°ÁöÑ„Å´„ÄÅ„Ç®„ÉÉ„Ç∏„ÇÑ„Éé„Éº„Éâ„Åß„ÅØ„Å™„Åè„ÄÅ„Åì„Åì„Åß„ÅØ„Ç∞„É©„ÉïÂÖ®‰Ωì„ÅÆÁâπÂæ¥„Éô„ÇØ„Éà„É´ <span class="math notranslate nohighlight">\(\vec{u}\)</span> „Å´ÁùÄÁõÆ„Åó„Åæ„Åô„ÄÇ Â≠¶Áøí„ÅåÈÄ≤„ÇÄ„Å´„Å§„Çå„Å¶„ÄÅ<span class="math notranslate nohighlight">\(\vec{u}\)</span> „ÅØÊàë„ÄÖ„Åå‰∫àÊ∏¨„Åó„Åü„ÅÑ„Çø„Éº„Ç≤„ÉÉ„Éà„Åß„ÅÇ„Çã„Ç®„Éç„É´„ÇÆ„Éº„Å®Áµê„Å≥‰ªò„Åë„Çâ„Çå„Å¶„ÅÑ„Åç„Åæ„Åô„ÄÇ„Ç®„ÉÉ„Ç∏„ÅÆÊõ¥Êñ∞„Åß„ÅØ„ÄÅsenderÔºà„Ç®„ÉÉ„Ç∏„Å®ÁµêÂêà„Åó„Åü„Éé„Éº„ÉâÔºâ„Åä„Çà„Å≥„ÄÅÂ≠¶ÁøíÂèØËÉΩ„Å™Èáç„Åø„ÇíÊåÅ„Å§„Ç®„ÉÉ„Ç∏„ÅÆ„Åø„ÇíËÄÉÊÖÆ„Åó„Åæ„Åô„ÄÇ</p>
<div class="amsmath math notranslate nohighlight" id="equation-bfbb0e06-7645-4894-a597-02013244d625">
<span class="eqno">(18.1)<a class="headerlink" href="#equation-bfbb0e06-7645-4894-a597-02013244d625" title="Permalink to this equation">¬∂</a></span>\[\begin{equation}
      \vec{e}^{'}_k = \phi^e\left( \vec{e}_k, \vec{v}_{rk}, \vec{v}_{sk}, \vec{u}\right) = \sigma\left(\vec{v}_{sk}\vec{w}_ee_k + \vec{b}_e\right)
\end{equation}\]</div>
<p>„Åì„Åì„Åß„ÄÅÂÖ•Âäõ„Ç®„ÉÉ„Ç∏ <span class="math notranslate nohighlight">\(e_k\)</span> „ÅØÂçò‰∏Ä„ÅÆÊï∞ÂÄ§ÔºàpairwiseË∑ùÈõ¢„ÅÆÈÄÜÊï∞Ôºâ„Åß„ÅÇ„Çä„ÄÅ <span class="math notranslate nohighlight">\(\vec{b}_e\)</span> „ÅØÂ≠¶ÁøíÂèØËÉΩ„Å™„Éê„Ç§„Ç¢„Çπ„Éô„ÇØ„Éà„É´„Åß„Åô„ÄÇ„Åì„Åì„Åß„ÅØÁ§∫„Åó„Åæ„Åõ„Çì„Åå„ÄÅ„Ç®„ÉÉ„Ç∏„ÅÆÊõ¥Êñ∞„Åß„ÅØÂíå„Çí„Å®„Å£„Å¶ÁâπÂæ¥„ÇíÈõÜÁ¥Ñ„Åó„Åæ„Åô„ÄÇ <span class="math notranslate nohighlight">\(\sigma\)</span> „ÅØleaky ReLUÈñ¢Êï∞„Åß„ÅôÔºàË®≥Ê≥®ÔºöÊ¥ªÊÄßÂåñÈñ¢Êï∞„ÅÆ‰∏Ä„Å§„Åß„ÅÇ„ÇãReLU„ÅÆ‰∫úÁ®Æ„ÅÆ„Åì„Å®Ôºâ„ÄÇÂéüËëóËÄÖ„ÅØ„ÄÅReLU„Åß„ÅØ„Å™„Åèleakly ReLU„ÇíÁî®„ÅÑ„Çã„Åì„Å®„Åß„ÄÅÂãæÈÖçÊ∂àÂ§±„ÇíËµ∑„Åì„Åï„ÅöÊÄßËÉΩ„Åå‰∏ä„Åå„Çã„Åì„Å®„ÇíÁô∫Ë¶ã„Åó„Åæ„Åó„Åü„ÄÇ„Çà„Å£„Å¶„ÄÅ„Éé„Éº„Éâ„ÅÆÊõ¥Êñ∞„ÅØÊ¨°„ÅÆ„Çà„ÅÜ„Å´„Å™„Çä„Åæ„ÅôÔºö</p>
<div class="amsmath math notranslate nohighlight" id="equation-ca876aef-8424-49f6-8950-3307ec5f984b">
<span class="eqno">(18.2)<a class="headerlink" href="#equation-ca876aef-8424-49f6-8950-3307ec5f984b" title="Permalink to this equation">¬∂</a></span>\[\begin{equation}
   \vec{v}^{'}_i = \phi^v\left( \bar{e}^{'}_i, \vec{v}_i, \vec{u}\right) = \sigma\left(\mathbf{W}_v \bar{e}^{'}_i\right) + \vec{v}_i
\end{equation}\]</div>
<p>ÂÖ®„Å¶„ÅÆ„Éé„Éº„Éâ„ÅÆ„Ç∞„É≠„Éº„Éê„É´„Å™ÈõÜÁ¥Ñ„Åß„ÇÇÂêåÊßò„Å´Âíå„ÇíÂèñ„Çä„Åæ„Åô„ÄÇ„Çà„Å£„Å¶„ÄÅ„Ç∞„É©„ÉïÁâπÂæ¥„Éô„ÇØ„Éà„É´„ÅÆ„Ç¢„ÉÉ„Éó„Éá„Éº„Éà„ÅØÊ¨°„ÅÆ„Çà„ÅÜ„Å´„Å™„Çä„Åæ„ÅôÔºö</p>
<div class="amsmath math notranslate nohighlight" id="equation-0500d37b-8691-4bb4-8f5d-cdea7e7b116e">
<span class="eqno">(18.3)<a class="headerlink" href="#equation-0500d37b-8691-4bb4-8f5d-cdea7e7b116e" title="Permalink to this equation">¬∂</a></span>\[\begin{equation}
    \vec{u}^{'} = \phi^u\left( \bar{e}^{'},\bar{v}^{'}, \vec{u}\right) = \sigma\left(\mathbf{W}_u\bar{v}^{'}\right) + \vec{u}
\end{equation}\]</div>
<p>„Åù„Åó„Å¶„ÄÅfinal energy„ÅÆË®àÁÆó„ÅÆ„Åü„ÇÅ„ÄÅÊ¨°„ÅÆÂõûÂ∏∞Èñ¢Êï∞„Çí‰Ωø„ÅÑ„Åæ„ÅôÔºö</p>
<div class="amsmath math notranslate nohighlight" id="equation-0e185a43-c52e-4207-9857-e0a9dbb94595">
<span class="eqno">(18.4)<a class="headerlink" href="#equation-0e185a43-c52e-4207-9857-e0a9dbb94595" title="Permalink to this equation">¬∂</a></span>\[\begin{equation}
    \hat{E} = \vec{w}\cdot \vec{u} + b
\end{equation}\]</div>
<p>„Åì„ÅÆÂÆüË£Ö„Å´„Åä„Åë„Çã„Éù„Ç§„É≥„Éà„ÅÆÊúÄÂæå„ÅØ„ÄÅÂêÑGNN„É¨„Ç§„É§„Éº„Åß„ÅØ„Ç®„ÉÉ„Ç∏„Å´ <span class="math notranslate nohighlight">\(\vec{u}\)</span> „Åä„Çà„Å≥„Éé„Éº„Éâ„Éô„ÇØ„Éà„É´„ÇíÊ∏°„Åô„ÇÇ„ÅÆ„ÅÆ„ÄÅ„Ç®„ÉÉ„Ç∏„Åù„ÅÆ„ÇÇ„ÅÆ„ÅÆÈáç„Åø„ÅØÂÖ®„Å¶„ÅÆGNN„É¨„Ç§„É§„Éº„ÅßÂêå„Åò„Å®„Åô„Çã„Åì„Å®„Åß„ÅÇ„Çã„ÄÇ„Åì„ÅÆÂÆüË£Ö„ÅØexample„É¢„Éá„É´„Åß„ÅÇ„Çä„ÄÅ‰∏ä„ÅßËø∞„Åπ„ÅüÊßò„ÄÖ„Å™‰∫ãÊüÑ„Å´„Å§„ÅÑ„Å¶„ÅØÂ§âÊõ¥„ÅÆ‰ΩôÂú∞„Åå„ÅÇ„Çã„Åì„Å®„Å´Ê≥®ÊÑè„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ„Åæ„Åü„ÄÅÂàÜÂ≠ê„Ç∞„É©„Éï„ÇíÊâ±„ÅÜ„Åü„ÇÅ„Å´„ÅØ„ÄÅ„Åì„Åì„ÅßÁî®„ÅÑ„Å¶„ÅÑ„ÇãGNN„ÅÆ„Ç´„Éº„Éç„É´Ôºà„Éé„Éº„Éâ„Éª„Ç®„ÉÉ„Ç∏„Éª„Ç∞„É©„Éï„ÅÆÊõ¥Êñ∞ÊñπÊ≥ïÔºâ„Åß„ÅØ„Å™„ÅÑ‰ªñ„ÅÆÊñπÊ≥ï„ÅÆ„Åª„ÅÜ„Åå„ÅÜ„Åæ„Åè„ÅÑ„Åè„Åì„Å®„ÅåÁü•„Çâ„Çå„Å¶„ÅÑ„Çã„ÄÇ„Å®„ÅØ„ÅÑ„Åà„ÄÅ„Åæ„Åö„ÅØ„Åì„ÅÆ„É¢„Éá„É´„ÇíÂÆüË£Ö„Åó„Å¶„ÄÅ„ÅÜ„Åæ„Åè„ÅÑ„Åè„Åã„Å©„ÅÜ„ÅãË¶ã„Å¶„Åø„Çã„Åì„Å®„Å´„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>
<section id="jax">
<h3><span class="section-number">18.5.1. </span>JAX„Å´„Çà„Çã„É¢„Éá„É´„ÅÆÂÆüË£Ö<a class="headerlink" href="#jax" title="Permalink to this headline">¬∂</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">x2e</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;convert xyz coordinates to inverse pairwise distance&quot;&quot;&quot;</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="p">[:,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">r2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">r2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">e</span>


<span class="k">def</span> <span class="nf">gnn_layer</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">we</span><span class="p">,</span> <span class="n">web</span><span class="p">,</span> <span class="n">wv</span><span class="p">,</span> <span class="n">wu</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Implementation of the GNN&quot;&quot;&quot;</span>
    <span class="c1"># make nodes be N x N so we can just multiply directly</span>
    <span class="c1"># ek is now shaped N x N x features</span>
    <span class="n">ek</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">leaky_relu</span><span class="p">(</span>
        <span class="n">web</span>
        <span class="o">+</span> <span class="n">jnp</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">jnp</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="o">@</span> <span class="n">we</span>
        <span class="o">*</span> <span class="n">edges</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="c1"># sum over neighbors to get N x features</span>
    <span class="n">ebar</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ek</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># dense layer for new nodes to get N x features</span>
    <span class="n">new_nodes</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">leaky_relu</span><span class="p">(</span><span class="n">ebar</span> <span class="o">@</span> <span class="n">wv</span><span class="p">)</span> <span class="o">+</span> <span class="n">nodes</span>
    <span class="c1"># sum over nodes to get shape features</span>
    <span class="n">global_node_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">new_nodes</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># dense layer for new features</span>
    <span class="n">new_features</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">leaky_relu</span><span class="p">(</span><span class="n">global_node_features</span> <span class="o">@</span> <span class="n">wu</span><span class="p">)</span> <span class="o">+</span> <span class="n">features</span>
    <span class="c1"># just return features for ease of use</span>
    <span class="k">return</span> <span class="n">new_nodes</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">new_features</span>
</pre></div>
</div>
</div>
</div>
<p>„Åì„Åì„Åæ„Åß„ÅÆË™¨Êòé„Çí„ÇÇ„Å®„Å´„Åó„Å¶„ÄÅÂ∫ßÊ®ô„ÇípairwiseË∑ùÈõ¢„ÅÆÈÄÜÊï∞„Å´Â§âÊèõ„Åô„Çã„Ç≥„Éº„Éâ„Å®„ÄÅ‰∏äË®ò„ÅÆGNNÊñπÁ®ãÂºè„ÇíÂÆüË£Ö„Åó„Åæ„Åó„Åü„ÄÇÂÆüË£Ö„Åå„Å©„ÅÜ„Å™„Å£„Å¶„ÅÑ„Çã„ÅÆ„ÅãË¶ã„Å¶„Åø„Åæ„Åó„Çá„ÅÜÔºö</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">graph_feature_len</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">node_feature_len</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">msg_feature_len</span> <span class="o">=</span> <span class="mi">16</span>

<span class="c1"># make our weights</span>
<span class="k">def</span> <span class="nf">init_weights</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
    <span class="n">we</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">)</span>
    <span class="n">wb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">)</span>
    <span class="n">wv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">)</span>
    <span class="n">wu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">g</span><span class="p">),</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">we</span><span class="p">,</span> <span class="n">wb</span><span class="p">,</span> <span class="n">wv</span><span class="p">,</span> <span class="n">wu</span><span class="p">]</span>


<span class="c1"># make a graph</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="n">e</span>
<span class="n">edges</span> <span class="o">=</span> <span class="n">x2e</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">graph_feature_len</span><span class="p">)</span>

<span class="c1"># eval</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">gnn_layer</span><span class="p">(</span>
    <span class="n">nodes</span><span class="p">,</span>
    <span class="n">edges</span><span class="p">,</span>
    <span class="n">features</span><span class="p">,</span>
    <span class="o">*</span><span class="n">init_weights</span><span class="p">(</span><span class="n">graph_feature_len</span><span class="p">,</span> <span class="n">node_feature_len</span><span class="p">,</span> <span class="n">msg_feature_len</span><span class="p">),</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;input feautres&quot;</span><span class="p">,</span> <span class="n">features</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;output features&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>„Éê„ÉÉ„ÉÅ„É™„Åß„ÅôÔºÅ„Ç∞„É©„ÉïÁâπÂæ¥„ÇíÂá¶ÁêÜ„Åß„Åç„Å¶„ÅÑ„Åæ„Åô„Å≠„ÄÇÊ¨°„Å´„ÄÅ„Åì„ÅÆÊñπÁ®ãÂºè„Çí‰Ωø„Å£„Å¶„ÄÅ2Â±§„ÅÆGNN„É¨„Ç§„É§„Éº„Åã„Çâ„Å™„ÇãGNN„É¢„Éá„É´„ÇíÂÆöÁæ©„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇÂêà„Çè„Åõ„Å¶loss„ÇÇÂÆöÁæ©„Åó„Åæ„Åô„ÄÇ</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get weights for both layers</span>
<span class="n">w1</span> <span class="o">=</span> <span class="n">init_weights</span><span class="p">(</span><span class="n">graph_feature_len</span><span class="p">,</span> <span class="n">node_feature_len</span><span class="p">,</span> <span class="n">msg_feature_len</span><span class="p">)</span>
<span class="n">w2</span> <span class="o">=</span> <span class="n">init_weights</span><span class="p">(</span><span class="n">graph_feature_len</span><span class="p">,</span> <span class="n">node_feature_len</span><span class="p">,</span> <span class="n">msg_feature_len</span><span class="p">)</span>
<span class="n">w3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">graph_feature_len</span><span class="p">))</span>
<span class="n">b</span> <span class="o">=</span> <span class="mf">0.0</span>


<span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w3</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">f0</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">graph_feature_len</span><span class="p">)</span>
    <span class="n">e0</span> <span class="o">=</span> <span class="n">x2e</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
    <span class="n">n0</span> <span class="o">=</span> <span class="n">nodes</span>
    <span class="n">n1</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">f1</span> <span class="o">=</span> <span class="n">gnn_layer</span><span class="p">(</span><span class="n">n0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="o">*</span><span class="n">w1</span><span class="p">)</span>
    <span class="n">n2</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">f2</span> <span class="o">=</span> <span class="n">gnn_layer</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="o">*</span><span class="n">w2</span><span class="p">)</span>
    <span class="n">yhat</span> <span class="o">=</span> <span class="n">f2</span> <span class="o">@</span> <span class="n">w3</span> <span class="o">+</span> <span class="n">b</span>
    <span class="k">return</span> <span class="n">yhat</span>


<span class="k">def</span> <span class="nf">loss</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w3</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">model</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w3</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>


<span class="n">loss_grad</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>ÂêÑÂàÜÂ≠ê„Çí„Éë„Éá„Ç£„É≥„Ç∞„Åó„ÄÅÂÖ®„Å¶„ÅÆÂàÜÂ≠ê„ÅÆdata shape„ÇíÊèÉ„Åà„Å¶„Çà„ÇäÁ∞°Âçò„Å´ÂàÜÂ≠ê„ÇíÊâ±„Åà„Çã„Çà„ÅÜ„Å´„Åô„Çã„Åì„Å®„ÇÇ„Åß„Åç„Åæ„Åô„Åå„ÄÅ„Åì„Åì„Åß„ÅØÂÆüË£Ö„ÇíÁ∞°Âçò„Å´„Åô„Çã„Åü„ÇÅ„Å´„Éë„Éá„Ç£„É≥„Ç∞„ÅØ„Çπ„Ç≠„ÉÉ„Éó„Åó„Åæ„Åô„ÄÇ</p>
</aside>
<p>‰ª•‰∏ã„ÅÆ„Ç≥„Éº„Éâ„Åß„ÅØ„ÄÅGNN„ÅÆÂ≠¶ÁøíÁéá„ÇíÂõûÂ∏∞Èñ¢Êï∞„ÅÆÂ≠¶ÁøíÁéá„ÅÆ1/10„Å´„Çπ„Ç±„Éº„É™„É≥„Ç∞„Åô„ÇãÂ∞è„Åï„Å™Â§âÊõ¥„ÇíÂèñ„ÇäÂÖ•„Çå„Åæ„Åó„Åü„ÄÇ„Åì„ÅÆ„Éè„ÉÉ„ÇØ„ÅØ„É¢„Éá„É´„Å´„Å®„Å£„Å¶Êú¨Ë≥™ÁöÑ„Å´ÈáçË¶Å„Å™ÁÇπ„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„Åå„ÄÅÂéüËëóËÄÖ„ÅåË©¶Ë°åÈåØË™§„ÅßË¶ã„Å§„Åë„ÅüÂ≠¶Áøí„Çí„ÅÜ„Åæ„Åè„ÅÑ„Åè„Çà„ÅÜ„Å´„Åô„Çã„Åü„ÇÅ„ÅÆÂ∞è„Åï„Å™„ÉÜ„ÇØ„Éã„ÉÉ„ÇØ„Åß„ÅôÔºàË®≥Ê≥®Ôºö„Åì„ÅÆ„Çà„ÅÜ„Å´„ÄÅDNN„ÅÆÂ≠¶Áøí„Åß„ÅØ„Åî„ÅèÂ∞è„Åï„Å™Â§âÊõ¥„Åå„É¢„Éá„É´„ÅÆÊÄßËÉΩ„Å´Â§ß„Åç„Å™ÂΩ±Èüø„Çí‰∏é„Åà„ÇãÂ†¥Âêà„Åå„Åó„Å∞„Åó„Å∞„ÅÇ„Çä„Åæ„ÅôÔºâ„ÄÇ</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eta</span> <span class="o">=</span> <span class="mf">1e-3</span>
<span class="n">val_loss</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">train_set</span><span class="p">:</span>
        <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">y_raw</span> <span class="o">=</span> <span class="n">convert_record</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">transform_label</span><span class="p">(</span><span class="n">y_raw</span><span class="p">)</span>
        <span class="n">grad</span> <span class="o">=</span> <span class="n">loss_grad</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w3</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="c1"># update regression weights</span>
        <span class="n">w3</span> <span class="o">-=</span> <span class="n">eta</span> <span class="o">*</span> <span class="n">grad</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">b</span> <span class="o">-=</span> <span class="n">eta</span> <span class="o">*</span> <span class="n">grad</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="c1"># update GNN weights</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">w1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)]:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)):</span>
                <span class="n">w</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-=</span> <span class="n">eta</span> <span class="o">*</span> <span class="n">grad</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="mi">10</span>
    <span class="c1"># compute validation loss</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">valid_set</span><span class="p">:</span>
        <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">y_raw</span> <span class="o">=</span> <span class="n">convert_record</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">transform_label</span><span class="p">(</span><span class="n">y_raw</span><span class="p">)</span>
        <span class="c1"># convert SE to RMSE</span>
        <span class="n">val_loss</span><span class="p">[</span><span class="n">epoch</span><span class="p">]</span> <span class="o">+=</span> <span class="n">loss</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w3</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">val_loss</span><span class="p">[</span><span class="n">epoch</span><span class="p">]</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">val_loss</span><span class="p">[</span><span class="n">epoch</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">eta</span> <span class="o">*=</span> <span class="mf">0.9</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">baseline_val_loss</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;baseline&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">val_loss</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;GNN&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epoch&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Val Loss&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>„Åì„Çå„ÅØÂ§ß„Åç„Å™„Éá„Éº„Çø„Çª„ÉÉ„Éà„Åß„ÄÅÂ≠¶Áøí„Å´„ÅØÊôÇÈñì„Åå„Åã„Åã„Çã„Åã„ÇÇ„Åó„Çå„Åæ„Åõ„Çì„ÄÇ„Åæ„Åö„ÅØ„ÄÅGNN„Çí‰Ωø„Å£„Åü„É¢„Éá„É´ÊßãÁØâ„Å®Â≠¶Áøí„ÅÆÂéüÁêÜ„Åå‰ºù„Çè„Çå„Å∞Âπ∏„ÅÑ„Åß„Åô„ÄÇÊúÄÂæå„Å´„ÄÅ„É¢„Éá„É´„ÅÆ‰∫àÊ∏¨ÊÄßËÉΩ„ÇíË™ø„Åπ„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ys</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">yhats</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">valid_set</span><span class="p">:</span>
    <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">y</span> <span class="o">=</span> <span class="n">convert_record</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">ys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">yhat_raw</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w3</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">yhats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transform_prediction</span><span class="p">(</span><span class="n">yhat_raw</span><span class="p">))</span>


<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">yhats</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Energy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Predicted Energy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>„ÅÑ„Åè„Å§„ÅãÁÇπ„ÅåÂØÜÈõÜ„Åó„Åü„ÇØ„É©„Çπ„Çø„Éº„Åå„ÅÇ„Çä„Åæ„Åô„Åå„ÄÅ„Åì„Çå„Çâ„ÅØÂàÜÂ≠ê„ÅÆÁ®ÆÈ°û„ÇÑÂ§ß„Åç„Åï„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åì„ÅÆ„Éó„É≠„ÉÉ„Éà„Åã„Çâ„ÅØ„ÄÅ„Åì„Åì„Åæ„Åß„Å´ÊßãÁØâ„Åó„Åü„É¢„Éá„É´„ÅåÊ≠£„Åó„ÅèÂ≠¶Áøí„Åï„Çå„ÄÅ„ÇØ„É©„Çπ„Çø„ÉºÂÜÖÈÉ®„ÅßÊ≠£„Åó„ÅÑÂÇæÂêë„ÇíÂ≠¶Áøí„Åó„Å§„Å§„ÅÇ„Çã„Åì„Å®„ÅØ„Çè„Åã„Çä„Åæ„Åô„Åå„ÄÅÂØæËßíÁ∑ö„Åã„ÇâÂ§ß„Åç„ÅèÂ§ñ„Çå„Åü„ÇØ„É©„Çπ„Çø„Éº„Çí‰øÆÊ≠£„Åó„ÄÅ„Åï„Çâ„Å´Á≤æÂ∫¶„Çí‰∏ä„Åí„Çã„Åü„ÇÅ„Å´„ÅØ„ÄÅ„Åæ„Å†„Åæ„Å†„É¢„Éá„É´„ÅÆÂ∑•Â§´„Å®ËøΩÂä†Â≠¶Áøí„ÅåÂøÖË¶Å„Åù„ÅÜ„Åß„Åô„ÄÇ</p>
</section>
</section>
<section id="qm9">
<h2><span class="section-number">18.6. </span>QM9„Éá„Éº„Çø„ÅÆÂ≠¶Áøí„Å´„Å§„ÅÑ„Å¶„ÅÆÈñ¢ÈÄ£Ë≥áÊñô<a class="headerlink" href="#qm9" title="Permalink to this headline">¬∂</a></h2>
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/S09kzo5piAM" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</section>
<section id="id7">
<h2><span class="section-number">18.7. </span>ÂèÇËÄÉÊñáÁåÆ<a class="headerlink" href="#id7" title="Permalink to this headline">¬∂</a></h2>
<div class="docutils container" id="id8">
<dl class="citation">
<dt class="label" id="id47"><span class="brackets"><a class="fn-backref" href="#id6">BHB+18</a></span></dt>
<dd><p>Peter¬†W Battaglia, Jessica¬†B Hamrick, Victor Bapst, Alvaro Sanchez-Gonzalez, Vinicius Zambaldi, Mateusz Malinowski, Andrea Tacchetti, David Raposo, Adam Santoro, Ryan Faulkner, and others. Relational inductive biases, deep learning, and graph networks. <em>arXiv preprint arXiv:1806.01261</em>, 2018.</p>
</dd>
<dt class="label" id="id9"><span class="brackets"><a class="fn-backref" href="#id1">RDRVL14</a></span></dt>
<dd><p>Raghunathan Ramakrishnan, Pavlo¬†O Dral, Matthias Rupp, and O¬†Anatole Von¬†Lilienfeld. Quantum chemistry structures and properties of 134 kilo molecules. <em>Scientific data</em>, 1(1):1‚Äì7, 2014.</p>
</dd>
</dl>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./applied"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../dl/flows.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">17. </span>Normalizing Flows</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="MolGenerator.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">19. </span>Generative RNN in Browser</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Andrew D. White<br/>
    
        &copy; Copyright 2022.<br/>
      <div class="extra_footer">
        <a href="http://thewhitelab.org">thewhitelab.org</a> <div id="wh-modal"> <button class="wh-venti-button" aria-label="close modal" id="wh-modal-close">‚úï</button> <img id="wh-modal-img"> </div>
      </div>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>